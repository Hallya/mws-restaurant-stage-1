!function(){return function e(t,n,o){function r(a,i){if(!n[a]){if(!t[a]){var c="function"==typeof require&&require;if(!i&&c)return c(a,!0);if(s)return s(a,!0);var l=new Error("Cannot find module '"+a+"'");throw l.code="MODULE_NOT_FOUND",l}var u=n[a]={exports:{}};t[a][0].call(u.exports,function(e){return r(t[a][1][e]||e)},u,u.exports,e,t,n,o)}return n[a].exports}for(var s="function"==typeof require&&require,a=0;a<o.length;a++)r(o[a]);return r}}()({1:[function(e,t,n){const o=e("./indexedb"),r="/restaurants/",s="/reviews/",a="?is_favorite=",i="http://localhost:1337",c={DATABASE_URL:{GET:{allRestaurants:()=>fetch(i+r),allReviews:()=>fetch(i+s),restaurant:e=>fetch(i+r+e),setFavoriteRestaurants:e=>fetch(i+r+a+e)},POST:{newReview:e=>fetch(i+s,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})},PUT:{favoriteRestaurant:(e,t)=>fetch(i+r+e+a+t,{method:"PUT"}),updateReview:e=>fetch(i+s+e,{method:"PUT"})},DELETE:{review:e=>fetch(i+s+e,{method:"DELETE"})}},fetchRestaurants:()=>{return o.getAll("restaurants").then(e=>e.length<10?c.DATABASE_URL.GET.allRestaurants().then(e=>e.json()).then(e=>(console.log("- Restaurants data fetched !"),e.restaurants||e)).then(e=>(e.forEach(e=>o.set("restaurants",e)),e)).catch(e=>console.error(`Request failed. Returned status of ${e}`)):e).catch(e=>{console.error(e)})},fetchReviews:()=>{return o.getAll("reviews").then(e=>e.length<10?c.DATABASE_URL.GET.allReviews().then(e=>e.json()).then(e=>(console.log("- Reviews data fetched !"),e.reviews||e)).then(e=>(e.forEach(e=>o.set("reviews",e)),e)).catch(e=>console.error(`Request failed. Returned status of ${e}`)):e).catch(e=>{console.error(e)})},fetchRestaurantById:e=>{return o.get("restaurants",Number(e)).then(t=>t||(console.log("- No restaurant cached"),c.DATABASE_URL.GET.restaurant(e).then(e=>e.json()).then(e=>(o.set("restaurants",e),e)).catch(e=>console.error(`Restaurant does not exist: ${e}`))))},fetchRestaurantByCuisineAndNeighborhood:(e,t)=>{return o.getAll("restaurants").then(n=>n.length<10?c.fetchRestaurants().then(n=>{const r=n;return r.forEach(e=>o.set("restaurants",e)),c.filterResults(r,e,t)}).catch(e=>console.error(e)):c.filterResults(n,e,t)).catch(e=>console.error(e))},filterResults:(e,t,n)=>("all"!==t&&(e=e.filter(e=>e.cuisine_type==t)),"all"!==n&&(e=e.filter(e=>e.neighborhood==n)),e),addNeighborhoodsOptions:e=>{const t=e.map(e=>e.neighborhood);return t.filter((e,n)=>t.indexOf(e)==n)},addCuisinesOptions:e=>{const t=e.map(e=>e.cuisine_type);return t.filter((e,n)=>t.indexOf(e)==n)},urlForRestaurant:e=>`restaurant.html?id=${e.id}`,imageUrlForRestaurant:e=>`assets/img/jpg/${e.photograph}`,imageWebpUrlForRestaurant:e=>`assets/img/webp/${e.photograph}`,postReview:async e=>{console.log("Trying to post review..."),e.preventDefault();const t=document.querySelector("#title-container form").elements,n={restaurant_id:Number(window.location.search.match(/\d+/)[0]),name:t.name.value,rating:Number(t.rating.value),comments:t.comments.value,createdAt:Date.now(),updatedAt:Date.now()};await o.set("posts",n),await o.addReview("reviews",n);const r=await navigator.serviceWorker.ready;Notification.requestPermission().then(function(e){"denied"!==e?"default"!==e?"granted"===e&&console.log("Notification allowed"):console.log("The permission request was dismissed."):console.log("Permission wasn't granted. Allow a retry.")}),r.sync.register("post-review"),location.reload(),r.sync.getTags().then(e=>console.log(e))},mapMarkerForRestaurant:(e,t)=>{return new google.maps.Marker({position:{lat:e.lat||e.latlng.lat,lng:e.lng||e.latlng.lng},title:e.name,url:c.urlForRestaurant(e),map:t,animation:google.maps.Animation.DROP,icon:"assets/img/svg/marker.svg"})}};t.exports=c},{"./indexedb":2}],2:[function(e,t,n){const o=e("../../node_modules/idb/lib/idb"),r=()=>o.open("restaurant-reviews",3,e=>{switch(e.oldVersion){case 0:e.createObjectStore("restaurants",{keyPath:"id"});case 1:e.createObjectStore("reviews",{keyPath:"id",autoIncrement:!0});case 1:e.createObjectStore("posts",{keyPath:"restaurant_id"})}}),s={get:(e,t)=>r().then(n=>{if(n)return n.transaction(e).objectStore(e).get(t)}).catch(e=>console.error(e)),set:(e,t)=>r().then(n=>{if(!n)return;return n.transaction(e,"readwrite").objectStore(e).put(t).complete}).catch(e=>console.error(e)),getAll:e=>r().then(t=>{if(t)return t.transaction(e).objectStore(e).getAll()}).catch(e=>console.error(e)),delete:(e,t)=>r().then(n=>{if(n)return n.transaction(e,"readwrite").objectStore(e).delete(t)}).catch(e=>console.error(e)),addReview:(e,t)=>r().then(n=>{if(n)return n.transaction(e,"readwrite").objectStore(e).add(t)}).catch(e=>console.error(e)),getRestaurantReviews:(e,t)=>r().then(n=>{if(n)return n.transaction(e).objectStore(e).getAll().then(e=>e.filter(e=>e.restaurant_id===t))}).catch(e=>console.error(e))};t.exports=s},{"../../node_modules/idb/lib/idb":4}],3:[function(e,t,n){(function(t){const n="object"==typeof self&&self.self===self&&self||"object"==typeof t&&t.global===t&&t||this,o=e("./js/indexedb"),r=e("./js/dbhelper"),s={CACHE_STATIC:"static-cache-6",CACHE_MAP:"map-api-6",CACHE_FONT:"google-fonts-3"},a=["index.html","manifest.webmanifest","restaurant.html","assets/css/fonts/iconicfill.woff2","assets/css/fonts/fontawesome.woff2","assets/img/svg/puff.svg","assets/img/png/launchScreen-ipad-9.7.png","assets/img/png/launchScreen-ipadpro-10.5.png","assets/img/png/launchScreen-ipadpro-12.9.png","assets/img/png/launchScreen-iphone-8.png","assets/img/png/launchScreen-iphone-8plus.png","assets/img/png/launchScreen-iphone-x.png","assets/img/png/launchScreen-iphone-se.png","assets/img/png/logo-64.png","assets/img/png/logo-128.png","assets/img/png/logo-256.png","assets/img/png/logo-512.png","assets/css/index.css","assets/css/restaurant_info.css","js/main.js","js/restaurant_info.js"];function i(e,t){return caches.open(e).then(e=>e.match(t).then(e=>e||fetch(t)).then(n=>(e.put(t,n.clone()),n),e=>console.error("Error :",e)),e=>console.error("Error: ",e))}self.addEventListener("install",e=>{console.log(`SW - Cache version : "${s.CACHE_STATIC}"`),e.waitUntil(caches.open(s.CACHE_STATIC).then(e=>e.addAll(a)).then(()=>{console.log("SW - All resources cached."),self.skipWaiting(),console.log("SW - SW version skipped.")}).catch(e=>console.error("SW - Open cache failed :",e)))}),self.addEventListener("activate",e=>{const t=Object.keys(s).map(e=>s[e]);e.waitUntil(caches.keys().then(e=>Promise.all(e.map(e=>{if(-1==t.indexOf(e))return console.log("SW - Deleting",e),caches.delete(e)}))).then(()=>console.log(`SW - "${s.CACHE_STATIC}" now ready to handle fetches!`)))}),self.addEventListener("fetch",e=>{const t=new URL(e.request.url),o=n.location;switch(t.hostname){case"maps.gstatic.com":e.respondWith(i(s.CACHE_MAP,e.request));break;case"fonts.gstatic.com":e.respondWith(i(s.CACHE_FONT,e.request));break;case o.hostname:if(t.pathname.startsWith("/restaurant.html")){const n=t.href.replace(/[?&]id=\d{1,}/,"");e.respondWith(i(s.CACHE_STATIC,n))}else t.pathname.endsWith("restaurants.json")?e.respondWith(fetch(e.request)):"POST"!==e.request.method?e.respondWith(i(s.CACHE_STATIC,e.request)):e.respondWith(fetch(e.request));break;default:e.respondWith(fetch(e.request))}});self.addEventListener("sync",function(e){"post-review"===e.tag&&e.waitUntil(async function(){const e=await o.getAll("posts").catch(e=>console.error(e));await Promise.all(e.map(e=>r.DATABASE_URL.POST.newReview(e).then(t=>(console.log("Response after post request",t,"\nStatus :",t.status),201===t.status&&self.registration.showNotification("Review synchronised to server").then(()=>o.delete("posts",e.restaurant_id)),t)).catch(e=>{self.registration.showNotification("Your review will be posted later"),self.registration.showNotification("You can quit this app if needed"),console.error("Review not posted",e)})))}()),e.lastChance&&console.log("Last time trying to sync"),"fetch-new-reviews"===e.tag&&e.waitUntil((async()=>{const e=await r.DATABASE_URL.GET.allReviews();(await e.json()).forEach(e=>o.set("reviews",e))})())})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./js/dbhelper":1,"./js/indexedb":2}],4:[function(e,t,n){"use strict";!function(){function e(e){return new Promise(function(t,n){e.onsuccess=function(){t(e.result)},e.onerror=function(){n(e.error)}})}function n(t,n,o){var r,s=new Promise(function(s,a){e(r=t[n].apply(t,o)).then(s,a)});return s.request=r,s}function o(e,t,n){n.forEach(function(n){Object.defineProperty(e.prototype,n,{get:function(){return this[t][n]},set:function(e){this[t][n]=e}})})}function r(e,t,o,r){r.forEach(function(r){r in o.prototype&&(e.prototype[r]=function(){return n(this[t],r,arguments)})})}function s(e,t,n,o){o.forEach(function(o){o in n.prototype&&(e.prototype[o]=function(){return this[t][o].apply(this[t],arguments)})})}function a(e,t,o,r){r.forEach(function(r){r in o.prototype&&(e.prototype[r]=function(){return e=this[t],(o=n(e,r,arguments)).then(function(e){if(e)return new c(e,o.request)});var e,o})})}function i(e){this._index=e}function c(e,t){this._cursor=e,this._request=t}function l(e){this._store=e}function u(e){this._tx=e,this.complete=new Promise(function(t,n){e.oncomplete=function(){t()},e.onerror=function(){n(e.error)},e.onabort=function(){n(e.error)}})}function h(e,t,n){this._db=e,this.oldVersion=t,this.transaction=new u(n)}function f(e){this._db=e}o(i,"_index",["name","keyPath","multiEntry","unique"]),r(i,"_index",IDBIndex,["get","getKey","getAll","getAllKeys","count"]),a(i,"_index",IDBIndex,["openCursor","openKeyCursor"]),o(c,"_cursor",["direction","key","primaryKey","value"]),r(c,"_cursor",IDBCursor,["update","delete"]),["advance","continue","continuePrimaryKey"].forEach(function(t){t in IDBCursor.prototype&&(c.prototype[t]=function(){var n=this,o=arguments;return Promise.resolve().then(function(){return n._cursor[t].apply(n._cursor,o),e(n._request).then(function(e){if(e)return new c(e,n._request)})})})}),l.prototype.createIndex=function(){return new i(this._store.createIndex.apply(this._store,arguments))},l.prototype.index=function(){return new i(this._store.index.apply(this._store,arguments))},o(l,"_store",["name","keyPath","indexNames","autoIncrement"]),r(l,"_store",IDBObjectStore,["put","add","delete","clear","get","getAll","getKey","getAllKeys","count"]),a(l,"_store",IDBObjectStore,["openCursor","openKeyCursor"]),s(l,"_store",IDBObjectStore,["deleteIndex"]),u.prototype.objectStore=function(){return new l(this._tx.objectStore.apply(this._tx,arguments))},o(u,"_tx",["objectStoreNames","mode"]),s(u,"_tx",IDBTransaction,["abort"]),h.prototype.createObjectStore=function(){return new l(this._db.createObjectStore.apply(this._db,arguments))},o(h,"_db",["name","version","objectStoreNames"]),s(h,"_db",IDBDatabase,["deleteObjectStore","close"]),f.prototype.transaction=function(){return new u(this._db.transaction.apply(this._db,arguments))},o(f,"_db",["name","version","objectStoreNames"]),s(f,"_db",IDBDatabase,["close"]),["openCursor","openKeyCursor"].forEach(function(e){[l,i].forEach(function(t){e in t.prototype&&(t.prototype[e.replace("open","iterate")]=function(){var t,n=(t=arguments,Array.prototype.slice.call(t)),o=n[n.length-1],r=this._store||this._index,s=r[e].apply(r,n.slice(0,-1));s.onsuccess=function(){o(s.result)}})})}),[i,l].forEach(function(e){e.prototype.getAll||(e.prototype.getAll=function(e,t){var n=this,o=[];return new Promise(function(r){n.iterateCursor(e,function(e){e?(o.push(e.value),void 0===t||o.length!=t?e.continue():r(o)):r(o)})})})});var p={open:function(e,t,o){var r=n(indexedDB,"open",[e,t]),s=r.request;return s.onupgradeneeded=function(e){o&&o(new h(s.result,e.oldVersion,s.transaction))},r.then(function(e){return new f(e)})},delete:function(e){return n(indexedDB,"deleteDatabase",[e])}};void 0!==t?(t.exports=p,t.exports.default=t.exports):self.idb=p}()},{}]},{},[3]);