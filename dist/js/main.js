!function(){return function e(t,r,n){function a(o,i){if(!r[o]){if(!t[o]){var c="function"==typeof require&&require;if(!i&&c)return c(o,!0);if(s)return s(o,!0);var l=new Error("Cannot find module '"+o+"'");throw l.code="MODULE_NOT_FOUND",l}var u=r[o]={exports:{}};t[o][0].call(u.exports,function(e){return a(t[o][1][e]||e)},u,u.exports,e,t,r,n)}return r[o].exports}for(var s="function"==typeof require&&require,o=0;o<n.length;o++)a(n[o]);return a}}()({1:[function(e,t,r){const n=e("./indexedb"),a="/restaurants/",s="/reviews/",o="/?is_favorite=",i="?restaurant_id=",c="http://localhost:3000",l={DATABASE_URL:{GET:{allRestaurants:()=>fetch(c+a),allReviews:()=>fetch(c+s),restaurant:e=>fetch(c+a+e),restaurantReviews:e=>fetch(c+s+i+e)},POST:{newReview:e=>fetch(c+s,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})},PUT:{favoriteRestaurant:(e,t)=>fetch(c+a+e+o+t,{method:"PUT"}),updateReview:e=>fetch(c+s+e,{method:"PUT"})},DELETE:{review:e=>fetch(c+s+e,{method:"DELETE"})}},fetchRestaurants:async()=>{const e=await n.getAll("restaurants").catch(e=>console.error(e));if(e.length<10){const e=await l.DATABASE_URL.GET.allRestaurants(),t=e&&await e.json();return console.log("- Restaurants data fetched"),t.forEach(e=>{e.is_favorite=e.is_favorite&&e.is_favorite.toString(),n.set("restaurants",e)}),t}return e},fetchReviews:async()=>{const e=await l.DATABASE_URL.GET.allReviews().catch(e=>console.error(`Request failed. Returned status of ${e}`)),t=await e&&e.json();return console.log("- Reviews data fetched !"),t},fetchRestaurantReviews:async e=>{let t=await n.getAll("reviews").catch(e=>console.error(e));if((t=t.filter(t=>t.restaurant_id===Number(e))).length)return t;{const t=await l.DATABASE_URL.GET.restaurantReviews(e).catch(e=>console.error(`Request failed. Returned status of ${e}`));let r=await t&&t.json();return console.log("- Restaurant reviews fetched !"),await r&&r.length&&r.forEach(e=>n.set("reviews",e)),r}},fetchRestaurantById:async e=>{const t=await n.get("restaurants",Number(e));if(t)return t;{console.log("- No restaurant cached");const t=await l.DATABASE_URL.GET.restaurant(e).catch(e=>console.error(`Restaurant does not exist: ${e}`)),r=t&&await t.json();return r.is_favorite=r.is_favorite.toString(),n.set("restaurants",r),r}},fetchRestaurantByCuisineAndNeighborhood:async(e,t)=>{const r=await n.getAll("restaurants").catch(e=>console.error(e));if(r.length<10){const r=await l.fetchRestaurants().catch(e=>console.error(e));return r.forEach(e=>n.set("restaurants",e)),l.filterResults(r,e,t)}return l.filterResults(r,e,t)},filterResults:(e,t,r)=>("all"!==t&&(e=e.filter(e=>e.cuisine_type==t)),"all"!==r&&(e=e.filter(e=>e.neighborhood==r)),e),addNeighborhoodsOptions:e=>{const t=e.map(e=>e.neighborhood);return t.filter((e,r)=>t.indexOf(e)==r)},addCuisinesOptions:e=>{const t=e.map(e=>e.cuisine_type);return t.filter((e,r)=>t.indexOf(e)==r)},urlForRestaurant:e=>`restaurant.html?id=${e.id}`,imageUrlForRestaurant:e=>`assets/img/jpg/${e.photograph}`,imageWebpUrlForRestaurant:e=>`assets/img/webp/${e.photograph}`,postReview:async e=>{e.preventDefault();const t=document.querySelector("#title-container form").elements,r={restaurant_id:Number(window.location.search.match(/\d+/)[0]),name:t.name.value,rating:Number(t.rating.value),comments:t.comments.value};await n.set("posts",r),r.createdAt=Date.now(),r.updatedAt=Date.now(),await n.addReview("reviews",r),console.log(navigator.serviceWorker.ready);const a=await navigator.serviceWorker.ready;await a.sync.register({id:"post-review"}),location.reload()},setFavorite:async(e,t,r,a)=>{e.classList.toggle("hidden");const s="true"===t.is_favorite?"false":"true";return r.setAttribute("aria-label",e.classList.contains("hidden")?`unset ${t.name} as favorite`:`set ${t.name} as favorite`),e.setAttribute("aria-hidden","true"===t.is_favorite?"true":"false"),a.setAttribute("aria-hidden","true"===t.is_favorite?"false":"true"),t.is_favorite=s,await n.set("restaurants",t),await l.DATABASE_URL.PUT.favoriteRestaurant(t.id,s)},mapMarkerForRestaurant:(e,t)=>{return new google.maps.Marker({position:{lat:e.lat||e.latlng.lat,lng:e.lng||e.latlng.lng},title:e.name,url:l.urlForRestaurant(e),map:t,animation:google.maps.Animation.DROP,icon:"assets/img/svg/marker.svg"})}};t.exports=l},{"./indexedb":3}],2:[function(e,t,r){const n=document.querySelector(".filter-options"),a=document.getElementById("menuFilter"),s=document.querySelector(".filter-options h3"),o=document.querySelector("#neighborhoods-select"),i=document.querySelector("#cuisines-select"),c=document.querySelector("#sort-select"),l=document.querySelector("#favorites"),u={goToRestaurantPage:e=>{e.target.classList.toggle("move-left"),window.location.assign(e.target.dataset.url)},fixedOnViewport:(e,t)=>{const r=t.cloneNode(!0);if(r.className="fixed exclude",r.id="",r.setAttribute("aria-hidden","true"),r.tabIndex=-1,r.children[0].children[0].setAttribute("aria-hidden","true"),r.children[0].children[0].tabIndex=-1,r.children[1].setAttribute("aria-hidden","true"),r.children[1].tabIndex=-1,t.appendChild(r),"IntersectionObserver"in window){new IntersectionObserver(function(e,n){e.forEach(function(e){e.intersectionRatio<=.01?(r.classList.remove("exclude"),r.classList.add("shadow"),t.classList.add("shadow")):(t.classList.contains("shadow")&&t.classList.remove("shadow"),r.classList.remove("shadow"),r.classList.add("exclude"))})},{root:null,threshold:[.01],rootMargin:"0px"}).observe(e)}},toggleMenu:()=>{n.classList.toggle("optionsOpen"),[n,o,i,c,l].forEach(e=>{e.hidden=!e.hidden&&setTimeout(()=>!0,2e3)}),a.classList.toggle("pressed"),a.blur(),s.setAttribute("tabindex","-1"),s.focus()},isFormValid:()=>{document.querySelector("form").checkValidity()?document.querySelector('form input[type="submit"]').style.color="green":document.querySelector('form input[type="submit"]').style.color="#ca0000"},toggleForm:()=>{document.getElementById("title-container").classList.toggle("reviews-toggled"),document.getElementById("reviews-list").classList.toggle("reviews-toggled"),document.querySelector("section form").classList.toggle("toggled-display"),setTimeout(()=>{document.querySelector("section form").classList.toggle("toggled-translate")},800)},lazyLoading:()=>{const e=[].slice.call(document.querySelectorAll(".lazy"));if("IntersectionObserver"in window){const t={root:null,threshold:[],rootMargin:"200px"};for(let e=0;e<=1;e+=.01)t.threshold.push(Math.round(100*e)/100);let r=new IntersectionObserver((e,t)=>{e.forEach(function(e){const t=e.target;(e.isIntersecting||e.intersectionRatio>=.01)&&("source"===t.localName?t.srcset=t.dataset.srcset:t.src=t.dataset.src,t.classList.remove("lazy"),r.unobserve(t))})},t);e.forEach(function(e){r.observe(e)}),document.onreadystatechange=(()=>{"complete"==document.readyState&&u.lazyLoading()})}else{let e=[].slice.call(document.querySelectorAll(".lazy")),t=!1;const r=function(){if(!1===t){t=!0;const n=window.innerHeight+200;e.forEach(function(t){t.getBoundingClientRect().top<=n&&t.getBoundingClientRect().bottom>=0&&"none"!==getComputedStyle(t).display&&(t.src=t.dataset.src,t.srcset=t.dataset.srcset,t.classList.remove("lazy"),0===(e=e.filter(function(e){return e!==t})).length&&(document.removeEventListener("scroll",r),window.removeEventListener("resize",r),window.removeEventListener("orientationchange",r)))}),t=!1}};document.addEventListener("scroll",r),window.addEventListener("resize",r),window.addEventListener("orientationchange",r),"complete"==document.readyState&&(console.log("document ready for lazy load"),r()),document.onreadystatechange=function(){"complete"==document.readyState&&(console.log("document ready for lazy load"),r())}}},sortByNote:(e,t)=>{const r=Number(e.average_rating.replace("/5","")),n=Number(t.average_rating.replace("/5",""));return r<n?1:r>n?-1:0},sortByName:(e,t)=>e.name>t.name,sortByNameInverted:(e,t)=>e.name<t.name,getAverageNote:(e,t=self.reviews)=>{let r=0,n=0;return t&&t.forEach(t=>{t.restaurant_id===e&&(r+=Number(t.rating),n++)}),(r/=n)&&`${Math.round(10*r)/10}/5`||"N/A"}};t.exports=u},{}],3:[function(e,t,r){const n=e("../../node_modules/idb/lib/idb"),a=()=>n.open("restaurant-reviews",3,e=>{switch(e.oldVersion){case 0:e.createObjectStore("restaurants",{keyPath:"id"});case 1:e.createObjectStore("reviews",{keyPath:"id",autoIncrement:!0});case 1:e.createObjectStore("posts",{keyPath:"restaurant_id"})}}),s={async get(e,t){const r=await a().catch(e=>console.error(e));if(r)return r.transaction(e).objectStore(e).get(t)},async set(e,t){const r=await a().catch(e=>console.error(e));if(r)return(await r.transaction(e,"readwrite").objectStore(e).put(t)).complete},async getAll(e){const t=await a().catch(e=>console.error(e));if(t)return t.transaction(e).objectStore(e).getAll()},async delete(e,t){const r=await a().catch(e=>console.error(e));if(r)return r.transaction(e,"readwrite").objectStore(e).delete(t)},async addReview(e,t){const r=await a().catch(e=>console.error(e));if(r)return r.transaction(e,"readwrite").objectStore(e).add(t)},async getRestaurantReviews(e,t){const r=await a().catch(e=>console.error(e));if(r)return(await r.transaction(e).objectStore(e).getAll()).filter(e=>e.restaurant_id===t)}};t.exports=s},{"../../node_modules/idb/lib/idb":5}],4:[function(e,t,r){const n=e("./dbhelper"),a=e("./helpers");e("./indexedb");let s,o,i,c,l=[];const u=document.querySelector(".filter-options"),d=document.getElementById("menuFilter"),m=document.querySelector("#restaurants-list"),p=document.querySelector("#neighborhoods-select"),f=document.querySelector("#cuisines-select"),g=document.querySelector("#favorites input"),h=document.querySelector("#sort-select"),v=document.querySelector("#map-loader");document.addEventListener("DOMContentLoaded",async()=>{if("serviceWorker"in navigator){console.log("Service worker available !");const e="hallya.github.io"===window.location.hostname?"/mws-restaurant-stage-1/sw.js":"../sw.js",t=await navigator.serviceWorker.register(e).catch(e=>console.error(e));console.log("Registration to serviceWorker complete with scope :",t.scope),(await navigator.serviceWorker.ready.catch(e=>console.error(e))).sync.register("post-review")}await E().catch(e=>console.error(e)),await Promise.all([A(),y(),w()]).catch(e=>console.error(e))}),window.addEventListener("load",()=>{!window.navigator.standalone&&-1===window.navigator.userAgent.indexOf("Android")&&-1===window.navigator.userAgent.indexOf("Linux")&&window.innerWidth<550&&T(),f.addEventListener("change",E),p.addEventListener("change",E),h.addEventListener("change",E),g.addEventListener("change",E),d.addEventListener("click",a.toggleMenu)}),document.onkeypress=function(e){13===e.charCode&&u.classList.contains("optionsOpen")&&(a.toggleMenu(),m.setAttribute("tabindex","-1"),m.focus(),document.getElementById("skip").click())};const w=(e=self.restaurants)=>{self.neighborhoods=n.addNeighborhoodsOptions(e),b()},y=(e=self.restaurants)=>{self.cuisines=n.addCuisinesOptions(e),x()},b=(e=self.neighborhoods)=>{const t=p;e.forEach(r=>{const n=document.createElement("option");n.innerHTML=r,n.value=r,n.setAttribute("role","option"),n.setAttribute("aria-setsize","4"),n.setAttribute("aria-posinset",e.indexOf(r)+2),t.append(n)})},x=(e=self.cuisines)=>{const t=f;e.forEach(r=>{const n=document.createElement("option");n.innerHTML=r,n.value=r,n.setAttribute("role","option"),n.setAttribute("aria-setsize","4"),n.setAttribute("aria-posinset",e.indexOf(r)+2),t.append(n)})};window.initMap=(()=>{const e=document.createElement("div");e.setAttribute("tabindex","-1"),e.setAttribute("aria-hidden","true"),e.id="map";self.map=new google.maps.Map(e,{center:{lat:40.722216,lng:-73.987501},zoom:12,streetViewControl:!1,zoomControl:!0,fullscreenControl:!0,mapTypeId:"roadmap",mapTypeControl:!1}),document.getElementById("map-container").appendChild(e),self.map.addListener("tilesloaded",function(){v.remove(),I()})});const E=async()=>{const e=f,t=p,r=h,a=e.selectedIndex,l=t.selectedIndex,u=r.selectedIndex;if(s===e[a].value&&o===t[l].value&&i===r[u].value&&c===g.checked)return Promise.resolve();s=e[a].value,o=t[l].value,i=r[u].value,c=g.checked;const d=await Promise.all([n.fetchReviews(),n.fetchRestaurantByCuisineAndNeighborhood(s,o)]).catch(e=>console.error(e));self.reviews=d[0],self.restaurants=d[1],await _(),await L(),await S(R()),console.log("- Restaurants list updated !")},_=(e=self.restaurants)=>{return self.restaurants=[],document.getElementById("restaurants-list").innerHTML="",l.length>0&&self.markers.forEach(e=>e.setMap(null)),self.markers=[],self.restaurants=e,e},A=()=>{sortOptions=["Note","A-Z","Z-A"],sortOptions.forEach(e=>{const t=document.createElement("option");t.innerHTML=e,t.value=e,t.setAttribute("role","option"),t.setAttribute("aria-setsize","4"),t.setAttribute("aria-posinset",sortOptions.indexOf(e)+2),h.append(t)})},R=(e=self.restaurants)=>(c&&document.getElementById("favorites").classList.add("active"),!c&&document.getElementById("favorites").classList.remove("active"),e.filter(e=>c&&"true"===e.is_favorite||!c&&e)),L=(e=self.restaurants)=>{const t=h.selectedIndex;switch(h[t].value){case"Relevant":return e;case"Note":return e.sort(a.sortByNote);case"A-Z":return e.sort(a.sortByName);case"Z-A":return e.sort(a.sortByNameInverted)}},S=(e=self.restaurants)=>{const t=document.getElementById("restaurants-list");return e.forEach(e=>t.append(N(e))),a.lazyLoading()},N=e=>{const t=document.createElement("li"),r=document.createElement("figure"),s=document.createElement("figcaption"),o=document.createElement("picture"),i=document.createElement("source"),c=document.createElement("source"),l=document.createElement("source"),u=document.createElement("source"),d=document.createElement("source"),m=document.createElement("source"),p=document.createElement("img"),f=document.createElement("aside"),g=document.createElement("p"),h=document.createElement("button"),v=document.createElement("img"),w=document.createElement("img");u.dataset.srcset=`${n.imageWebpUrlForRestaurant(e)}-large_x1.webp 1x, ${n.imageWebpUrlForRestaurant(e)}-large_x2.webp 2x`,u.srcset="assets/img/svg/puff.svg",u.media="(min-width: 1000px)",u.type="image/webp",u.className="lazy",i.dataset.srcset=`${n.imageUrlForRestaurant(e)}-large_x1.jpg 1x, ${n.imageUrlForRestaurant(e)}-large_x2.jpg 2x`,i.srcset="assets/img/svg/puff.svg",i.media="(min-width: 1000px)",i.className="lazy",i.type="image/jpeg",i.onerror="this.onerror=null;this.src='assets/img/svg/no-wifi.svg';",d.dataset.srcset=`${n.imageWebpUrlForRestaurant(e)}-medium_x1.webp 1x, ${n.imageWebpUrlForRestaurant(e)}-medium_x2.webp 2x`,d.srcset="assets/img/svg/puff.svg",d.media="(min-width: 420px)",d.className="lazy",d.type="image/webp",c.dataset.srcset=`${n.imageUrlForRestaurant(e)}-medium_x1.jpg 1x, ${n.imageUrlForRestaurant(e)}-medium_x2.jpg 2x`,c.srcset="assets/img/svg/puff.svg",c.media="(min-width: 420px)",c.className="lazy",c.type="image/jpeg",m.dataset.srcset=`${n.imageWebpUrlForRestaurant(e)}-small_x2.webp 2x, ${n.imageWebpUrlForRestaurant(e)}-small_x1.webp 1x`,m.srcset="assets/img/svg/puff.svg",m.media="(min-width: 320px)",m.className="lazy",m.type="image/webp",l.dataset.srcset=`${n.imageUrlForRestaurant(e)}-small_x2.jpg 2x, ${n.imageUrlForRestaurant(e)}-small_x1.jpg 1x`,l.srcset="assets/img/svg/puff.svg",l.media="(min-width: 320px)",l.type="image/jpeg",p.dataset.src=`${n.imageUrlForRestaurant(e)}-small_x1.jpg`,p.src="assets/img/svg/puff.svg",p.className="restaurant-img lazy",p.setAttribute("sizes","(max-width: 1100px) 85vw, (min-width: 1101px) 990px"),p.alt=`${e.name}'s restaurant`,p.type="image/jpeg",e.average_rating=a.getAverageNote(e.id),g.innerHTML=`${e.average_rating}`,g.setAttribute("aria-hidden","true"),f.append(g),f.className="container-note",f.tabIndex=0,f.setAttribute("aria-label",`${e.name} has a rate of ${e.average_rating.replace("/5"," on 5")}`),h.className="container--favorite",h.id=e.id,h.role="button",h.setAttribute("aria-label","true"===e.is_favorite?`unset ${e.name} as favorite`:`set ${e.name} as favorite`),h.addEventListener("click",()=>n.setFavorite(v,e,h,w)),v.src="assets/img/svg/not-favorite.svg",v.className=`not-favorite ${"true"===e.is_favorite&&"hidden"}`,v.setAttribute("aria-hidden","true"===e.is_favorite?"true":"false"),v.alt="unfavorite restaurant",w.src="assets/img/svg/favorite.svg",w.className="favorite",w.setAttribute("aria-hidden","true"===e.is_favorite?"false":"true"),w.alt="favorite restaurant",h.append(w),h.append(v),o.append(u),o.append(i),o.append(d),o.append(c),o.append(m),o.append(l),o.append(p);const y=document.createElement("a");y.innerHTML="",y.tabIndex=0,y.className="fontawesome-arrow-right",y.dataset.url=n.urlForRestaurant(e),y.addEventListener("click",a.goToRestaurantPage),y.setAttribute("aria-label",`View details of ${e.name}`),y.setAttribute("rel","noopener"),r.append(o),r.append(h),s.append(y),r.append(s),t.tabIndex=0,t.append(f),t.append(r);const b=document.createElement("h2");b.innerHTML=e.name,s.append(b);const x=document.createElement("p");x.innerHTML=e.neighborhood,t.append(x);const E=document.createElement("p");return E.innerHTML=e.address,t.append(E),t.setAttribute("role","listitem"),t.setAttribute("aria-setsize","10"),t.setAttribute("aria-posinset",e.id),t},I=(e=self.restaurants)=>{e.forEach(e=>{const t=n.mapMarkerForRestaurant(e,self.map);google.maps.event.addListener(t,"click",()=>{window.location.href=t.url}),self.markers.push(t)})},T=()=>{const e=document.createElement("aside"),t=document.createElement("p"),r=document.createElement("p"),n=document.createElement("span");e.id="pop",e.className="popup",r.className="popup msg",r.setAttribute("tabindex","0"),t.className="popup note",t.setAttribute("tabindex","0"),n.className="iconicfill-arrow-down",t.innerHTML="(Tap to close)",r.innerHTML='Add <img src="assets/img/svg/share-apple.svg" alt=""> this app to your home screen and enjoy it as a real application !',e.setAttribute("tabindex","-1"),e.addEventListener("click",()=>{e.classList.add("hide"),setTimeout(()=>{e.style="display: none;"},1e3)}),e.append(t),e.append(r),e.append(n),document.getElementById("maincontent").appendChild(e),e.focus(),setTimeout(()=>{e.classList.add("hide")},7e3)}},{"./dbhelper":1,"./helpers":2,"./indexedb":3}],5:[function(e,t,r){"use strict";!function(){function e(e){return new Promise(function(t,r){e.onsuccess=function(){t(e.result)},e.onerror=function(){r(e.error)}})}function r(t,r,n){var a,s=new Promise(function(s,o){e(a=t[r].apply(t,n)).then(s,o)});return s.request=a,s}function n(e,t,r){r.forEach(function(r){Object.defineProperty(e.prototype,r,{get:function(){return this[t][r]},set:function(e){this[t][r]=e}})})}function a(e,t,n,a){a.forEach(function(a){a in n.prototype&&(e.prototype[a]=function(){return r(this[t],a,arguments)})})}function s(e,t,r,n){n.forEach(function(n){n in r.prototype&&(e.prototype[n]=function(){return this[t][n].apply(this[t],arguments)})})}function o(e,t,n,a){a.forEach(function(a){a in n.prototype&&(e.prototype[a]=function(){return e=this[t],(n=r(e,a,arguments)).then(function(e){if(e)return new c(e,n.request)});var e,n})})}function i(e){this._index=e}function c(e,t){this._cursor=e,this._request=t}function l(e){this._store=e}function u(e){this._tx=e,this.complete=new Promise(function(t,r){e.oncomplete=function(){t()},e.onerror=function(){r(e.error)},e.onabort=function(){r(e.error)}})}function d(e,t,r){this._db=e,this.oldVersion=t,this.transaction=new u(r)}function m(e){this._db=e}n(i,"_index",["name","keyPath","multiEntry","unique"]),a(i,"_index",IDBIndex,["get","getKey","getAll","getAllKeys","count"]),o(i,"_index",IDBIndex,["openCursor","openKeyCursor"]),n(c,"_cursor",["direction","key","primaryKey","value"]),a(c,"_cursor",IDBCursor,["update","delete"]),["advance","continue","continuePrimaryKey"].forEach(function(t){t in IDBCursor.prototype&&(c.prototype[t]=function(){var r=this,n=arguments;return Promise.resolve().then(function(){return r._cursor[t].apply(r._cursor,n),e(r._request).then(function(e){if(e)return new c(e,r._request)})})})}),l.prototype.createIndex=function(){return new i(this._store.createIndex.apply(this._store,arguments))},l.prototype.index=function(){return new i(this._store.index.apply(this._store,arguments))},n(l,"_store",["name","keyPath","indexNames","autoIncrement"]),a(l,"_store",IDBObjectStore,["put","add","delete","clear","get","getAll","getKey","getAllKeys","count"]),o(l,"_store",IDBObjectStore,["openCursor","openKeyCursor"]),s(l,"_store",IDBObjectStore,["deleteIndex"]),u.prototype.objectStore=function(){return new l(this._tx.objectStore.apply(this._tx,arguments))},n(u,"_tx",["objectStoreNames","mode"]),s(u,"_tx",IDBTransaction,["abort"]),d.prototype.createObjectStore=function(){return new l(this._db.createObjectStore.apply(this._db,arguments))},n(d,"_db",["name","version","objectStoreNames"]),s(d,"_db",IDBDatabase,["deleteObjectStore","close"]),m.prototype.transaction=function(){return new u(this._db.transaction.apply(this._db,arguments))},n(m,"_db",["name","version","objectStoreNames"]),s(m,"_db",IDBDatabase,["close"]),["openCursor","openKeyCursor"].forEach(function(e){[l,i].forEach(function(t){e in t.prototype&&(t.prototype[e.replace("open","iterate")]=function(){var t,r=(t=arguments,Array.prototype.slice.call(t)),n=r[r.length-1],a=this._store||this._index,s=a[e].apply(a,r.slice(0,-1));s.onsuccess=function(){n(s.result)}})})}),[i,l].forEach(function(e){e.prototype.getAll||(e.prototype.getAll=function(e,t){var r=this,n=[];return new Promise(function(a){r.iterateCursor(e,function(e){e?(n.push(e.value),void 0===t||n.length!=t?e.continue():a(n)):a(n)})})})});var p={open:function(e,t,n){var a=r(indexedDB,"open",[e,t]),s=a.request;return s&&(s.onupgradeneeded=function(e){n&&n(new d(s.result,e.oldVersion,s.transaction))}),a.then(function(e){return new m(e)})},delete:function(e){return r(indexedDB,"deleteDatabase",[e])}};void 0!==t?(t.exports=p,t.exports.default=t.exports):self.idb=p}()},{}]},{},[4]);