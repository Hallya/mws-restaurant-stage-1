(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),_indexedb=require("./indexedb"),_indexedb2=_interopRequireDefault(_indexedb);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var DBHelper=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"fetchRestaurants",value:function(){return fetch(e.DATABASE_URL).then(function(e){return e.json()}).then(function(e){return window.navigator.standalone?e.restaurants:e}).catch(function(e){return console.error("Request failed. Returned status of "+e)})}},{key:"fetchRestaurantById",value:function(t){return _indexedb2.default.get("restaurants",Number(t)).then(function(n){return n||(console.log("No cache found"),fetch(e.DATABASE_URL).then(function(e){return e.json()}).then(function(e){var n=e.restaurants[t-1];return _indexedb2.default.set("restaurants",n),n}).catch(function(e){return console.error("Restaurant does not exist: "+e)}))})}},{key:"fetchRestaurantByCuisine",value:function(t){return e.fetchRestaurants().then(function(e){return e.restaurants.filter(function(e){return e.cuisine_type==t})}).catch(function(e){return console.error(e)})}},{key:"fetchRestaurantByNeighborhood",value:function(t){return e.fetchRestaurants().then(function(e){return e.restaurants.filter(function(e){return e.neighborhood==t})}).catch(function(e){return console.error(e)})}},{key:"fetchRestaurantByCuisineAndNeighborhood",value:function(t,n){return _indexedb2.default.getAll("restaurants").then(function(r){return r.length<10?e.fetchRestaurants().then(function(r){var u=r;return u.forEach(function(e){return _indexedb2.default.set("restaurants",e)}),e.filterResults(u,t,n)}).catch(function(e){return console.error(e)}):e.filterResults(r,t,n)}).catch(function(e){return console.error(e)})}},{key:"filterResults",value:function(e,t,n){return"all"!==t&&(e=e.filter(function(e){return e.cuisine_type==t})),"all"!==n&&(e=e.filter(function(e){return e.neighborhood==n})),e}},{key:"fetchNeighborhoods",value:function(){return e.fetchRestaurants().then(function(e){var t=e.map(function(e){return e.neighborhood});return t.filter(function(e,n){return t.indexOf(e)==n})}).catch(function(e){return console.error(e)})}},{key:"fetchCuisines",value:function(){return e.fetchRestaurants().then(function(e){var t=e.map(function(e){return e.cuisine_type});return t.filter(function(e,n){return t.indexOf(e)==n})}).catch(function(e){return console.error(e)})}},{key:"urlForRestaurant",value:function(e){return"restaurant.html?id="+e.id}},{key:"imageUrlForRestaurant",value:function(e){return"assets/img/jpg/"+e.photograph}},{key:"imageWebpUrlForRestaurant",value:function(e){return"assets/img/webp/"+e.photograph}},{key:"mapMarkerForRestaurant",value:function(t,n){return new google.maps.Marker({position:t.latlng,title:t.name,url:e.urlForRestaurant(t),map:n,animation:google.maps.Animation.DROP})}},{key:"DATABASE_URL",get:function(){return window.navigator.standalone?"data/restaurants.json":"http://localhost:1337/restaurants"}}]),e}();exports.default=DBHelper;
},{"./indexedb":3}],2:[function(require,module,exports){
"use strict";function activateLazyLoading(){var e=[].slice.call(document.querySelectorAll(".lazy"));if("IntersectionObserver"in window){var t=new IntersectionObserver(function(e,n){e.forEach(function(e){if(e.isIntersecting){var n=e.target;"source"===n.localName?n.srcset=n.dataset.srcset:n.src=n.dataset.src,n.classList.remove("lazy"),t.unobserve(n)}})});e.forEach(function(e){t.observe(e)})}else{var n=[].slice.call(document.querySelectorAll(".lazy")),o=!1,r=function e(){!1===o&&(o=!0,setTimeout(function(){n.forEach(function(t){t.getBoundingClientRect().top<=window.innerHeight+50&&t.getBoundingClientRect().bottom>=0&&"none"!==getComputedStyle(t).display&&(t.src=t.dataset.src,t.srcset=t.dataset.srcset,t.classList.remove("lazy"),0===(n=n.filter(function(e){return e!==t})).length&&(document.removeEventListener("scroll",e),window.removeEventListener("resize",e),window.removeEventListener("orientationchange",e)))}),o=!1},200))};document.addEventListener("scroll",r),window.addEventListener("resize",r),window.addEventListener("orientationchange",r),"complete"===window.document.readyState&&r()}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=activateLazyLoading;
},{}],3:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _idb=require("../node_modules/idb/lib/idb"),_idb2=_interopRequireDefault(_idb);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var openDatabase=function(){if(navigator.serviceWorker)return _idb2.default.open("restaurant-reviews",1,function(e){switch(e.oldVersion){case 0:e.createObjectStore("restaurants",{keyPath:"id"})}})},idbKey={get:function(e,t){return openDatabase().then(function(r){if(r)return r.transaction(e).objectStore(e).get(t)}).catch(function(e){return console.error(e)})},set:function(e,t){return openDatabase().then(function(r){if(r){var n=r.transaction(e,"readwrite");return n.objectStore(e).put(t),n.complete}}).catch(function(e){return console.error(e)})},getAll:function(e){return openDatabase().then(function(t){if(t)return t.transaction(e).objectStore(e).getAll()}).catch(function(e){return console.error(e)})}};self.idbKey=idbKey,exports.default=idbKey;
},{"../node_modules/idb/lib/idb":5}],4:[function(require,module,exports){
"use strict";var _dbhelper=require("./dbhelper"),_dbhelper2=_interopRequireDefault(_dbhelper),_helpers=require("./helpers"),_helpers2=_interopRequireDefault(_helpers);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var restaurants=void 0,neighborhoods=void 0,cuisines=void 0,markers=[],mainContent=document.querySelector("main"),footer=document.querySelector("footer"),filterOptions=document.querySelector(".filter-options"),filterResultHeading=document.querySelector(".filter-options h3"),filterButton=document.querySelector("#menuFilter"),listOfRestaurants=document.querySelector("#restaurants-list"),sectionMap=document.querySelector("#map-container"),neighborhoodsSelect=document.querySelector("#neighborhoods-select"),cuisinesSelect=document.querySelector("#cuisines-select"),mapDiv=document.querySelector("#map"),loader=document.querySelector("#map-loader");function openMenu(){filterOptions.classList.remove("optionsClose"),mainContent.classList.remove("moveUp"),footer.classList.remove("moveUp"),filterOptions.classList.add("optionsOpen"),filterOptions.setAttribute("aria-hidden","false"),mainContent.classList.add("moveDown"),footer.classList.add("moveDown"),filterButton.classList.add("pressed"),filterButton.blur(),filterResultHeading.setAttribute("tabindex","-1"),filterResultHeading.focus()}function closeMenu(){filterOptions.classList.remove("optionsOpen"),filterOptions.classList.add("optionsClose"),filterOptions.setAttribute("aria-hidden","true"),filterButton.classList.remove("pressed"),mainContent.classList.remove("moveDown"),mainContent.classList.add("moveUp"),footer.classList.remove("moveDown"),footer.classList.add("moveUp"),filterResultHeading.removeAttribute("tabindex")}document.addEventListener("DOMContentLoaded",function(){window.navigator.standalone||-1!==window.navigator.userAgent.indexOf("Android")&&-1!==window.navigator.userAgent.indexOf("Linux")||addToHomeScreen(),fetchNeighborhoods(),fetchCuisines()}),filterButton.addEventListener("click",function(){filterOptions.classList.contains("optionsClose")?openMenu():closeMenu()}),"serviceWorker"in navigator&&window.addEventListener("load",function(){var e="hallya.github.io"===window.location.hostname?"/mws-restaurant-stage-1/sw.js":"../sw.js";navigator.serviceWorker.register(e).then(function(e){return console.log("registration to serviceWorker complete with scope :",e.scope)})}),document.onkeypress=function(e){13===e.charCode&&filterOptions.classList.contains("optionsOpen")&&(closeMenu(),listOfRestaurants.setAttribute("tabindex","0"),listOfRestaurants.focus())};var fetchNeighborhoods=function(){_dbhelper2.default.fetchNeighborhoods().then(function(e){self.neighborhoods=e,fillNeighborhoodsHTML()}).catch(function(e){return console.error(e)})},fillNeighborhoodsHTML=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:self.neighborhoods,t=neighborhoodsSelect;e.forEach(function(a){var r=document.createElement("option");r.innerHTML=a,r.value=a,r.setAttribute("role","option"),r.setAttribute("aria-setsize","4"),r.setAttribute("aria-posinset",e.indexOf(a)+2),t.append(r)})},fetchCuisines=function(){_dbhelper2.default.fetchCuisines().then(function(e){self.cuisines=e,fillCuisinesHTML()}).catch(function(e){return console.error(e)})},fillCuisinesHTML=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:self.cuisines,t=cuisinesSelect;e.forEach(function(a){var r=document.createElement("option");r.innerHTML=a,r.value=a,r.setAttribute("role","option"),r.setAttribute("aria-setsize","4"),r.setAttribute("aria-posinset",e.indexOf(a)+2),t.append(r)})};window.initMap=function(){self.map=new google.maps.Map(document.getElementById("map"),{zoom:12,center:{lat:40.722216,lng:-73.987501},scrollwheel:!1}),updateRestaurants()};var updateRestaurants=function(){var e=cuisinesSelect,t=neighborhoodsSelect,a=e.selectedIndex,r=t.selectedIndex,n=e[a].value,s=t[r].value;_dbhelper2.default.fetchRestaurantByCuisineAndNeighborhood(n,s).then(function(e){resetRestaurants(e),fillRestaurantsHTML(),(0,_helpers2.default)()}).catch(function(e){return console.error(e)})},resetRestaurants=function(e){self.restaurants=[],document.getElementById("restaurants-list").innerHTML="",markers.length>0&&self.markers.forEach(function(e){return e.setMap(null)}),self.markers=[],self.restaurants=e},fillRestaurantsHTML=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:self.restaurants,t=document.getElementById("restaurants-list");e.forEach(function(e){t.append(createRestaurantHTML(e))}),addMarkersToMap()},getAverageNote=function(e){var t=0;return e.forEach(function(e){t+=Number(e.rating)}),t/=e.length,Math.round(10*t)/10},createRestaurantHTML=function(e){var t=document.createElement("li"),a=document.createElement("figure"),r=document.createElement("figcaption"),n=document.createElement("picture"),s=document.createElement("source"),i=document.createElement("source"),o=document.createElement("source"),l=document.createElement("source"),d=document.createElement("source"),u=document.createElement("source"),c=document.createElement("img"),p=document.createElement("aside"),m=document.createElement("p");l.dataset.srcset=_dbhelper2.default.imageWebpUrlForRestaurant(e)+"-large_x1.webp 1x, "+_dbhelper2.default.imageWebpUrlForRestaurant(e)+"-large_x2.webp 2x",l.srcset=_dbhelper2.default.imageWebpUrlForRestaurant(e)+"-lazy.webp",l.media="(min-width: 1000px)",l.className="lazy",l.type="image/webp",s.dataset.srcset=_dbhelper2.default.imageUrlForRestaurant(e)+"-large_x1.jpg 1x, "+_dbhelper2.default.imageUrlForRestaurant(e)+"-large_x2.jpg 2x",s.srcset=_dbhelper2.default.imageUrlForRestaurant(e)+"-lazy.jpg",s.media="(min-width: 1000px)",s.className="lazy",s.type="image/jpeg",d.dataset.srcset=_dbhelper2.default.imageWebpUrlForRestaurant(e)+"-medium_x1.webp 1x, "+_dbhelper2.default.imageWebpUrlForRestaurant(e)+"-medium_x2.webp 2x",d.srcset=_dbhelper2.default.imageWebpUrlForRestaurant(e)+"-lazy.webp",d.media="(min-width: 420px)",d.className="lazy",d.type="image/webp",i.dataset.srcset=_dbhelper2.default.imageUrlForRestaurant(e)+"-medium_x1.jpg 1x, "+_dbhelper2.default.imageUrlForRestaurant(e)+"-medium_x2.jpg 2x",i.srcset=_dbhelper2.default.imageUrlForRestaurant(e)+"-lazy.jpg",i.media="(min-width: 420px)",i.className="lazy",i.type="image/jpeg",u.dataset.srcset=_dbhelper2.default.imageWebpUrlForRestaurant(e)+"-small_x2.webp 2x, "+_dbhelper2.default.imageWebpUrlForRestaurant(e)+"-small_x1.webp 1x",u.srcset=_dbhelper2.default.imageWebpUrlForRestaurant(e)+"-lazy.webp",u.media="(min-width: 320px)",u.className="lazy",u.type="image/webp",o.dataset.srcset=_dbhelper2.default.imageUrlForRestaurant(e)+"-small_x2.jpg 2x, "+_dbhelper2.default.imageUrlForRestaurant(e)+"-small_x1.jpg 1x",o.srcset=_dbhelper2.default.imageUrlForRestaurant(e)+"-lazy.jpg",o.media="(min-width: 320px)",o.className="lazy",o.type="image/jpeg",c.dataset.src=_dbhelper2.default.imageUrlForRestaurant(e)+"-small_x1.jpg",c.src=_dbhelper2.default.imageUrlForRestaurant(e)+"-lazy.jpg",c.className="restaurant-img lazy",c.setAttribute("sizes","(max-width: 1100px) 85vw, (min-width: 1101px) 990px"),c.alt=e.name+"'s restaurant",c.type="image/jpeg",m.innerHTML=getAverageNote(e.reviews)+"/5",p.append(m),n.append(l),n.append(s),n.append(d),n.append(i),n.append(u),n.append(o),n.append(c),a.append(n),a.append(r),t.append(p),t.append(a);var f=document.createElement("h2");f.innerHTML=e.name,r.append(f);var h=document.createElement("p");h.innerHTML=e.neighborhood,t.append(h);var g=document.createElement("p");g.innerHTML=e.address,t.append(g);var b=document.createElement("a");return b.innerHTML="View Details",b.href=_dbhelper2.default.urlForRestaurant(e),b.setAttribute("aria-label","View details of "+e.name),b.setAttribute("rel","noopener"),t.append(b),t.setAttribute("role","listitem"),t.setAttribute("aria-setsize","10"),t.setAttribute("aria-posinset",e.id),t},addMarkersToMap=function(){(arguments.length>0&&void 0!==arguments[0]?arguments[0]:self.restaurants).forEach(function(e){var t=_dbhelper2.default.mapMarkerForRestaurant(e,self.map);google.maps.event.addListener(t,"click",function(){window.location.href=t.url}),self.markers.push(t)})},addToHomeScreen=function(){var e=document.createElement("aside"),t=document.createElement("p"),a=document.createElement("p"),r=document.createElement("span");e.id="pop",e.className="popup",a.className="popup msg",a.setAttribute("tabindex","2"),t.className="popup note",t.setAttribute("tabindex","1"),r.className="iconicfill-arrow-down",t.innerHTML="(Tap to close)",a.innerHTML='Add <img src="assets/img/svg/share-apple.svg" alt=""> this app to your home screen and enjoy it as a real application !',e.setAttribute("tabindex","-1"),e.addEventListener("click",function(){e.classList.add("hide"),setTimeout(function(){e.style="display: none;"},1e3)}),e.append(t),e.append(a),e.append(r),document.getElementById("maincontent").appendChild(e),e.focus(),setTimeout(function(){e.classList.add("hide")},7e3)};
},{"./dbhelper":1,"./helpers":2}],5:[function(require,module,exports){
"use strict";!function(){function e(e){return new Promise(function(t,n){e.onsuccess=function(){t(e.result)},e.onerror=function(){n(e.error)}})}function t(t,n,o){var r,i=new Promise(function(i,u){e(r=t[n].apply(t,o)).then(i,u)});return i.request=r,i}function n(e,t,n){n.forEach(function(n){Object.defineProperty(e.prototype,n,{get:function(){return this[t][n]},set:function(e){this[t][n]=e}})})}function o(e,n,o,r){r.forEach(function(r){r in o.prototype&&(e.prototype[r]=function(){return t(this[n],r,arguments)})})}function r(e,t,n,o){o.forEach(function(o){o in n.prototype&&(e.prototype[o]=function(){return this[t][o].apply(this[t],arguments)})})}function i(e,n,o,r){r.forEach(function(r){r in o.prototype&&(e.prototype[r]=function(){return e=this[n],(o=t(e,r,arguments)).then(function(e){if(e)return new c(e,o.request)});var e,o})})}function u(e){this._index=e}function c(e,t){this._cursor=e,this._request=t}function s(e){this._store=e}function a(e){this._tx=e,this.complete=new Promise(function(t,n){e.oncomplete=function(){t()},e.onerror=function(){n(e.error)},e.onabort=function(){n(e.error)}})}function p(e,t,n){this._db=e,this.oldVersion=t,this.transaction=new a(n)}function f(e){this._db=e}n(u,"_index",["name","keyPath","multiEntry","unique"]),o(u,"_index",IDBIndex,["get","getKey","getAll","getAllKeys","count"]),i(u,"_index",IDBIndex,["openCursor","openKeyCursor"]),n(c,"_cursor",["direction","key","primaryKey","value"]),o(c,"_cursor",IDBCursor,["update","delete"]),["advance","continue","continuePrimaryKey"].forEach(function(t){t in IDBCursor.prototype&&(c.prototype[t]=function(){var n=this,o=arguments;return Promise.resolve().then(function(){return n._cursor[t].apply(n._cursor,o),e(n._request).then(function(e){if(e)return new c(e,n._request)})})})}),s.prototype.createIndex=function(){return new u(this._store.createIndex.apply(this._store,arguments))},s.prototype.index=function(){return new u(this._store.index.apply(this._store,arguments))},n(s,"_store",["name","keyPath","indexNames","autoIncrement"]),o(s,"_store",IDBObjectStore,["put","add","delete","clear","get","getAll","getKey","getAllKeys","count"]),i(s,"_store",IDBObjectStore,["openCursor","openKeyCursor"]),r(s,"_store",IDBObjectStore,["deleteIndex"]),a.prototype.objectStore=function(){return new s(this._tx.objectStore.apply(this._tx,arguments))},n(a,"_tx",["objectStoreNames","mode"]),r(a,"_tx",IDBTransaction,["abort"]),p.prototype.createObjectStore=function(){return new s(this._db.createObjectStore.apply(this._db,arguments))},n(p,"_db",["name","version","objectStoreNames"]),r(p,"_db",IDBDatabase,["deleteObjectStore","close"]),f.prototype.transaction=function(){return new a(this._db.transaction.apply(this._db,arguments))},n(f,"_db",["name","version","objectStoreNames"]),r(f,"_db",IDBDatabase,["close"]),["openCursor","openKeyCursor"].forEach(function(e){[s,u].forEach(function(t){t.prototype[e.replace("open","iterate")]=function(){var t,n=(t=arguments,Array.prototype.slice.call(t)),o=n[n.length-1],r=this._store||this._index,i=r[e].apply(r,n.slice(0,-1));i.onsuccess=function(){o(i.result)}}})}),[u,s].forEach(function(e){e.prototype.getAll||(e.prototype.getAll=function(e,t){var n=this,o=[];return new Promise(function(r){n.iterateCursor(e,function(e){e?(o.push(e.value),void 0===t||o.length!=t?e.continue():r(o)):r(o)})})})});var d={open:function(e,n,o){var r=t(indexedDB,"open",[e,n]),i=r.request;return i.onupgradeneeded=function(e){o&&o(new p(i.result,e.oldVersion,i.transaction))},r.then(function(e){return new f(e)})},delete:function(e){return t(indexedDB,"deleteDatabase",[e])}};"undefined"!=typeof module?(module.exports=d,module.exports.default=module.exports):self.idb=d}();
},{}]},{},[4]);
