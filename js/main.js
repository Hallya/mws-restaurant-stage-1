/* global DBHelper */
let restaurants;
let neighborhoods;
let cuisines;

// var map;
var markers = [];

const mainContent = document.querySelector('main'),
      footer = document.querySelector('footer'),
      filterOptions = document.querySelector('.filter-options'),
      filterResultHeading = document.querySelector('.filter-options h2'),
      filterButton = document.querySelector('#menuFilter'),
      listOfRestaurants = document.querySelector('#restaurants-list'),

// sectionRestaurantsList = document.querySelector('#list-container'),
sectionMap = document.querySelector('#map-container'),
      neighborhoodsSelect = document.querySelector('#neighborhoods-select'),
      cuisinesSelect = document.querySelector('#cuisines-select');

/**
 * Fetch neighborhoods and cuisines as soon as the page is loaded.
 */
document.addEventListener('DOMContentLoaded', () => {
  fetchNeighborhoods();
  fetchCuisines();
});

/**
 * Register to service worker if the browser is compatible.
 */
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('sw.js').then(registration => {
      console.log('registration to serviceWorker complete with scope :', registration.scope);
    });
  });
}

document.onkeypress = function (e) {
  console.log(e.code);
  if (e.charCode === 13 && filterOptions.classList.contains('optionsOpen')) {
    closeMenu();
    console.log(sectionMap.clientHeight);
    listOfRestaurants.setAttribute('tabindex', '0');
    listOfRestaurants.focus();
    // window.scrollTo(0, sectionMap.clientHeight*2);
  }
};

function openMenu() {
  filterOptions.classList.remove('optionsClose');
  mainContent.classList.remove('moveUp');
  footer.classList.remove('moveUp');
  filterOptions.classList.add('optionsOpen');
  filterOptions.setAttribute('aria-hidden', 'false');
  mainContent.classList.add('moveDown');
  footer.classList.add('moveDown');
  filterButton.classList.add('pressed');
  filterButton.blur();
  filterResultHeading.setAttribute('tabindex', '-1');
  filterResultHeading.focus();
}

function closeMenu() {
  filterOptions.classList.remove('optionsOpen');
  filterOptions.classList.add('optionsClose');
  filterOptions.setAttribute('aria-hidden', 'true');
  filterButton.classList.remove('pressed');
  mainContent.classList.remove('moveDown');
  mainContent.classList.add('moveUp');
  footer.classList.remove('moveDown');
  footer.classList.add('moveUp');
  filterResultHeading.removeAttribute('tabindex');
}

filterButton.addEventListener('click', () => {
  if (filterOptions.classList.contains('optionsClose')) {
    openMenu();
  } else {
    closeMenu();
  }
});

/**
 * Fetch all neighborhoods and set their HTML.
 */
const fetchNeighborhoods = () => {
  DBHelper.fetchNeighborhoods().then(neighborhoods => {
    self.neighborhoods = neighborhoods;
    fillNeighborhoodsHTML();
  }).catch(error => console.error(error));
};

/**
 * Set neighborhoods HTML.
 */
const fillNeighborhoodsHTML = (neighborhoods = self.neighborhoods) => {
  const select = neighborhoodsSelect;
  neighborhoods.forEach(neighborhood => {
    const option = document.createElement('option');
    option.innerHTML = neighborhood;
    option.value = neighborhood;
    option.setAttribute('role', 'option');
    option.setAttribute('aria-setsize', neighborhoods.length);
    select.append(option);
  });
};
/**
 * Fetch all cuisines and set their HTML.
 */
const fetchCuisines = () => {
  DBHelper.fetchCuisines().then(cuisines => {
    self.cuisines = cuisines;
    fillCuisinesHTML();
  }).catch(error => console.error(error));
};

/**
 * Set cuisines HTML.
 */
const fillCuisinesHTML = (cuisines = self.cuisines) => {
  const select = cuisinesSelect;
  cuisines.forEach(cuisine => {
    const option = document.createElement('option');
    option.setAttribute('role', 'option');
    option.innerHTML = cuisine;
    option.value = cuisine;
    option.setAttribute('aria-setsize', cuisines.length);
    select.append(option);
  });
};

/**
 * Initialize Google map, called from HTML.
 */
window.initMap = () => {
  let loc = {
    lat: 40.722216,
    lng: -73.987501
  };
  self.map = new google.maps.Map(document.getElementById('map'), {
    zoom: 12,
    center: loc,
    scrollwheel: false
  });
  updateRestaurants();
};

/**
 * Update page and map for current restaurants.
 */
const updateRestaurants = () => {
  const cSelect = cuisinesSelect;
  const nSelect = neighborhoodsSelect;

  const cIndex = cSelect.selectedIndex;
  const nIndex = nSelect.selectedIndex;

  const cuisine = cSelect[cIndex].value;
  const neighborhood = nSelect[nIndex].value;

  DBHelper.fetchRestaurantByCuisineAndNeighborhood(cuisine, neighborhood).then(restaurants => {
    resetRestaurants(restaurants);
    fillRestaurantsHTML();
  }).catch(error => console.error(error));
};

/**
 * Clear current restaurants, their HTML and remove their map markers.
 */
const resetRestaurants = restaurants => {
  // Remove all restaurants
  self.restaurants = [];
  const ul = document.getElementById('restaurants-list');
  ul.innerHTML = '';

  // Remove all map markers

  self.markers.forEach(m => m.setMap(null));
  self.markers = [];
  self.restaurants = restaurants;
};

/**
 * Create all restaurants HTML and add them to the webpage.
 */
const fillRestaurantsHTML = (restaurants = self.restaurants) => {
  const ul = document.getElementById('restaurants-list');
  restaurants.forEach(restaurant => {
    ul.append(createRestaurantHTML(restaurant));
    ul.setAttribute('aria-setsize', restaurants.length);
  });
  addMarkersToMap();
};

/**
 * Create restaurant HTML.
 */
const createRestaurantHTML = restaurant => {
  const li = document.createElement('li');

  const figure = document.createElement('figure');
  const figcaption = document.createElement('figcaption');
  const picture = document.createElement('picture');
  const source = document.createElement('source');
  const ndSource = document.createElement('source');
  const thSource = document.createElement('source');
  const image = document.createElement('img');

  source.srcset = `${DBHelper.imageUrlForRestaurant(restaurant)}-large_x1.jpg 1x, ${DBHelper.imageUrlForRestaurant(restaurant)}-large_x2.jpg 2x`;
  source.media = '(min-width: 1000px)';
  ndSource.srcset = `${DBHelper.imageUrlForRestaurant(restaurant)}-medium_x1.jpg 1x, ${DBHelper.imageUrlForRestaurant(restaurant)}-medium_x2.jpg 2x`;
  ndSource.media = '(min-width: 420px)';

  thSource.srcset = `${DBHelper.imageUrlForRestaurant(restaurant)}-small_x2.jpg 2x, ${DBHelper.imageUrlForRestaurant(restaurant)}-small_x1.jpg 1x`;
  thSource.media = '(min-width: 320px)';

  image.className = 'restaurant-img';
  image.src = `${DBHelper.imageUrlForRestaurant(restaurant)}-large_x1.jpg`;
  image.setAttribute('sizes', '(max-width: 1100px) 85vw, (min-width: 1101px) 990px');
  image.alt = `${restaurant.name}'s restaurant`;

  picture.append(source);
  picture.append(ndSource);
  picture.append(thSource);
  picture.append(image);
  figure.append(picture);
  figure.append(figcaption);

  li.append(figure);

  const name = document.createElement('h2');
  name.innerHTML = restaurant.name;
  figcaption.append(name);

  const neighborhood = document.createElement('p');
  neighborhood.innerHTML = restaurant.neighborhood;
  li.append(neighborhood);

  const address = document.createElement('p');
  address.innerHTML = restaurant.address;
  li.append(address);

  const more = document.createElement('a');
  more.innerHTML = 'View Details';
  more.href = DBHelper.urlForRestaurant(restaurant);
  more.setAttribute('aria-label', `View details of ${restaurant.name}`);
  li.append(more);

  return li;
};

/**
 * Add markers for current restaurants to the map.
 */
const addMarkersToMap = (restaurants = self.restaurants) => {
  restaurants.forEach(restaurant => {
    // Add marker to the map
    const marker = DBHelper.mapMarkerForRestaurant(restaurant, self.map);
    google.maps.event.addListener(marker, 'click', () => {
      window.location.href = marker.url;
    });
    self.markers.push(marker);
  });
};
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiXSwibmFtZXMiOlsicmVzdGF1cmFudHMiLCJuZWlnaGJvcmhvb2RzIiwiY3Vpc2luZXMiLCJtYXJrZXJzIiwibWFpbkNvbnRlbnQiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJmb290ZXIiLCJmaWx0ZXJPcHRpb25zIiwiZmlsdGVyUmVzdWx0SGVhZGluZyIsImZpbHRlckJ1dHRvbiIsImxpc3RPZlJlc3RhdXJhbnRzIiwic2VjdGlvbk1hcCIsIm5laWdoYm9yaG9vZHNTZWxlY3QiLCJjdWlzaW5lc1NlbGVjdCIsImFkZEV2ZW50TGlzdGVuZXIiLCJmZXRjaE5laWdoYm9yaG9vZHMiLCJmZXRjaEN1aXNpbmVzIiwibmF2aWdhdG9yIiwid2luZG93Iiwic2VydmljZVdvcmtlciIsInJlZ2lzdGVyIiwidGhlbiIsInJlZ2lzdHJhdGlvbiIsImNvbnNvbGUiLCJsb2ciLCJzY29wZSIsIm9ua2V5cHJlc3MiLCJlIiwiY29kZSIsImNoYXJDb2RlIiwiY2xhc3NMaXN0IiwiY29udGFpbnMiLCJjbG9zZU1lbnUiLCJjbGllbnRIZWlnaHQiLCJzZXRBdHRyaWJ1dGUiLCJmb2N1cyIsIm9wZW5NZW51IiwicmVtb3ZlIiwiYWRkIiwiYmx1ciIsInJlbW92ZUF0dHJpYnV0ZSIsIkRCSGVscGVyIiwic2VsZiIsImZpbGxOZWlnaGJvcmhvb2RzSFRNTCIsImNhdGNoIiwiZXJyb3IiLCJzZWxlY3QiLCJmb3JFYWNoIiwibmVpZ2hib3Job29kIiwib3B0aW9uIiwiY3JlYXRlRWxlbWVudCIsImlubmVySFRNTCIsInZhbHVlIiwibGVuZ3RoIiwiYXBwZW5kIiwiZmlsbEN1aXNpbmVzSFRNTCIsImN1aXNpbmUiLCJpbml0TWFwIiwibG9jIiwibGF0IiwibG5nIiwibWFwIiwiZ29vZ2xlIiwibWFwcyIsIk1hcCIsImdldEVsZW1lbnRCeUlkIiwiem9vbSIsImNlbnRlciIsInNjcm9sbHdoZWVsIiwidXBkYXRlUmVzdGF1cmFudHMiLCJjU2VsZWN0IiwiblNlbGVjdCIsImNJbmRleCIsInNlbGVjdGVkSW5kZXgiLCJuSW5kZXgiLCJmZXRjaFJlc3RhdXJhbnRCeUN1aXNpbmVBbmROZWlnaGJvcmhvb2QiLCJyZXNldFJlc3RhdXJhbnRzIiwiZmlsbFJlc3RhdXJhbnRzSFRNTCIsInVsIiwibSIsInNldE1hcCIsInJlc3RhdXJhbnQiLCJjcmVhdGVSZXN0YXVyYW50SFRNTCIsImFkZE1hcmtlcnNUb01hcCIsImxpIiwiZmlndXJlIiwiZmlnY2FwdGlvbiIsInBpY3R1cmUiLCJzb3VyY2UiLCJuZFNvdXJjZSIsInRoU291cmNlIiwiaW1hZ2UiLCJzcmNzZXQiLCJpbWFnZVVybEZvclJlc3RhdXJhbnQiLCJtZWRpYSIsImNsYXNzTmFtZSIsInNyYyIsImFsdCIsIm5hbWUiLCJhZGRyZXNzIiwibW9yZSIsImhyZWYiLCJ1cmxGb3JSZXN0YXVyYW50IiwibWFya2VyIiwibWFwTWFya2VyRm9yUmVzdGF1cmFudCIsImV2ZW50IiwiYWRkTGlzdGVuZXIiLCJsb2NhdGlvbiIsInVybCIsInB1c2giXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0EsSUFBSUEsV0FBSjtBQUNBLElBQUlDLGFBQUo7QUFDQSxJQUFJQyxRQUFKOztBQUVBO0FBQ0EsSUFBSUMsVUFBVSxFQUFkOztBQUVBLE1BQU1DLGNBQWNDLFNBQVNDLGFBQVQsQ0FBdUIsTUFBdkIsQ0FBcEI7QUFBQSxNQUNFQyxTQUFTRixTQUFTQyxhQUFULENBQXVCLFFBQXZCLENBRFg7QUFBQSxNQUVFRSxnQkFBZ0JILFNBQVNDLGFBQVQsQ0FBdUIsaUJBQXZCLENBRmxCO0FBQUEsTUFHRUcsc0JBQXNCSixTQUFTQyxhQUFULENBQXVCLG9CQUF2QixDQUh4QjtBQUFBLE1BSUVJLGVBQWVMLFNBQVNDLGFBQVQsQ0FBdUIsYUFBdkIsQ0FKakI7QUFBQSxNQUtFSyxvQkFBb0JOLFNBQVNDLGFBQVQsQ0FBdUIsbUJBQXZCLENBTHRCOztBQU1FO0FBQ0FNLGFBQWFQLFNBQVNDLGFBQVQsQ0FBdUIsZ0JBQXZCLENBUGY7QUFBQSxNQVFF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RCxDQVREIiwiZmlsZSI6Im1haW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKiBnbG9iYWwgREJIZWxwZXIgKi9cclxubGV0IHJlc3RhdXJhbnRzO1xyXG5sZXQgbmVpZ2hib3Job29kcztcclxubGV0IGN1aXNpbmVzO1xyXG5cclxuLy8gdmFyIG1hcDtcclxudmFyIG1hcmtlcnMgPSBbXTtcclxuXHJcbmNvbnN0IG1haW5Db250ZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignbWFpbicpLFxyXG4gIGZvb3RlciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2Zvb3RlcicpLFxyXG4gIGZpbHRlck9wdGlvbnMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuZmlsdGVyLW9wdGlvbnMnKSxcclxuICBmaWx0ZXJSZXN1bHRIZWFkaW5nID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmZpbHRlci1vcHRpb25zIGgyJyksXHJcbiAgZmlsdGVyQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI21lbnVGaWx0ZXInKSxcclxuICBsaXN0T2ZSZXN0YXVyYW50cyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNyZXN0YXVyYW50cy1saXN0JyksXHJcbiAgLy8gc2VjdGlvblJlc3RhdXJhbnRzTGlzdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNsaXN0LWNvbnRhaW5lcicpLFxyXG4gIHNlY3Rpb25NYXAgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjbWFwLWNvbnRhaW5lcicpLFxyXG4gIG5laWdoYm9yaG9vZHNTZWxlY3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjbmVpZ2hib3Job29kcy1zZWxlY3QnKSxcclxuICBjdWlzaW5lc1NlbGVjdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNjdWlzaW5lcy1zZWxlY3QnKTtcclxuXHJcbi8qKlxyXG4gKiBGZXRjaCBuZWlnaGJvcmhvb2RzIGFuZCBjdWlzaW5lcyBhcyBzb29uIGFzIHRoZSBwYWdlIGlzIGxvYWRlZC5cclxuICovXHJcbmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ0RPTUNvbnRlbnRMb2FkZWQnLCAoKSA9PiB7XHJcbiAgZmV0Y2hOZWlnaGJvcmhvb2RzKCk7XHJcbiAgZmV0Y2hDdWlzaW5lcygpO1xyXG59KTtcclxuXHJcblxyXG4vKipcclxuICogUmVnaXN0ZXIgdG8gc2VydmljZSB3b3JrZXIgaWYgdGhlIGJyb3dzZXIgaXMgY29tcGF0aWJsZS5cclxuICovXHJcbmlmICgnc2VydmljZVdvcmtlcicgaW4gbmF2aWdhdG9yKSB7XHJcbiAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2xvYWQnLCAoKSA9PiB7XHJcbiAgICBuYXZpZ2F0b3Iuc2VydmljZVdvcmtlci5yZWdpc3Rlcignc3cuanMnKS50aGVuKHJlZ2lzdHJhdGlvbiA9PiB7XHJcbiAgICAgIGNvbnNvbGUubG9nKCdyZWdpc3RyYXRpb24gdG8gc2VydmljZVdvcmtlciBjb21wbGV0ZSB3aXRoIHNjb3BlIDonLCByZWdpc3RyYXRpb24uc2NvcGUpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcbn1cclxuXHJcbmRvY3VtZW50Lm9ua2V5cHJlc3MgPSBmdW5jdGlvbiAoZSkge1xyXG4gIGNvbnNvbGUubG9nKGUuY29kZSk7XHJcbiAgaWYgKGUuY2hhckNvZGUgPT09IDEzICYmIGZpbHRlck9wdGlvbnMuY2xhc3NMaXN0LmNvbnRhaW5zKCdvcHRpb25zT3BlbicpKSB7XHJcbiAgICBjbG9zZU1lbnUoKTtcclxuICAgIGNvbnNvbGUubG9nKHNlY3Rpb25NYXAuY2xpZW50SGVpZ2h0KTtcclxuICAgIGxpc3RPZlJlc3RhdXJhbnRzLnNldEF0dHJpYnV0ZSgndGFiaW5kZXgnLCAnMCcpO1xyXG4gICAgbGlzdE9mUmVzdGF1cmFudHMuZm9jdXMoKTtcclxuICAgIC8vIHdpbmRvdy5zY3JvbGxUbygwLCBzZWN0aW9uTWFwLmNsaWVudEhlaWdodCoyKTtcclxuICB9XHJcbn07XHJcblxyXG5mdW5jdGlvbiBvcGVuTWVudSgpIHtcclxuICBmaWx0ZXJPcHRpb25zLmNsYXNzTGlzdC5yZW1vdmUoJ29wdGlvbnNDbG9zZScpO1xyXG4gIG1haW5Db250ZW50LmNsYXNzTGlzdC5yZW1vdmUoJ21vdmVVcCcpO1xyXG4gIGZvb3Rlci5jbGFzc0xpc3QucmVtb3ZlKCdtb3ZlVXAnKTtcclxuICBmaWx0ZXJPcHRpb25zLmNsYXNzTGlzdC5hZGQoJ29wdGlvbnNPcGVuJyk7XHJcbiAgZmlsdGVyT3B0aW9ucy5zZXRBdHRyaWJ1dGUoJ2FyaWEtaGlkZGVuJywgJ2ZhbHNlJyk7XHJcbiAgbWFpbkNvbnRlbnQuY2xhc3NMaXN0LmFkZCgnbW92ZURvd24nKTtcclxuICBmb290ZXIuY2xhc3NMaXN0LmFkZCgnbW92ZURvd24nKTtcclxuICBmaWx0ZXJCdXR0b24uY2xhc3NMaXN0LmFkZCgncHJlc3NlZCcpO1xyXG4gIGZpbHRlckJ1dHRvbi5ibHVyKCk7XHJcbiAgZmlsdGVyUmVzdWx0SGVhZGluZy5zZXRBdHRyaWJ1dGUoJ3RhYmluZGV4JywgJy0xJyk7XHJcbiAgZmlsdGVyUmVzdWx0SGVhZGluZy5mb2N1cygpO1xyXG59XHJcblxyXG5mdW5jdGlvbiBjbG9zZU1lbnUoKSB7XHJcbiAgZmlsdGVyT3B0aW9ucy5jbGFzc0xpc3QucmVtb3ZlKCdvcHRpb25zT3BlbicpO1xyXG4gIGZpbHRlck9wdGlvbnMuY2xhc3NMaXN0LmFkZCgnb3B0aW9uc0Nsb3NlJyk7XHJcbiAgZmlsdGVyT3B0aW9ucy5zZXRBdHRyaWJ1dGUoJ2FyaWEtaGlkZGVuJywgJ3RydWUnKTtcclxuICBmaWx0ZXJCdXR0b24uY2xhc3NMaXN0LnJlbW92ZSgncHJlc3NlZCcpO1xyXG4gIG1haW5Db250ZW50LmNsYXNzTGlzdC5yZW1vdmUoJ21vdmVEb3duJyk7XHJcbiAgbWFpbkNvbnRlbnQuY2xhc3NMaXN0LmFkZCgnbW92ZVVwJyk7XHJcbiAgZm9vdGVyLmNsYXNzTGlzdC5yZW1vdmUoJ21vdmVEb3duJyk7XHJcbiAgZm9vdGVyLmNsYXNzTGlzdC5hZGQoJ21vdmVVcCcpO1xyXG4gIGZpbHRlclJlc3VsdEhlYWRpbmcucmVtb3ZlQXR0cmlidXRlKCd0YWJpbmRleCcpO1xyXG59XHJcblxyXG5maWx0ZXJCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XHJcbiAgaWYgKGZpbHRlck9wdGlvbnMuY2xhc3NMaXN0LmNvbnRhaW5zKCdvcHRpb25zQ2xvc2UnKSkge1xyXG4gICAgb3Blbk1lbnUoKTtcclxuICB9IGVsc2Uge1xyXG4gICAgY2xvc2VNZW51KCk7XHJcbiAgfVxyXG59KTtcclxuXHJcbi8qKlxyXG4gKiBGZXRjaCBhbGwgbmVpZ2hib3Job29kcyBhbmQgc2V0IHRoZWlyIEhUTUwuXHJcbiAqL1xyXG5jb25zdCBmZXRjaE5laWdoYm9yaG9vZHMgPSAoKSA9PiB7XHJcbiAgREJIZWxwZXIuZmV0Y2hOZWlnaGJvcmhvb2RzKClcclxuICAgIC50aGVuKG5laWdoYm9yaG9vZHMgPT4ge1xyXG4gICAgICBzZWxmLm5laWdoYm9yaG9vZHMgPSBuZWlnaGJvcmhvb2RzO1xyXG4gICAgICBmaWxsTmVpZ2hib3Job29kc0hUTUwoKTtcclxuICAgIH0pXHJcbiAgICAuY2F0Y2goZXJyb3IgPT4gY29uc29sZS5lcnJvcihlcnJvcikpO1xyXG59O1xyXG5cclxuLyoqXHJcbiAqIFNldCBuZWlnaGJvcmhvb2RzIEhUTUwuXHJcbiAqL1xyXG5jb25zdCBmaWxsTmVpZ2hib3Job29kc0hUTUwgPSAobmVpZ2hib3Job29kcyA9IHNlbGYubmVpZ2hib3Job29kcykgPT4ge1xyXG4gIGNvbnN0IHNlbGVjdCA9IG5laWdoYm9yaG9vZHNTZWxlY3Q7XHJcbiAgbmVpZ2hib3Job29kcy5mb3JFYWNoKG5laWdoYm9yaG9vZCA9PiB7XHJcbiAgICBjb25zdCBvcHRpb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdvcHRpb24nKTtcclxuICAgIG9wdGlvbi5pbm5lckhUTUwgPSBuZWlnaGJvcmhvb2Q7XHJcbiAgICBvcHRpb24udmFsdWUgPSBuZWlnaGJvcmhvb2Q7XHJcbiAgICBvcHRpb24uc2V0QXR0cmlidXRlKCdyb2xlJywgJ29wdGlvbicpO1xyXG4gICAgb3B0aW9uLnNldEF0dHJpYnV0ZSgnYXJpYS1zZXRzaXplJywgbmVpZ2hib3Job29kcy5sZW5ndGgpO1xyXG4gICAgc2VsZWN0LmFwcGVuZChvcHRpb24pO1xyXG4gIH0pO1xyXG59O1xyXG4vKipcclxuICogRmV0Y2ggYWxsIGN1aXNpbmVzIGFuZCBzZXQgdGhlaXIgSFRNTC5cclxuICovXHJcbmNvbnN0IGZldGNoQ3Vpc2luZXMgPSAoKSA9PiB7XHJcbiAgREJIZWxwZXIuZmV0Y2hDdWlzaW5lcygpXHJcbiAgICAudGhlbihjdWlzaW5lcyA9PiB7XHJcbiAgICAgIHNlbGYuY3Vpc2luZXMgPSBjdWlzaW5lcztcclxuICAgICAgZmlsbEN1aXNpbmVzSFRNTCgpO1xyXG4gICAgfSlcclxuICAgIC5jYXRjaChlcnJvciA9PiBjb25zb2xlLmVycm9yKGVycm9yKSk7XHJcbn07XHJcblxyXG4vKipcclxuICogU2V0IGN1aXNpbmVzIEhUTUwuXHJcbiAqL1xyXG5jb25zdCBmaWxsQ3Vpc2luZXNIVE1MID0gKGN1aXNpbmVzID0gc2VsZi5jdWlzaW5lcykgPT4ge1xyXG4gIGNvbnN0IHNlbGVjdCA9IGN1aXNpbmVzU2VsZWN0O1xyXG4gIGN1aXNpbmVzLmZvckVhY2goY3Vpc2luZSA9PiB7XHJcbiAgICBjb25zdCBvcHRpb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdvcHRpb24nKTtcclxuICAgIG9wdGlvbi5zZXRBdHRyaWJ1dGUoJ3JvbGUnLCAnb3B0aW9uJyk7XHJcbiAgICBvcHRpb24uaW5uZXJIVE1MID0gY3Vpc2luZTtcclxuICAgIG9wdGlvbi52YWx1ZSA9IGN1aXNpbmU7XHJcbiAgICBvcHRpb24uc2V0QXR0cmlidXRlKCdhcmlhLXNldHNpemUnLCBjdWlzaW5lcy5sZW5ndGgpO1xyXG4gICAgc2VsZWN0LmFwcGVuZChvcHRpb24pO1xyXG4gIH0pO1xyXG59O1xyXG5cclxuLyoqXHJcbiAqIEluaXRpYWxpemUgR29vZ2xlIG1hcCwgY2FsbGVkIGZyb20gSFRNTC5cclxuICovXHJcbndpbmRvdy5pbml0TWFwID0gKCkgPT4ge1xyXG4gIGxldCBsb2MgPSB7XHJcbiAgICBsYXQ6IDQwLjcyMjIxNixcclxuICAgIGxuZzogLTczLjk4NzUwMVxyXG4gIH07XHJcbiAgc2VsZi5tYXAgPSBuZXcgZ29vZ2xlLm1hcHMuTWFwKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYXAnKSwge1xyXG4gICAgem9vbTogMTIsXHJcbiAgICBjZW50ZXI6IGxvYyxcclxuICAgIHNjcm9sbHdoZWVsOiBmYWxzZVxyXG4gIH0pO1xyXG4gIHVwZGF0ZVJlc3RhdXJhbnRzKCk7XHJcbn07XHJcblxyXG4vKipcclxuICogVXBkYXRlIHBhZ2UgYW5kIG1hcCBmb3IgY3VycmVudCByZXN0YXVyYW50cy5cclxuICovXHJcbmNvbnN0IHVwZGF0ZVJlc3RhdXJhbnRzID0gKCkgPT4ge1xyXG4gIGNvbnN0IGNTZWxlY3QgPSBjdWlzaW5lc1NlbGVjdDtcclxuICBjb25zdCBuU2VsZWN0ID0gbmVpZ2hib3Job29kc1NlbGVjdDtcclxuXHJcbiAgY29uc3QgY0luZGV4ID0gY1NlbGVjdC5zZWxlY3RlZEluZGV4O1xyXG4gIGNvbnN0IG5JbmRleCA9IG5TZWxlY3Quc2VsZWN0ZWRJbmRleDtcclxuXHJcbiAgY29uc3QgY3Vpc2luZSA9IGNTZWxlY3RbY0luZGV4XS52YWx1ZTtcclxuICBjb25zdCBuZWlnaGJvcmhvb2QgPSBuU2VsZWN0W25JbmRleF0udmFsdWU7XHJcblxyXG4gIERCSGVscGVyLmZldGNoUmVzdGF1cmFudEJ5Q3Vpc2luZUFuZE5laWdoYm9yaG9vZChjdWlzaW5lLCBuZWlnaGJvcmhvb2QpXHJcbiAgICAudGhlbihyZXN0YXVyYW50cyA9PiB7XHJcbiAgICAgIHJlc2V0UmVzdGF1cmFudHMocmVzdGF1cmFudHMpO1xyXG4gICAgICBmaWxsUmVzdGF1cmFudHNIVE1MKCk7XHJcbiAgICB9KS5jYXRjaChlcnJvciA9PiBjb25zb2xlLmVycm9yKGVycm9yKSk7XHJcbn07XHJcblxyXG4vKipcclxuICogQ2xlYXIgY3VycmVudCByZXN0YXVyYW50cywgdGhlaXIgSFRNTCBhbmQgcmVtb3ZlIHRoZWlyIG1hcCBtYXJrZXJzLlxyXG4gKi9cclxuY29uc3QgcmVzZXRSZXN0YXVyYW50cyA9IChyZXN0YXVyYW50cykgPT4ge1xyXG4gIC8vIFJlbW92ZSBhbGwgcmVzdGF1cmFudHNcclxuICBzZWxmLnJlc3RhdXJhbnRzID0gW107XHJcbiAgY29uc3QgdWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudHMtbGlzdCcpO1xyXG4gIHVsLmlubmVySFRNTCA9ICcnO1xyXG5cclxuICAvLyBSZW1vdmUgYWxsIG1hcCBtYXJrZXJzXHJcblxyXG4gIHNlbGYubWFya2Vycy5mb3JFYWNoKG0gPT4gbS5zZXRNYXAobnVsbCkpO1xyXG4gIHNlbGYubWFya2VycyA9IFtdO1xyXG4gIHNlbGYucmVzdGF1cmFudHMgPSByZXN0YXVyYW50cztcclxufTtcclxuXHJcbi8qKlxyXG4gKiBDcmVhdGUgYWxsIHJlc3RhdXJhbnRzIEhUTUwgYW5kIGFkZCB0aGVtIHRvIHRoZSB3ZWJwYWdlLlxyXG4gKi9cclxuY29uc3QgZmlsbFJlc3RhdXJhbnRzSFRNTCA9IChyZXN0YXVyYW50cyA9IHNlbGYucmVzdGF1cmFudHMpID0+IHtcclxuICBjb25zdCB1bCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50cy1saXN0Jyk7XHJcbiAgcmVzdGF1cmFudHMuZm9yRWFjaChyZXN0YXVyYW50ID0+IHtcclxuICAgIHVsLmFwcGVuZChjcmVhdGVSZXN0YXVyYW50SFRNTChyZXN0YXVyYW50KSk7XHJcbiAgICB1bC5zZXRBdHRyaWJ1dGUoJ2FyaWEtc2V0c2l6ZScsIHJlc3RhdXJhbnRzLmxlbmd0aCk7XHJcbiAgfSk7XHJcbiAgYWRkTWFya2Vyc1RvTWFwKCk7XHJcbn07XHJcblxyXG4vKipcclxuICogQ3JlYXRlIHJlc3RhdXJhbnQgSFRNTC5cclxuICovXHJcbmNvbnN0IGNyZWF0ZVJlc3RhdXJhbnRIVE1MID0gKHJlc3RhdXJhbnQpID0+IHtcclxuICBjb25zdCBsaSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpJyk7XHJcblxyXG4gIGNvbnN0IGZpZ3VyZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2ZpZ3VyZScpO1xyXG4gIGNvbnN0IGZpZ2NhcHRpb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdmaWdjYXB0aW9uJyk7XHJcbiAgY29uc3QgcGljdHVyZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3BpY3R1cmUnKTtcclxuICBjb25zdCBzb3VyY2UgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzb3VyY2UnKTtcclxuICBjb25zdCBuZFNvdXJjZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NvdXJjZScpO1xyXG4gIGNvbnN0IHRoU291cmNlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc291cmNlJyk7XHJcbiAgY29uc3QgaW1hZ2UgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbWcnKTtcclxuXHJcbiAgc291cmNlLnNyY3NldCA9IGAke0RCSGVscGVyLmltYWdlVXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KX0tbGFyZ2VfeDEuanBnIDF4LCAke0RCSGVscGVyLmltYWdlVXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KX0tbGFyZ2VfeDIuanBnIDJ4YDtcclxuICBzb3VyY2UubWVkaWEgPSAnKG1pbi13aWR0aDogMTAwMHB4KSc7XHJcbiAgbmRTb3VyY2Uuc3Jjc2V0ID0gYCR7REJIZWxwZXIuaW1hZ2VVcmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpfS1tZWRpdW1feDEuanBnIDF4LCAke0RCSGVscGVyLmltYWdlVXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KX0tbWVkaXVtX3gyLmpwZyAyeGA7XHJcbiAgbmRTb3VyY2UubWVkaWEgPSAnKG1pbi13aWR0aDogNDIwcHgpJztcclxuICBcclxuICB0aFNvdXJjZS5zcmNzZXQgPSBgJHtEQkhlbHBlci5pbWFnZVVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCl9LXNtYWxsX3gyLmpwZyAyeCwgJHtEQkhlbHBlci5pbWFnZVVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCl9LXNtYWxsX3gxLmpwZyAxeGA7XHJcbiAgdGhTb3VyY2UubWVkaWEgPSAnKG1pbi13aWR0aDogMzIwcHgpJztcclxuICBcclxuICBpbWFnZS5jbGFzc05hbWUgPSAncmVzdGF1cmFudC1pbWcnO1xyXG4gIGltYWdlLnNyYyA9IGAke0RCSGVscGVyLmltYWdlVXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KX0tbGFyZ2VfeDEuanBnYDtcclxuICBpbWFnZS5zZXRBdHRyaWJ1dGUoJ3NpemVzJywgJyhtYXgtd2lkdGg6IDExMDBweCkgODV2dywgKG1pbi13aWR0aDogMTEwMXB4KSA5OTBweCcpO1xyXG4gIGltYWdlLmFsdCA9IGAke3Jlc3RhdXJhbnQubmFtZX0ncyByZXN0YXVyYW50YDtcclxuICBcclxuICBwaWN0dXJlLmFwcGVuZChzb3VyY2UpO1xyXG4gIHBpY3R1cmUuYXBwZW5kKG5kU291cmNlKTtcclxuICBwaWN0dXJlLmFwcGVuZCh0aFNvdXJjZSk7XHJcbiAgcGljdHVyZS5hcHBlbmQoaW1hZ2UpO1xyXG4gIGZpZ3VyZS5hcHBlbmQocGljdHVyZSk7XHJcbiAgZmlndXJlLmFwcGVuZChmaWdjYXB0aW9uKTtcclxuICBcclxuICBsaS5hcHBlbmQoZmlndXJlKTtcclxuICBcclxuICBjb25zdCBuYW1lID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaDInKTtcclxuICBuYW1lLmlubmVySFRNTCA9IHJlc3RhdXJhbnQubmFtZTtcclxuICBmaWdjYXB0aW9uLmFwcGVuZChuYW1lKTtcclxuXHJcbiAgY29uc3QgbmVpZ2hib3Job29kID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xyXG4gIG5laWdoYm9yaG9vZC5pbm5lckhUTUwgPSByZXN0YXVyYW50Lm5laWdoYm9yaG9vZDtcclxuICBsaS5hcHBlbmQobmVpZ2hib3Job29kKTtcclxuXHJcbiAgY29uc3QgYWRkcmVzcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcclxuICBhZGRyZXNzLmlubmVySFRNTCA9IHJlc3RhdXJhbnQuYWRkcmVzcztcclxuICBsaS5hcHBlbmQoYWRkcmVzcyk7XHJcblxyXG4gIGNvbnN0IG1vcmUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJyk7XHJcbiAgbW9yZS5pbm5lckhUTUwgPSAnVmlldyBEZXRhaWxzJztcclxuICBtb3JlLmhyZWYgPSBEQkhlbHBlci51cmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpO1xyXG4gIG1vcmUuc2V0QXR0cmlidXRlKCdhcmlhLWxhYmVsJywgYFZpZXcgZGV0YWlscyBvZiAke3Jlc3RhdXJhbnQubmFtZX1gKTtcclxuICBsaS5hcHBlbmQobW9yZSk7XHJcblxyXG4gIHJldHVybiBsaTtcclxufTtcclxuXHJcbi8qKlxyXG4gKiBBZGQgbWFya2VycyBmb3IgY3VycmVudCByZXN0YXVyYW50cyB0byB0aGUgbWFwLlxyXG4gKi9cclxuY29uc3QgYWRkTWFya2Vyc1RvTWFwID0gKHJlc3RhdXJhbnRzID0gc2VsZi5yZXN0YXVyYW50cykgPT4ge1xyXG4gIHJlc3RhdXJhbnRzLmZvckVhY2gocmVzdGF1cmFudCA9PiB7XHJcbiAgICAvLyBBZGQgbWFya2VyIHRvIHRoZSBtYXBcclxuICAgIGNvbnN0IG1hcmtlciA9IERCSGVscGVyLm1hcE1hcmtlckZvclJlc3RhdXJhbnQocmVzdGF1cmFudCwgc2VsZi5tYXApO1xyXG4gICAgZ29vZ2xlLm1hcHMuZXZlbnQuYWRkTGlzdGVuZXIobWFya2VyLCAnY2xpY2snLCAoKSA9PiB7XHJcbiAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gbWFya2VyLnVybDtcclxuICAgIH0pO1xyXG4gICAgc2VsZi5tYXJrZXJzLnB1c2gobWFya2VyKTtcclxuICB9KTtcclxufTtcclxuXHJcblxyXG4iXX0=
