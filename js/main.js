/* global DBHelper */
let restaurants;
let neighborhoods;
let cuisines;

// var map;
var markers = [];

const mainContent = document.querySelector('main'),
      footer = document.querySelector('footer'),
      filterOptions = document.querySelector('.filter-options'),
      filterResultHeading = document.querySelector('.filter-options h3'),
      filterButton = document.querySelector('#menuFilter'),
      listOfRestaurants = document.querySelector('#restaurants-list'),

// sectionRestaurantsList = document.querySelector('#list-container'),
sectionMap = document.querySelector('#map-container'),
      neighborhoodsSelect = document.querySelector('#neighborhoods-select'),
      cuisinesSelect = document.querySelector('#cuisines-select');

/**
 * Fetch neighborhoods and cuisines as soon as the page is loaded.
 */
document.addEventListener('DOMContentLoaded', () => {
  fetchNeighborhoods();
  fetchCuisines();
});

/**
 * Register to service worker if the browser is compatible.
 */
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('sw.js').then(registration => {
      console.log('registration to serviceWorker complete with scope :', registration.scope);
    });
  });
}

document.onkeypress = function (e) {
  console.log(e.code);
  if (e.charCode === 13 && filterOptions.classList.contains('optionsOpen')) {
    closeMenu();
    console.log(sectionMap.clientHeight);
    listOfRestaurants.setAttribute('tabindex', '0');
    listOfRestaurants.focus();
    // window.scrollTo(0, sectionMap.clientHeight*2);
  }
};

function openMenu() {
  filterOptions.classList.remove('optionsClose');
  mainContent.classList.remove('moveUp');
  footer.classList.remove('moveUp');
  filterOptions.classList.add('optionsOpen');
  filterOptions.setAttribute('aria-hidden', 'false');
  mainContent.classList.add('moveDown');
  footer.classList.add('moveDown');
  filterButton.classList.add('pressed');
  filterButton.blur();
  filterResultHeading.setAttribute('tabindex', '-1');
  filterResultHeading.focus();
}

function closeMenu() {
  filterOptions.classList.remove('optionsOpen');
  filterOptions.classList.add('optionsClose');
  filterOptions.setAttribute('aria-hidden', 'true');
  filterButton.classList.remove('pressed');
  mainContent.classList.remove('moveDown');
  mainContent.classList.add('moveUp');
  footer.classList.remove('moveDown');
  footer.classList.add('moveUp');
  filterResultHeading.removeAttribute('tabindex');
}

filterButton.addEventListener('click', () => {
  if (filterOptions.classList.contains('optionsClose')) {
    openMenu();
  } else {
    closeMenu();
  }
});

/**
 * Fetch all neighborhoods and set their HTML.
 */
const fetchNeighborhoods = () => {
  DBHelper.fetchNeighborhoods().then(neighborhoods => {
    self.neighborhoods = neighborhoods;
    fillNeighborhoodsHTML();
  }).catch(error => console.error(error));
};

/**
 * Set neighborhoods HTML.
 */
const fillNeighborhoodsHTML = (neighborhoods = self.neighborhoods) => {
  const select = neighborhoodsSelect;
  neighborhoods.forEach(neighborhood => {
    const option = document.createElement('option');
    option.innerHTML = neighborhood;
    option.value = neighborhood;
    option.setAttribute('role', 'option');
    option.setAttribute('aria-setsize', neighborhoods.length);
    select.append(option);
  });
};
/**
 * Fetch all cuisines and set their HTML.
 */
const fetchCuisines = () => {
  DBHelper.fetchCuisines().then(cuisines => {
    self.cuisines = cuisines;
    fillCuisinesHTML();
  }).catch(error => console.error(error));
};

/**
 * Set cuisines HTML.
 */
const fillCuisinesHTML = (cuisines = self.cuisines) => {
  const select = cuisinesSelect;
  cuisines.forEach(cuisine => {
    const option = document.createElement('option');
    option.setAttribute('role', 'option');
    option.innerHTML = cuisine;
    option.value = cuisine;
    option.setAttribute('aria-setsize', cuisines.length);
    select.append(option);
  });
};

/**
 * Initialize Google map, called from HTML.
 */
window.initMap = () => {
  let loc = {
    lat: 40.722216,
    lng: -73.987501
  };
  self.map = new google.maps.Map(document.getElementById('map'), {
    zoom: 12,
    center: loc,
    scrollwheel: false
  });
  updateRestaurants();
};

/**
 * Update page and map for current restaurants.
 */
const updateRestaurants = () => {
  const cSelect = cuisinesSelect;
  const nSelect = neighborhoodsSelect;

  const cIndex = cSelect.selectedIndex;
  const nIndex = nSelect.selectedIndex;

  const cuisine = cSelect[cIndex].value;
  const neighborhood = nSelect[nIndex].value;

  DBHelper.fetchRestaurantByCuisineAndNeighborhood(cuisine, neighborhood).then(restaurants => {
    resetRestaurants(restaurants);
    fillRestaurantsHTML();
  }).catch(error => console.error(error));
};

/**
 * Clear current restaurants, their HTML and remove their map markers.
 */
const resetRestaurants = restaurants => {
  // Remove all restaurants
  self.restaurants = [];
  const ul = document.getElementById('restaurants-list');
  ul.innerHTML = '';

  // Remove all map markers

  self.markers.forEach(m => m.setMap(null));
  self.markers = [];
  self.restaurants = restaurants;
};

/**
 * Create all restaurants HTML and add them to the webpage.
 */
const fillRestaurantsHTML = (restaurants = self.restaurants) => {
  const ul = document.getElementById('restaurants-list');
  restaurants.forEach(restaurant => {
    ul.append(createRestaurantHTML(restaurant));
    ul.setAttribute('aria-setsize', restaurants.length);
  });
  addMarkersToMap();
};

/**
 * Return the average note of the restaurant.
 */
const getAverageNote = reviews => {
  let averageNote = 0;
  reviews.forEach(review => {
    averageNote = averageNote + Number(review.rating);
  });
  averageNote = averageNote / reviews.length;
  return Math.round(averageNote * 10) / 10;
};

/**
 * Create restaurant HTML.
 */
const createRestaurantHTML = restaurant => {

  const li = document.createElement('li');
  const figure = document.createElement('figure');
  const figcaption = document.createElement('figcaption');
  const picture = document.createElement('picture');
  const source = document.createElement('source');
  const secondSource = document.createElement('source');
  const thSource = document.createElement('source');
  const sourceWebp = document.createElement('source');
  const secondSourceWebp = document.createElement('source');
  const thSourceWebp = document.createElement('source');
  const image = document.createElement('img');
  const containerNote = document.createElement('div');
  const note = document.createElement('span');

  sourceWebp.srcset = `${DBHelper.imageWebpUrlForRestaurant(restaurant)}-large_x1.webp 1x, ${DBHelper.imageWebpUrlForRestaurant(restaurant)}-large_x2.webp 2x`;
  sourceWebp.media = '(min-width: 1000px)';
  source.srcset = `${DBHelper.imageUrlForRestaurant(restaurant)}-large_x1.jpg 1x, ${DBHelper.imageUrlForRestaurant(restaurant)}-large_x2.jpg 2x`;
  source.media = '(min-width: 1000px)';

  secondSourceWebp.srcset = `${DBHelper.imageWebpUrlForRestaurant(restaurant)}-medium_x1.webp 1x, ${DBHelper.imageWebpUrlForRestaurant(restaurant)}-medium_x2.webp 2x`;
  secondSourceWebp.media = '(min-width: 420px)';
  secondSource.srcset = `${DBHelper.imageUrlForRestaurant(restaurant)}-medium_x1.jpg 1x, ${DBHelper.imageUrlForRestaurant(restaurant)}-medium_x2.jpg 2x`;
  secondSource.media = '(min-width: 420px)';

  thSourceWebp.srcset = `${DBHelper.imageWebpUrlForRestaurant(restaurant)}-small_x2.webp 2x, ${DBHelper.imageWebpUrlForRestaurant(restaurant)}-small_x1.webp 1x`;
  thSourceWebp.media = '(min-width: 320px)';
  thSource.srcset = `${DBHelper.imageUrlForRestaurant(restaurant)}-small_x2.jpg 2x, ${DBHelper.imageUrlForRestaurant(restaurant)}-small_x1.jpg 1x`;
  thSource.media = '(min-width: 320px)';

  image.src = `${DBHelper.imageUrlForRestaurant(restaurant)}-large_x1.jpg`;
  image.className = 'restaurant-img';
  image.setAttribute('sizes', '(max-width: 1100px) 85vw, (min-width: 1101px) 990px');
  image.alt = `${restaurant.name}'s restaurant`;

  note.innerHTML = `${getAverageNote(restaurant.reviews)}/5`;
  containerNote.className = 'main_page';

  containerNote.append(note);

  picture.append(sourceWebp);
  picture.append(source);
  picture.append(secondSourceWebp);
  picture.append(secondSource);
  picture.append(thSourceWebp);
  picture.append(thSource);
  picture.append(image);
  figure.append(picture);
  figure.append(figcaption);

  li.append(containerNote);
  li.append(figure);

  const name = document.createElement('h2');
  name.innerHTML = restaurant.name;
  figcaption.append(name);

  const neighborhood = document.createElement('p');
  neighborhood.innerHTML = restaurant.neighborhood;
  li.append(neighborhood);

  const address = document.createElement('p');
  address.innerHTML = restaurant.address;
  li.append(address);

  const more = document.createElement('a');
  more.innerHTML = 'View Details';
  more.href = DBHelper.urlForRestaurant(restaurant);
  more.setAttribute('aria-label', `View details of ${restaurant.name}`);
  li.append(more);

  return li;
};

/**
 * Add markers for current restaurants to the map.
 */
const addMarkersToMap = (restaurants = self.restaurants) => {
  restaurants.forEach(restaurant => {
    // Add marker to the map
    const marker = DBHelper.mapMarkerForRestaurant(restaurant, self.map);
    google.maps.event.addListener(marker, 'click', () => {
      window.location.href = marker.url;
    });
    self.markers.push(marker);
  });
};
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiXSwibmFtZXMiOlsicmVzdGF1cmFudHMiLCJuZWlnaGJvcmhvb2RzIiwiY3Vpc2luZXMiLCJtYXJrZXJzIiwibWFpbkNvbnRlbnQiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJmb290ZXIiLCJmaWx0ZXJPcHRpb25zIiwiZmlsdGVyUmVzdWx0SGVhZGluZyIsImZpbHRlckJ1dHRvbiIsImxpc3RPZlJlc3RhdXJhbnRzIiwic2VjdGlvbk1hcCIsIm5laWdoYm9yaG9vZHNTZWxlY3QiLCJjdWlzaW5lc1NlbGVjdCIsImFkZEV2ZW50TGlzdGVuZXIiLCJmZXRjaE5laWdoYm9yaG9vZHMiLCJmZXRjaEN1aXNpbmVzIiwibmF2aWdhdG9yIiwid2luZG93Iiwic2VydmljZVdvcmtlciIsInJlZ2lzdGVyIiwidGhlbiIsInJlZ2lzdHJhdGlvbiIsImNvbnNvbGUiLCJsb2ciLCJzY29wZSIsIm9ua2V5cHJlc3MiLCJlIiwiY29kZSIsImNoYXJDb2RlIiwiY2xhc3NMaXN0IiwiY29udGFpbnMiLCJjbG9zZU1lbnUiLCJjbGllbnRIZWlnaHQiLCJzZXRBdHRyaWJ1dGUiLCJmb2N1cyIsIm9wZW5NZW51IiwicmVtb3ZlIiwiYWRkIiwiYmx1ciIsInJlbW92ZUF0dHJpYnV0ZSIsIkRCSGVscGVyIiwic2VsZiIsImZpbGxOZWlnaGJvcmhvb2RzSFRNTCIsImNhdGNoIiwiZXJyb3IiLCJzZWxlY3QiLCJmb3JFYWNoIiwibmVpZ2hib3Job29kIiwib3B0aW9uIiwiY3JlYXRlRWxlbWVudCIsImlubmVySFRNTCIsInZhbHVlIiwibGVuZ3RoIiwiYXBwZW5kIiwiZmlsbEN1aXNpbmVzSFRNTCIsImN1aXNpbmUiLCJpbml0TWFwIiwibG9jIiwibGF0IiwibG5nIiwibWFwIiwiZ29vZ2xlIiwibWFwcyIsIk1hcCIsImdldEVsZW1lbnRCeUlkIiwiem9vbSIsImNlbnRlciIsInNjcm9sbHdoZWVsIiwidXBkYXRlUmVzdGF1cmFudHMiLCJjU2VsZWN0IiwiblNlbGVjdCIsImNJbmRleCIsInNlbGVjdGVkSW5kZXgiLCJuSW5kZXgiLCJmZXRjaFJlc3RhdXJhbnRCeUN1aXNpbmVBbmROZWlnaGJvcmhvb2QiLCJyZXNldFJlc3RhdXJhbnRzIiwiZmlsbFJlc3RhdXJhbnRzSFRNTCIsInVsIiwibSIsInNldE1hcCIsInJlc3RhdXJhbnQiLCJjcmVhdGVSZXN0YXVyYW50SFRNTCIsImFkZE1hcmtlcnNUb01hcCIsImdldEF2ZXJhZ2VOb3RlIiwicmV2aWV3cyIsImF2ZXJhZ2VOb3RlIiwicmV2aWV3IiwiTnVtYmVyIiwicmF0aW5nIiwiTWF0aCIsInJvdW5kIiwibGkiLCJmaWd1cmUiLCJmaWdjYXB0aW9uIiwicGljdHVyZSIsInNvdXJjZSIsInNlY29uZFNvdXJjZSIsInRoU291cmNlIiwic291cmNlV2VicCIsInNlY29uZFNvdXJjZVdlYnAiLCJ0aFNvdXJjZVdlYnAiLCJpbWFnZSIsImNvbnRhaW5lck5vdGUiLCJub3RlIiwic3Jjc2V0IiwiaW1hZ2VXZWJwVXJsRm9yUmVzdGF1cmFudCIsIm1lZGlhIiwiaW1hZ2VVcmxGb3JSZXN0YXVyYW50Iiwic3JjIiwiY2xhc3NOYW1lIiwiYWx0IiwibmFtZSIsImFkZHJlc3MiLCJtb3JlIiwiaHJlZiIsInVybEZvclJlc3RhdXJhbnQiLCJtYXJrZXIiLCJtYXBNYXJrZXJGb3JSZXN0YXVyYW50IiwiZXZlbnQiLCJhZGRMaXN0ZW5lciIsImxvY2F0aW9uIiwidXJsIiwicHVzaCJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQSxJQUFJQSxXQUFKO0FBQ0EsSUFBSUMsYUFBSjtBQUNBLElBQUlDLFFBQUo7O0FBRUE7QUFDQSxJQUFJQyxVQUFVLEVBQWQ7O0FBRUEsTUFBTUMsY0FBY0MsU0FBU0MsYUFBVCxDQUF1QixNQUF2QixDQUFwQjtBQUFBLE1BQ0VDLFNBQVNGLFNBQVNDLGFBQVQsQ0FBdUIsUUFBdkIsQ0FEWDtBQUFBLE1BRUVFLGdCQUFnQkgsU0FBU0MsYUFBVCxDQUF1QixpQkFBdkIsQ0FGbEI7QUFBQSxNQUdFRyxzQkFB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TCxDQUFrQixZQUFsQixFQUFpQyxtQkFBa0IrQyxXQUFXK0IsSUFBSyxFQUFuRTtBQUNBcEIsS0FBR3RDLE1BQUgsQ0FBVTRELElBQVY7O0FBRUEsU0FBT3RCLEVBQVA7QUFDRCxDQXpFRDs7QUEyRUE7OztBQUdBLE1BQU1ULGtCQUFrQixDQUFDcEYsY0FBYzJDLEtBQUszQyxXQUFwQixLQUFvQztBQUMxREEsY0FBWWdELE9BQVosQ0FBb0JrQyxjQUFjO0FBQ2hDO0FBQ0EsVUFBTW9DLFNBQVM1RSxTQUFTNkUsc0JBQVQsQ0FBZ0NyQyxVQUFoQyxFQUE0Q3ZDLEtBQUttQixHQUFqRCxDQUFmO0FBQ0FDLFdBQU9DLElBQVAsQ0FBWXdELEtBQVosQ0FBa0JDLFdBQWxCLENBQThCSCxNQUE5QixFQUFzQyxPQUF0QyxFQUErQyxNQUFNO0FBQ25EbkcsYUFBT3VHLFFBQVAsQ0FBZ0JOLElBQWhCLEdBQXVCRSxPQUFPSyxHQUE5QjtBQUNELEtBRkQ7QUFHQWhGLFNBQUt4QyxPQUFMLENBQWF5SCxJQUFiLENBQWtCTixNQUFsQjtBQUNELEdBUEQ7QUFRRCxDQVREIiwiZmlsZSI6Im1haW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKiBnbG9iYWwgREJIZWxwZXIgKi9cclxubGV0IHJlc3RhdXJhbnRzO1xyXG5sZXQgbmVpZ2hib3Job29kcztcclxubGV0IGN1aXNpbmVzO1xyXG5cclxuLy8gdmFyIG1hcDtcclxudmFyIG1hcmtlcnMgPSBbXTtcclxuXHJcbmNvbnN0IG1haW5Db250ZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignbWFpbicpLFxyXG4gIGZvb3RlciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2Zvb3RlcicpLFxyXG4gIGZpbHRlck9wdGlvbnMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuZmlsdGVyLW9wdGlvbnMnKSxcclxuICBmaWx0ZXJSZXN1bHRIZWFkaW5nID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmZpbHRlci1vcHRpb25zIGgzJyksXHJcbiAgZmlsdGVyQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI21lbnVGaWx0ZXInKSxcclxuICBsaXN0T2ZSZXN0YXVyYW50cyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNyZXN0YXVyYW50cy1saXN0JyksXHJcbiAgLy8gc2VjdGlvblJlc3RhdXJhbnRzTGlzdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNsaXN0LWNvbnRhaW5lcicpLFxyXG4gIHNlY3Rpb25NYXAgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjbWFwLWNvbnRhaW5lcicpLFxyXG4gIG5laWdoYm9yaG9vZHNTZWxlY3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjbmVpZ2hib3Job29kcy1zZWxlY3QnKSxcclxuICBjdWlzaW5lc1NlbGVjdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNjdWlzaW5lcy1zZWxlY3QnKTtcclxuXHJcbi8qKlxyXG4gKiBGZXRjaCBuZWlnaGJvcmhvb2RzIGFuZCBjdWlzaW5lcyBhcyBzb29uIGFzIHRoZSBwYWdlIGlzIGxvYWRlZC5cclxuICovXHJcbmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ0RPTUNvbnRlbnRMb2FkZWQnLCAoKSA9PiB7XHJcbiAgZmV0Y2hOZWlnaGJvcmhvb2RzKCk7XHJcbiAgZmV0Y2hDdWlzaW5lcygpO1xyXG5cclxuXHJcbiAgXHJcbn0pO1xyXG5cclxuXHJcbi8qKlxyXG4gKiBSZWdpc3RlciB0byBzZXJ2aWNlIHdvcmtlciBpZiB0aGUgYnJvd3NlciBpcyBjb21wYXRpYmxlLlxyXG4gKi9cclxuaWYgKCdzZXJ2aWNlV29ya2VyJyBpbiBuYXZpZ2F0b3IpIHtcclxuICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignbG9hZCcsICgpID0+IHtcclxuICAgIG5hdmlnYXRvci5zZXJ2aWNlV29ya2VyLnJlZ2lzdGVyKCdzdy5qcycpLnRoZW4ocmVnaXN0cmF0aW9uID0+IHtcclxuICAgICAgY29uc29sZS5sb2coJ3JlZ2lzdHJhdGlvbiB0byBzZXJ2aWNlV29ya2VyIGNvbXBsZXRlIHdpdGggc2NvcGUgOicsIHJlZ2lzdHJhdGlvbi5zY29wZSk7XHJcbiAgICB9KTtcclxuICB9KTtcclxufVxyXG5cclxuZG9jdW1lbnQub25rZXlwcmVzcyA9IGZ1bmN0aW9uIChlKSB7XHJcbiAgY29uc29sZS5sb2coZS5jb2RlKTtcclxuICBpZiAoZS5jaGFyQ29kZSA9PT0gMTMgJiYgZmlsdGVyT3B0aW9ucy5jbGFzc0xpc3QuY29udGFpbnMoJ29wdGlvbnNPcGVuJykpIHtcclxuICAgIGNsb3NlTWVudSgpO1xyXG4gICAgY29uc29sZS5sb2coc2VjdGlvbk1hcC5jbGllbnRIZWlnaHQpO1xyXG4gICAgbGlzdE9mUmVzdGF1cmFudHMuc2V0QXR0cmlidXRlKCd0YWJpbmRleCcsICcwJyk7XHJcbiAgICBsaXN0T2ZSZXN0YXVyYW50cy5mb2N1cygpO1xyXG4gICAgLy8gd2luZG93LnNjcm9sbFRvKDAsIHNlY3Rpb25NYXAuY2xpZW50SGVpZ2h0KjIpO1xyXG4gIH1cclxufTtcclxuXHJcbmZ1bmN0aW9uIG9wZW5NZW51KCkge1xyXG4gIGZpbHRlck9wdGlvbnMuY2xhc3NMaXN0LnJlbW92ZSgnb3B0aW9uc0Nsb3NlJyk7XHJcbiAgbWFpbkNvbnRlbnQuY2xhc3NMaXN0LnJlbW92ZSgnbW92ZVVwJyk7XHJcbiAgZm9vdGVyLmNsYXNzTGlzdC5yZW1vdmUoJ21vdmVVcCcpO1xyXG4gIGZpbHRlck9wdGlvbnMuY2xhc3NMaXN0LmFkZCgnb3B0aW9uc09wZW4nKTtcclxuICBmaWx0ZXJPcHRpb25zLnNldEF0dHJpYnV0ZSgnYXJpYS1oaWRkZW4nLCAnZmFsc2UnKTtcclxuICBtYWluQ29udGVudC5jbGFzc0xpc3QuYWRkKCdtb3ZlRG93bicpO1xyXG4gIGZvb3Rlci5jbGFzc0xpc3QuYWRkKCdtb3ZlRG93bicpO1xyXG4gIGZpbHRlckJ1dHRvbi5jbGFzc0xpc3QuYWRkKCdwcmVzc2VkJyk7XHJcbiAgZmlsdGVyQnV0dG9uLmJsdXIoKTtcclxuICBmaWx0ZXJSZXN1bHRIZWFkaW5nLnNldEF0dHJpYnV0ZSgndGFiaW5kZXgnLCAnLTEnKTtcclxuICBmaWx0ZXJSZXN1bHRIZWFkaW5nLmZvY3VzKCk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGNsb3NlTWVudSgpIHtcclxuICBmaWx0ZXJPcHRpb25zLmNsYXNzTGlzdC5yZW1vdmUoJ29wdGlvbnNPcGVuJyk7XHJcbiAgZmlsdGVyT3B0aW9ucy5jbGFzc0xpc3QuYWRkKCdvcHRpb25zQ2xvc2UnKTtcclxuICBmaWx0ZXJPcHRpb25zLnNldEF0dHJpYnV0ZSgnYXJpYS1oaWRkZW4nLCAndHJ1ZScpO1xyXG4gIGZpbHRlckJ1dHRvbi5jbGFzc0xpc3QucmVtb3ZlKCdwcmVzc2VkJyk7XHJcbiAgbWFpbkNvbnRlbnQuY2xhc3NMaXN0LnJlbW92ZSgnbW92ZURvd24nKTtcclxuICBtYWluQ29udGVudC5jbGFzc0xpc3QuYWRkKCdtb3ZlVXAnKTtcclxuICBmb290ZXIuY2xhc3NMaXN0LnJlbW92ZSgnbW92ZURvd24nKTtcclxuICBmb290ZXIuY2xhc3NMaXN0LmFkZCgnbW92ZVVwJyk7XHJcbiAgZmlsdGVyUmVzdWx0SGVhZGluZy5yZW1vdmVBdHRyaWJ1dGUoJ3RhYmluZGV4Jyk7XHJcbn1cclxuXHJcbmZpbHRlckJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcclxuICBpZiAoZmlsdGVyT3B0aW9ucy5jbGFzc0xpc3QuY29udGFpbnMoJ29wdGlvbnNDbG9zZScpKSB7XHJcbiAgICBvcGVuTWVudSgpO1xyXG4gIH0gZWxzZSB7XHJcbiAgICBjbG9zZU1lbnUoKTtcclxuICB9XHJcbn0pO1xyXG5cclxuLyoqXHJcbiAqIEZldGNoIGFsbCBuZWlnaGJvcmhvb2RzIGFuZCBzZXQgdGhlaXIgSFRNTC5cclxuICovXHJcbmNvbnN0IGZldGNoTmVpZ2hib3Job29kcyA9ICgpID0+IHtcclxuICBEQkhlbHBlci5mZXRjaE5laWdoYm9yaG9vZHMoKVxyXG4gICAgLnRoZW4obmVpZ2hib3Job29kcyA9PiB7XHJcbiAgICAgIHNlbGYubmVpZ2hib3Job29kcyA9IG5laWdoYm9yaG9vZHM7XHJcbiAgICAgIGZpbGxOZWlnaGJvcmhvb2RzSFRNTCgpO1xyXG4gICAgfSlcclxuICAgIC5jYXRjaChlcnJvciA9PiBjb25zb2xlLmVycm9yKGVycm9yKSk7XHJcbn07XHJcblxyXG4vKipcclxuICogU2V0IG5laWdoYm9yaG9vZHMgSFRNTC5cclxuICovXHJcbmNvbnN0IGZpbGxOZWlnaGJvcmhvb2RzSFRNTCA9IChuZWlnaGJvcmhvb2RzID0gc2VsZi5uZWlnaGJvcmhvb2RzKSA9PiB7XHJcbiAgY29uc3Qgc2VsZWN0ID0gbmVpZ2hib3Job29kc1NlbGVjdDtcclxuICBuZWlnaGJvcmhvb2RzLmZvckVhY2gobmVpZ2hib3Job29kID0+IHtcclxuICAgIGNvbnN0IG9wdGlvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ29wdGlvbicpO1xyXG4gICAgb3B0aW9uLmlubmVySFRNTCA9IG5laWdoYm9yaG9vZDtcclxuICAgIG9wdGlvbi52YWx1ZSA9IG5laWdoYm9yaG9vZDtcclxuICAgIG9wdGlvbi5zZXRBdHRyaWJ1dGUoJ3JvbGUnLCAnb3B0aW9uJyk7XHJcbiAgICBvcHRpb24uc2V0QXR0cmlidXRlKCdhcmlhLXNldHNpemUnLCBuZWlnaGJvcmhvb2RzLmxlbmd0aCk7XHJcbiAgICBzZWxlY3QuYXBwZW5kKG9wdGlvbik7XHJcbiAgfSk7XHJcbn07XHJcbi8qKlxyXG4gKiBGZXRjaCBhbGwgY3Vpc2luZXMgYW5kIHNldCB0aGVpciBIVE1MLlxyXG4gKi9cclxuY29uc3QgZmV0Y2hDdWlzaW5lcyA9ICgpID0+IHtcclxuICBEQkhlbHBlci5mZXRjaEN1aXNpbmVzKClcclxuICAgIC50aGVuKGN1aXNpbmVzID0+IHtcclxuICAgICAgc2VsZi5jdWlzaW5lcyA9IGN1aXNpbmVzO1xyXG4gICAgICBmaWxsQ3Vpc2luZXNIVE1MKCk7XHJcbiAgICB9KVxyXG4gICAgLmNhdGNoKGVycm9yID0+IGNvbnNvbGUuZXJyb3IoZXJyb3IpKTtcclxufTtcclxuXHJcbi8qKlxyXG4gKiBTZXQgY3Vpc2luZXMgSFRNTC5cclxuICovXHJcbmNvbnN0IGZpbGxDdWlzaW5lc0hUTUwgPSAoY3Vpc2luZXMgPSBzZWxmLmN1aXNpbmVzKSA9PiB7XHJcbiAgY29uc3Qgc2VsZWN0ID0gY3Vpc2luZXNTZWxlY3Q7XHJcbiAgY3Vpc2luZXMuZm9yRWFjaChjdWlzaW5lID0+IHtcclxuICAgIGNvbnN0IG9wdGlvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ29wdGlvbicpO1xyXG4gICAgb3B0aW9uLnNldEF0dHJpYnV0ZSgncm9sZScsICdvcHRpb24nKTtcclxuICAgIG9wdGlvbi5pbm5lckhUTUwgPSBjdWlzaW5lO1xyXG4gICAgb3B0aW9uLnZhbHVlID0gY3Vpc2luZTtcclxuICAgIG9wdGlvbi5zZXRBdHRyaWJ1dGUoJ2FyaWEtc2V0c2l6ZScsIGN1aXNpbmVzLmxlbmd0aCk7XHJcbiAgICBzZWxlY3QuYXBwZW5kKG9wdGlvbik7XHJcbiAgfSk7XHJcbn07XHJcblxyXG4vKipcclxuICogSW5pdGlhbGl6ZSBHb29nbGUgbWFwLCBjYWxsZWQgZnJvbSBIVE1MLlxyXG4gKi9cclxud2luZG93LmluaXRNYXAgPSAoKSA9PiB7XHJcbiAgbGV0IGxvYyA9IHtcclxuICAgIGxhdDogNDAuNzIyMjE2LFxyXG4gICAgbG5nOiAtNzMuOTg3NTAxXHJcbiAgfTtcclxuICBzZWxmLm1hcCA9IG5ldyBnb29nbGUubWFwcy5NYXAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21hcCcpLCB7XHJcbiAgICB6b29tOiAxMixcclxuICAgIGNlbnRlcjogbG9jLFxyXG4gICAgc2Nyb2xsd2hlZWw6IGZhbHNlXHJcbiAgfSk7XHJcbiAgdXBkYXRlUmVzdGF1cmFudHMoKTtcclxufTtcclxuXHJcbi8qKlxyXG4gKiBVcGRhdGUgcGFnZSBhbmQgbWFwIGZvciBjdXJyZW50IHJlc3RhdXJhbnRzLlxyXG4gKi9cclxuY29uc3QgdXBkYXRlUmVzdGF1cmFudHMgPSAoKSA9PiB7XHJcbiAgY29uc3QgY1NlbGVjdCA9IGN1aXNpbmVzU2VsZWN0O1xyXG4gIGNvbnN0IG5TZWxlY3QgPSBuZWlnaGJvcmhvb2RzU2VsZWN0O1xyXG5cclxuICBjb25zdCBjSW5kZXggPSBjU2VsZWN0LnNlbGVjdGVkSW5kZXg7XHJcbiAgY29uc3QgbkluZGV4ID0gblNlbGVjdC5zZWxlY3RlZEluZGV4O1xyXG5cclxuICBjb25zdCBjdWlzaW5lID0gY1NlbGVjdFtjSW5kZXhdLnZhbHVlO1xyXG4gIGNvbnN0IG5laWdoYm9yaG9vZCA9IG5TZWxlY3RbbkluZGV4XS52YWx1ZTtcclxuXHJcbiAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50QnlDdWlzaW5lQW5kTmVpZ2hib3Job29kKGN1aXNpbmUsIG5laWdoYm9yaG9vZClcclxuICAgIC50aGVuKHJlc3RhdXJhbnRzID0+IHtcclxuICAgICAgcmVzZXRSZXN0YXVyYW50cyhyZXN0YXVyYW50cyk7XHJcbiAgICAgIGZpbGxSZXN0YXVyYW50c0hUTUwoKTtcclxuICAgIH0pLmNhdGNoKGVycm9yID0+IGNvbnNvbGUuZXJyb3IoZXJyb3IpKTtcclxufTtcclxuXHJcbi8qKlxyXG4gKiBDbGVhciBjdXJyZW50IHJlc3RhdXJhbnRzLCB0aGVpciBIVE1MIGFuZCByZW1vdmUgdGhlaXIgbWFwIG1hcmtlcnMuXHJcbiAqL1xyXG5jb25zdCByZXNldFJlc3RhdXJhbnRzID0gKHJlc3RhdXJhbnRzKSA9PiB7XHJcbiAgLy8gUmVtb3ZlIGFsbCByZXN0YXVyYW50c1xyXG4gIHNlbGYucmVzdGF1cmFudHMgPSBbXTtcclxuICBjb25zdCB1bCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50cy1saXN0Jyk7XHJcbiAgdWwuaW5uZXJIVE1MID0gJyc7XHJcblxyXG4gIC8vIFJlbW92ZSBhbGwgbWFwIG1hcmtlcnNcclxuXHJcbiAgc2VsZi5tYXJrZXJzLmZvckVhY2gobSA9PiBtLnNldE1hcChudWxsKSk7XHJcbiAgc2VsZi5tYXJrZXJzID0gW107XHJcbiAgc2VsZi5yZXN0YXVyYW50cyA9IHJlc3RhdXJhbnRzO1xyXG59O1xyXG5cclxuLyoqXHJcbiAqIENyZWF0ZSBhbGwgcmVzdGF1cmFudHMgSFRNTCBhbmQgYWRkIHRoZW0gdG8gdGhlIHdlYnBhZ2UuXHJcbiAqL1xyXG5jb25zdCBmaWxsUmVzdGF1cmFudHNIVE1MID0gKHJlc3RhdXJhbnRzID0gc2VsZi5yZXN0YXVyYW50cykgPT4ge1xyXG4gIGNvbnN0IHVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnRzLWxpc3QnKTtcclxuICByZXN0YXVyYW50cy5mb3JFYWNoKHJlc3RhdXJhbnQgPT4ge1xyXG4gICAgdWwuYXBwZW5kKGNyZWF0ZVJlc3RhdXJhbnRIVE1MKHJlc3RhdXJhbnQpKTtcclxuICAgIHVsLnNldEF0dHJpYnV0ZSgnYXJpYS1zZXRzaXplJywgcmVzdGF1cmFudHMubGVuZ3RoKTtcclxuICB9KTtcclxuICBhZGRNYXJrZXJzVG9NYXAoKTtcclxufTtcclxuXHJcbi8qKlxyXG4gKiBSZXR1cm4gdGhlIGF2ZXJhZ2Ugbm90ZSBvZiB0aGUgcmVzdGF1cmFudC5cclxuICovXHJcbmNvbnN0IGdldEF2ZXJhZ2VOb3RlID0gKHJldmlld3MpID0+IHtcclxuICBsZXQgYXZlcmFnZU5vdGUgPSAwO1xyXG4gIHJldmlld3MuZm9yRWFjaChyZXZpZXcgPT4ge1xyXG4gICAgYXZlcmFnZU5vdGUgPSBhdmVyYWdlTm90ZSArIE51bWJlcihyZXZpZXcucmF0aW5nKTtcclxuICB9KTtcclxuICBhdmVyYWdlTm90ZSA9IGF2ZXJhZ2VOb3RlIC8gcmV2aWV3cy5sZW5ndGg7XHJcbiAgcmV0dXJuIChNYXRoLnJvdW5kKGF2ZXJhZ2VOb3RlICogMTApKSAvIDEwO1xyXG59O1xyXG5cclxuLyoqXHJcbiAqIENyZWF0ZSByZXN0YXVyYW50IEhUTUwuXHJcbiAqL1xyXG5jb25zdCBjcmVhdGVSZXN0YXVyYW50SFRNTCA9IChyZXN0YXVyYW50KSA9PiB7XHJcbiAgXHJcbiAgY29uc3QgbGkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsaScpO1xyXG4gIGNvbnN0IGZpZ3VyZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2ZpZ3VyZScpO1xyXG4gIGNvbnN0IGZpZ2NhcHRpb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdmaWdjYXB0aW9uJyk7XHJcbiAgY29uc3QgcGljdHVyZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3BpY3R1cmUnKTtcclxuICBjb25zdCBzb3VyY2UgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzb3VyY2UnKTtcclxuICBjb25zdCBzZWNvbmRTb3VyY2UgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzb3VyY2UnKTtcclxuICBjb25zdCB0aFNvdXJjZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NvdXJjZScpO1xyXG4gIGNvbnN0IHNvdXJjZVdlYnAgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzb3VyY2UnKTtcclxuICBjb25zdCBzZWNvbmRTb3VyY2VXZWJwID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc291cmNlJyk7XHJcbiAgY29uc3QgdGhTb3VyY2VXZWJwID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc291cmNlJyk7XHJcbiAgY29uc3QgaW1hZ2UgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbWcnKTtcclxuICBjb25zdCBjb250YWluZXJOb3RlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgY29uc3Qgbm90ZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKTtcclxuXHJcbiAgc291cmNlV2VicC5zcmNzZXQgPSBgJHtEQkhlbHBlci5pbWFnZVdlYnBVcmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpfS1sYXJnZV94MS53ZWJwIDF4LCAke0RCSGVscGVyLmltYWdlV2VicFVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCl9LWxhcmdlX3gyLndlYnAgMnhgO1xyXG4gIHNvdXJjZVdlYnAubWVkaWEgPSAnKG1pbi13aWR0aDogMTAwMHB4KSc7XHJcbiAgc291cmNlLnNyY3NldCA9IGAke0RCSGVscGVyLmltYWdlVXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KX0tbGFyZ2VfeDEuanBnIDF4LCAke0RCSGVscGVyLmltYWdlVXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KX0tbGFyZ2VfeDIuanBnIDJ4YDtcclxuICBzb3VyY2UubWVkaWEgPSAnKG1pbi13aWR0aDogMTAwMHB4KSc7XHJcblxyXG4gIHNlY29uZFNvdXJjZVdlYnAuc3Jjc2V0ID0gYCR7REJIZWxwZXIuaW1hZ2VXZWJwVXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KX0tbWVkaXVtX3gxLndlYnAgMXgsICR7REJIZWxwZXIuaW1hZ2VXZWJwVXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KX0tbWVkaXVtX3gyLndlYnAgMnhgO1xyXG4gIHNlY29uZFNvdXJjZVdlYnAubWVkaWEgPSAnKG1pbi13aWR0aDogNDIwcHgpJztcclxuICBzZWNvbmRTb3VyY2Uuc3Jjc2V0ID0gYCR7REJIZWxwZXIuaW1hZ2VVcmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpfS1tZWRpdW1feDEuanBnIDF4LCAke0RCSGVscGVyLmltYWdlVXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KX0tbWVkaXVtX3gyLmpwZyAyeGA7XHJcbiAgc2Vjb25kU291cmNlLm1lZGlhID0gJyhtaW4td2lkdGg6IDQyMHB4KSc7XHJcbiAgXHJcbiAgdGhTb3VyY2VXZWJwLnNyY3NldCA9IGAke0RCSGVscGVyLmltYWdlV2VicFVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCl9LXNtYWxsX3gyLndlYnAgMngsICR7REJIZWxwZXIuaW1hZ2VXZWJwVXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KX0tc21hbGxfeDEud2VicCAxeGA7XHJcbiAgdGhTb3VyY2VXZWJwLm1lZGlhID0gJyhtaW4td2lkdGg6IDMyMHB4KSc7XHJcbiAgdGhTb3VyY2Uuc3Jjc2V0ID0gYCR7REJIZWxwZXIuaW1hZ2VVcmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpfS1zbWFsbF94Mi5qcGcgMngsICR7REJIZWxwZXIuaW1hZ2VVcmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpfS1zbWFsbF94MS5qcGcgMXhgO1xyXG4gIHRoU291cmNlLm1lZGlhID0gJyhtaW4td2lkdGg6IDMyMHB4KSc7XHJcbiAgXHJcbiAgaW1hZ2Uuc3JjID0gYCR7REJIZWxwZXIuaW1hZ2VVcmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpfS1sYXJnZV94MS5qcGdgO1xyXG4gIGltYWdlLmNsYXNzTmFtZSA9ICdyZXN0YXVyYW50LWltZyc7XHJcbiAgaW1hZ2Uuc2V0QXR0cmlidXRlKCdzaXplcycsICcobWF4LXdpZHRoOiAxMTAwcHgpIDg1dncsIChtaW4td2lkdGg6IDExMDFweCkgOTkwcHgnKTtcclxuICBpbWFnZS5hbHQgPSBgJHtyZXN0YXVyYW50Lm5hbWV9J3MgcmVzdGF1cmFudGA7XHJcbiAgXHJcbiAgbm90ZS5pbm5lckhUTUwgPSBgJHtnZXRBdmVyYWdlTm90ZShyZXN0YXVyYW50LnJldmlld3MpfS81YDtcclxuICBjb250YWluZXJOb3RlLmNsYXNzTmFtZSA9ICdtYWluX3BhZ2UnO1xyXG5cclxuICBjb250YWluZXJOb3RlLmFwcGVuZChub3RlKTtcclxuXHJcbiAgcGljdHVyZS5hcHBlbmQoc291cmNlV2VicCk7XHJcbiAgcGljdHVyZS5hcHBlbmQoc291cmNlKTtcclxuICBwaWN0dXJlLmFwcGVuZChzZWNvbmRTb3VyY2VXZWJwKTtcclxuICBwaWN0dXJlLmFwcGVuZChzZWNvbmRTb3VyY2UpO1xyXG4gIHBpY3R1cmUuYXBwZW5kKHRoU291cmNlV2VicCk7XHJcbiAgcGljdHVyZS5hcHBlbmQodGhTb3VyY2UpO1xyXG4gIHBpY3R1cmUuYXBwZW5kKGltYWdlKTtcclxuICBmaWd1cmUuYXBwZW5kKHBpY3R1cmUpO1xyXG4gIGZpZ3VyZS5hcHBlbmQoZmlnY2FwdGlvbik7XHJcbiAgXHJcbiAgbGkuYXBwZW5kKGNvbnRhaW5lck5vdGUpO1xyXG4gIGxpLmFwcGVuZChmaWd1cmUpO1xyXG4gIFxyXG4gIGNvbnN0IG5hbWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdoMicpO1xyXG4gIG5hbWUuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5uYW1lO1xyXG4gIGZpZ2NhcHRpb24uYXBwZW5kKG5hbWUpO1xyXG5cclxuICBjb25zdCBuZWlnaGJvcmhvb2QgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XHJcbiAgbmVpZ2hib3Job29kLmlubmVySFRNTCA9IHJlc3RhdXJhbnQubmVpZ2hib3Job29kO1xyXG4gIGxpLmFwcGVuZChuZWlnaGJvcmhvb2QpO1xyXG5cclxuICBjb25zdCBhZGRyZXNzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xyXG4gIGFkZHJlc3MuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5hZGRyZXNzO1xyXG4gIGxpLmFwcGVuZChhZGRyZXNzKTtcclxuXHJcbiAgY29uc3QgbW9yZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTtcclxuICBtb3JlLmlubmVySFRNTCA9ICdWaWV3IERldGFpbHMnO1xyXG4gIG1vcmUuaHJlZiA9IERCSGVscGVyLnVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCk7XHJcbiAgbW9yZS5zZXRBdHRyaWJ1dGUoJ2FyaWEtbGFiZWwnLCBgVmlldyBkZXRhaWxzIG9mICR7cmVzdGF1cmFudC5uYW1lfWApO1xyXG4gIGxpLmFwcGVuZChtb3JlKTtcclxuXHJcbiAgcmV0dXJuIGxpO1xyXG59O1xyXG5cclxuLyoqXHJcbiAqIEFkZCBtYXJrZXJzIGZvciBjdXJyZW50IHJlc3RhdXJhbnRzIHRvIHRoZSBtYXAuXHJcbiAqL1xyXG5jb25zdCBhZGRNYXJrZXJzVG9NYXAgPSAocmVzdGF1cmFudHMgPSBzZWxmLnJlc3RhdXJhbnRzKSA9PiB7XHJcbiAgcmVzdGF1cmFudHMuZm9yRWFjaChyZXN0YXVyYW50ID0+IHtcclxuICAgIC8vIEFkZCBtYXJrZXIgdG8gdGhlIG1hcFxyXG4gICAgY29uc3QgbWFya2VyID0gREJIZWxwZXIubWFwTWFya2VyRm9yUmVzdGF1cmFudChyZXN0YXVyYW50LCBzZWxmLm1hcCk7XHJcbiAgICBnb29nbGUubWFwcy5ldmVudC5hZGRMaXN0ZW5lcihtYXJrZXIsICdjbGljaycsICgpID0+IHtcclxuICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSBtYXJrZXIudXJsO1xyXG4gICAgfSk7XHJcbiAgICBzZWxmLm1hcmtlcnMucHVzaChtYXJrZXIpO1xyXG4gIH0pO1xyXG59O1xyXG5cclxuXHJcbiJdfQ==
