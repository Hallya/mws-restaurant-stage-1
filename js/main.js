/* global DBHelper */
let restaurants;
let neighborhoods;
let cuisines;

// var map;
var markers = [];

const mainContent = document.querySelector('main'),
      footer = document.querySelector('footer'),
      filterOptions = document.querySelector('.filter-options'),
      filterResultHeading = document.querySelector('.filter-options h3'),
      filterButton = document.querySelector('#menuFilter'),
      listOfRestaurants = document.querySelector('#restaurants-list'),

// sectionRestaurantsList = document.querySelector('#list-container'),
sectionMap = document.querySelector('#map-container'),
      neighborhoodsSelect = document.querySelector('#neighborhoods-select'),
      cuisinesSelect = document.querySelector('#cuisines-select');

/**
 * Fetch neighborhoods and cuisines as soon as the page is loaded.
 */
document.addEventListener('DOMContentLoaded', () => {

  fetchNeighborhoods();
  fetchCuisines();
});

/**
 * Open or close the options/filter menu.
 */
filterButton.addEventListener('click', () => {
  if (filterOptions.classList.contains('optionsClose')) {
    openMenu();
  } else {
    closeMenu();
  }
});
function openMenu() {
  filterOptions.classList.remove('optionsClose');
  mainContent.classList.remove('moveUp');
  footer.classList.remove('moveUp');
  filterOptions.classList.add('optionsOpen');
  filterOptions.setAttribute('aria-hidden', 'false');
  mainContent.classList.add('moveDown');
  footer.classList.add('moveDown');
  filterButton.classList.add('pressed');
  filterButton.blur();
  filterResultHeading.setAttribute('tabindex', '-1');
  filterResultHeading.focus();
}

function closeMenu() {
  filterOptions.classList.remove('optionsOpen');
  filterOptions.classList.add('optionsClose');
  filterOptions.setAttribute('aria-hidden', 'true');
  filterButton.classList.remove('pressed');
  mainContent.classList.remove('moveDown');
  mainContent.classList.add('moveUp');
  footer.classList.remove('moveDown');
  footer.classList.add('moveUp');
  filterResultHeading.removeAttribute('tabindex');
}

/**
 * Register to service worker if the browser is compatible.
 */
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('sw.js').then(registration => {
      console.log('registration to serviceWorker complete with scope :', registration.scope);
    });
  });
}

/**
 * If options/filter menu is open and enter is pressed it makes focus skip to restaurants list.
 */
document.onkeypress = function (e) {
  console.log(e.code);
  if (e.charCode === 13 && filterOptions.classList.contains('optionsOpen')) {
    closeMenu();
    console.log(sectionMap.clientHeight);
    listOfRestaurants.setAttribute('tabindex', '0');
    listOfRestaurants.focus();
    // window.scrollTo(0, sectionMap.clientHeight*2);
  }
};

function activateLazyLoading() {

  var lazyImages = [].slice.call(document.querySelectorAll('.lazy'));

  if ('IntersectionObserver' in window) {
    console.log('Starting intersectionObserver');
    let lazyImageObserver = new IntersectionObserver(function (entries, observer) {
      entries.forEach(function (entry) {
        if (entry.isIntersecting) {
          let lazyImage = entry.target;
          if (lazyImage.localName === 'source') {
            lazyImage.srcset = lazyImage.dataset.srcset;
          } else {
            lazyImage.src = lazyImage.dataset.src;
          }

          lazyImage.classList.remove('lazy');
          lazyImageObserver.unobserve(lazyImage);
        }
      });
    });

    lazyImages.forEach(function (lazyImage) {
      lazyImageObserver.observe(lazyImage);
    });
  } else {
    // Possibly fall back to a more compatible method here
    let lazyImages = [].slice.call(document.querySelectorAll('.lazy'));
    let active = false;
    console.log('Starting adaptative lazy loading');
    const lazyLoad = function () {
      if (active === false) {
        active = true;

        setTimeout(function () {
          lazyImages.forEach(function (lazyImage) {
            if (lazyImage.getBoundingClientRect().top <= window.innerHeight && lazyImage.getBoundingClientRect().bottom >= 0 && getComputedStyle(lazyImage).display !== "none") {
              lazyImage.src = lazyImage.dataset.src;
              lazyImage.srcset = lazyImage.dataset.srcset;
              lazyImage.classList.remove('lazy');

              lazyImages = lazyImages.filter(function (image) {
                return image !== lazyImage;
              });

              if (lazyImages.length === 0) {
                document.removeEventListener('scroll', lazyLoad);
                window.removeEventListener('resize', lazyLoad);
                window.removeEventListener('orientationchange', lazyLoad);
              }
            }
          });

          active = false;
        }, 200);
      }
    };
    document.addEventListener('scroll', lazyLoad);
    window.addEventListener('resize', lazyLoad);
    window.addEventListener('orientationchange', lazyLoad);
  }
}

/**
 * Fetch all neighborhoods and set their HTML.
 */
const fetchNeighborhoods = () => {
  DBHelper.fetchNeighborhoods().then(neighborhoods => {
    self.neighborhoods = neighborhoods;
    fillNeighborhoodsHTML();
  }).catch(error => console.error(error));
};

/**
 * Set neighborhoods HTML.
 */
const fillNeighborhoodsHTML = (neighborhoods = self.neighborhoods) => {
  const select = neighborhoodsSelect;
  neighborhoods.forEach(neighborhood => {
    const option = document.createElement('option');
    option.innerHTML = neighborhood;
    option.value = neighborhood;
    option.setAttribute('role', 'option');
    option.setAttribute('aria-setsize', neighborhoods.length);
    select.append(option);
  });
};
/**
 * Fetch all cuisines and set their HTML.
 */
const fetchCuisines = () => {
  DBHelper.fetchCuisines().then(cuisines => {
    self.cuisines = cuisines;
    fillCuisinesHTML();
  }).catch(error => console.error(error));
};

/**
 * Set cuisines HTML.
 */
const fillCuisinesHTML = (cuisines = self.cuisines) => {
  const select = cuisinesSelect;
  cuisines.forEach(cuisine => {
    const option = document.createElement('option');
    option.setAttribute('role', 'option');
    option.innerHTML = cuisine;
    option.value = cuisine;
    option.setAttribute('aria-setsize', cuisines.length);
    select.append(option);
  });
};

/**
 * Initialize Google map, called from HTML.
 */
window.initMap = () => {
  let loc = {
    lat: 40.722216,
    lng: -73.987501
  };
  self.map = new google.maps.Map(document.getElementById('map'), {
    zoom: 12,
    center: loc,
    scrollwheel: false
  });

  updateRestaurants();

  // activateLazyLoading();
};

/**
 * Update page and map for current restaurants.
 */
const updateRestaurants = () => {
  const cSelect = cuisinesSelect;
  const nSelect = neighborhoodsSelect;

  const cIndex = cSelect.selectedIndex;
  const nIndex = nSelect.selectedIndex;

  const cuisine = cSelect[cIndex].value;
  const neighborhood = nSelect[nIndex].value;

  DBHelper.fetchRestaurantByCuisineAndNeighborhood(cuisine, neighborhood).then(restaurants => {
    resetRestaurants(restaurants);
    fillRestaurantsHTML();
  }).catch(error => console.error(error));
};

/**
 * Clear current restaurants, their HTML and remove their map markers.
 */
const resetRestaurants = restaurants => {
  // Remove all restaurants
  self.restaurants = [];
  const ul = document.getElementById('restaurants-list');
  ul.innerHTML = '';

  // Remove all map markers

  self.markers.forEach(m => m.setMap(null));
  self.markers = [];
  self.restaurants = restaurants;
};

/**
 * Create all restaurants HTML and add them to the webpage.
 */
const fillRestaurantsHTML = (restaurants = self.restaurants) => {
  const ul = document.getElementById('restaurants-list');
  restaurants.forEach(restaurant => {
    ul.append(createRestaurantHTML(restaurant));
    ul.setAttribute('aria-setsize', restaurants.length);
  });
  addMarkersToMap();
  console.log('Restaurants HTML filled');
  activateLazyLoading();
};

/**
 * Return the average note of the restaurant.
 */
const getAverageNote = reviews => {
  let averageNote = 0;
  reviews.forEach(review => {
    averageNote = averageNote + Number(review.rating);
  });
  averageNote = averageNote / reviews.length;
  return Math.round(averageNote * 10) / 10;
};

/**
 * Create restaurant HTML.
 */
const createRestaurantHTML = restaurant => {

  const li = document.createElement('li');
  const figure = document.createElement('figure');
  const figcaption = document.createElement('figcaption');
  const picture = document.createElement('picture');
  const source = document.createElement('source');
  const secondSource = document.createElement('source');
  const thSource = document.createElement('source');
  const sourceWebp = document.createElement('source');
  const secondSourceWebp = document.createElement('source');
  const thSourceWebp = document.createElement('source');
  const image = document.createElement('img');
  const containerNote = document.createElement('aside');
  const note = document.createElement('p');

  sourceWebp.dataset.srcset = `${DBHelper.imageWebpUrlForRestaurant(restaurant)}-large_x1.webp 1x, ${DBHelper.imageWebpUrlForRestaurant(restaurant)}-large_x2.webp 2x`;
  sourceWebp.srcset = `${DBHelper.imageWebpUrlForRestaurant(restaurant)}-lazy.webp`;
  sourceWebp.media = '(min-width: 1000px)';
  sourceWebp.className = 'lazy';
  source.dataset.srcset = `${DBHelper.imageUrlForRestaurant(restaurant)}-large_x1.jpg 1x, ${DBHelper.imageUrlForRestaurant(restaurant)}-large_x2.jpg 2x`;
  source.srcset = `${DBHelper.imageWebpUrlForRestaurant(restaurant)}-lazy.jpg`;
  source.media = '(min-width: 1000px)';
  source.className = 'lazy';

  secondSourceWebp.dataset.srcset = `${DBHelper.imageWebpUrlForRestaurant(restaurant)}-medium_x1.webp 1x, ${DBHelper.imageWebpUrlForRestaurant(restaurant)}-medium_x2.webp 2x`;
  secondSourceWebp.srcset = `${DBHelper.imageWebpUrlForRestaurant(restaurant)}-lazy.webp`;
  secondSourceWebp.media = '(min-width: 420px)';
  secondSourceWebp.className = 'lazy';
  secondSource.dataset.srcset = `${DBHelper.imageUrlForRestaurant(restaurant)}-medium_x1.jpg 1x, ${DBHelper.imageUrlForRestaurant(restaurant)}-medium_x2.jpg 2x`;
  secondSource.srcset = `${DBHelper.imageWebpUrlForRestaurant(restaurant)}-lazy.jpg`;
  secondSource.media = '(min-width: 420px)';
  secondSource.className = 'lazy';

  thSourceWebp.dataset.srcset = `${DBHelper.imageWebpUrlForRestaurant(restaurant)}-small_x2.webp 2x, ${DBHelper.imageWebpUrlForRestaurant(restaurant)}-small_x1.webp 1x`;
  thSourceWebp.srcset = `${DBHelper.imageWebpUrlForRestaurant(restaurant)}-lazy.webp`;
  thSourceWebp.media = '(min-width: 320px)';
  thSourceWebp.className = 'lazy';
  thSource.dataset.srcset = `${DBHelper.imageUrlForRestaurant(restaurant)}-small_x2.jpg 2x, ${DBHelper.imageUrlForRestaurant(restaurant)}-small_x1.jpg 1x`;
  thSource.srcset = `${DBHelper.imageWebpUrlForRestaurant(restaurant)}-lazy.jpg`;
  thSource.media = '(min-width: 320px)';
  thSource.className = 'lazy';

  image.dataset.src = `${DBHelper.imageUrlForRestaurant(restaurant)}-small_x1.jpg`;
  image.src = `${DBHelper.imageUrlForRestaurant(restaurant)}-lazy.jpg`;
  image.className = 'restaurant-img lazy';
  image.setAttribute('sizes', '(max-width: 1100px) 85vw, (min-width: 1101px) 990px');
  image.alt = `${restaurant.name}'s restaurant`;

  note.innerHTML = `${getAverageNote(restaurant.reviews)}/5`;

  containerNote.append(note);

  picture.append(sourceWebp);
  picture.append(source);
  picture.append(secondSourceWebp);
  picture.append(secondSource);
  picture.append(thSourceWebp);
  picture.append(thSource);
  picture.append(image);
  figure.append(picture);
  figure.append(figcaption);

  li.append(containerNote);
  li.append(figure);

  const name = document.createElement('h2');
  name.innerHTML = restaurant.name;
  figcaption.append(name);

  const neighborhood = document.createElement('p');
  neighborhood.innerHTML = restaurant.neighborhood;
  li.append(neighborhood);

  const address = document.createElement('p');
  address.innerHTML = restaurant.address;
  li.append(address);

  const more = document.createElement('a');
  more.innerHTML = 'View Details';
  more.href = DBHelper.urlForRestaurant(restaurant);
  more.setAttribute('aria-label', `View details of ${restaurant.name}`);
  li.append(more);

  return li;
};

/**
 * Add markers for current restaurants to the map.
 */
const addMarkersToMap = (restaurants = self.restaurants) => {
  restaurants.forEach(restaurant => {
    // Add marker to the map
    const marker = DBHelper.mapMarkerForRestaurant(restaurant, self.map);
    google.maps.event.addListener(marker, 'click', () => {
      window.location.href = marker.url;
    });
    self.markers.push(marker);
  });
};
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiXSwibmFtZXMiOlsicmVzdGF1cmFudHMiLCJuZWlnaGJvcmhvb2RzIiwiY3Vpc2luZXMiLCJtYXJrZXJzIiwibWFpbkNvbnRlbnQiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJmb290ZXIiLCJmaWx0ZXJPcHRpb25zIiwiZmlsdGVyUmVzdWx0SGVhZGluZyIsImZpbHRlckJ1dHRvbiIsImxpc3RPZlJlc3RhdXJhbnRzIiwic2VjdGlvbk1hcCIsIm5laWdoYm9yaG9vZHNTZWxlY3QiLCJjdWlzaW5lc1NlbGVjdCIsImFkZEV2ZW50TGlzdGVuZXIiLCJmZXRjaE5laWdoYm9yaG9vZHMiLCJmZXRjaEN1aXNpbmVzIiwiY2xhc3NMaXN0IiwiY29udGFpbnMiLCJvcGVuTWVudSIsImNsb3NlTWVudSIsInJlbW92ZSIsImFkZCIsInNldEF0dHJpYnV0ZSIsImJsdXIiLCJmb2N1cyIsInJlbW92ZUF0dHJpYnV0ZSIsIm5hdmlnYXRvciIsIndpbmRvdyIsInNlcnZpY2VXb3JrZXIiLCJyZWdpc3RlciIsInRoZW4iLCJyZWdpc3RyYXRpb24iLCJjb25zb2xlIiwibG9nIiwic2NvcGUiLCJvbmtleXByZXNzIiwiZSIsImNvZGUiLCJjaGFyQ29kZSIsImNsaWVudEhlaWdodCIsImFjdGl2YXRlTGF6eUxvYWRpbmciLCJsYXp5SW1hZ2VzIiwic2xpY2UiLCJjYWxsIiwicXVlcnlTZWxlY3RvckFsbCIsImxhenlJbWFnZU9ic2VydmVyIiwiSW50ZXJzZWN0aW9uT2JzZXJ2ZXIiLCJlbnRyaWVzIiwib2JzZXJ2ZXIiLCJmb3JFYWNoIiwiZW50cnkiLCJpc0ludGVyc2VjdGluZyIsImxhenlJbWFnZSIsInRhcmdldCIsImxvY2FsTmFtZSIsInNyY3NldCIsImRhdGFzZXQiLCJzcmMiLCJ1bm9ic2VydmUiLCJvYnNlcnZlIiwiYWN0aXZlIiwibGF6eUxvYWQiLCJzZXRUaW1lb3V0IiwiZ2V0Qm91bmRpbmdDbGllbnRSZWN0IiwidG9wIiwiaW5uZXJIZWlnaHQiLCJib3R0b20iLCJnZXRDb21wdXRlZFN0eWxlIiwiZGlzcGxheSIsImZpbHRlciIsImltYWdlIiwibGVuZ3RoIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsIkRCSGVscGVyIiwic2VsZiIsImZpbGxOZWlnaGJvcmhvb2RzSFRNTCIsImNhdGNoIiwiZXJyb3IiLCJzZWxlY3QiLCJuZWlnaGJvcmhvb2QiLCJvcHRpb24iLCJjcmVhdGVFbGVtZW50IiwiaW5uZXJIVE1MIiwidmFsdWUiLCJhcHBlbmQiLCJmaWxsQ3Vpc2luZXNIVE1MIiwiY3Vpc2luZSIsImluaXRNYXAiLCJsb2MiLCJsYXQiLCJsbmciLCJtYXAiLCJnb29nbGUiLCJtYXBzIiwiTWFwIiwiZ2V0RWxlbWVudEJ5SWQiLCJ6b29tIiwiY2VudGVyIiwic2Nyb2xsd2hlZWwiLCJ1cGRhdGVSZXN0YXVyYW50cyIsImNTZWxlY3QiLCJuU2VsZWN0IiwiY0luZGV4Iiwic2VsZWN0ZWRJbmRleCIsIm5JbmRleCIsImZldGNoUmVzdGF1cmFudEJ5Q3Vpc2luZUFuZE5laWdoYm9yaG9vZCIsInJlc2V0UmVzdGF1cmFudHMiLCJmaWxsUmVzdGF1cmFudHNIVE1MIiwidWwiLCJtIiwic2V0TWFwIiwicmVzdGF1cmFudCIsImNyZWF0ZVJlc3RhdXJhbnRIVE1MIiwiYWRkTWFya2Vyc1RvTWFwIiwiZ2V0QXZlcmFnZU5vdGUiLCJyZXZpZXdzIiwiYXZlcmFnZU5vdGUiLCJyZXZpZXciLCJOdW1iZXIiLCJyYXRpbmciLCJNYXRoIiwicm91bmQiLCJsaSIsImZpZ3VyZSIsImZpZ2NhcHRpb24iLCJwaWN0dXJlIiwic291cmNlIiwic2Vjb25kU291cmNlIiwidGhTb3VyY2UiLCJzb3VyY2VXZWJwIiwic2Vjb25kU291cmNlV2VicCIsInRoU291cmNlV2VicCIsImNvbnRhaW5lck5vdGUiLCJub3RlIiwiaW1hZ2VXZWJwVXJsRm9yUmVzdGF1cmFudCIsIm1lZGlhIiwiY2xhc3NOYW1lIiwiaW1hZ2VVcmxGb3JSZXN0YXVyYW50IiwiYWx0IiwibmFtZSIsImFkZHJlc3MiLCJtb3JlIiwiaHJlZiIsInVybEZvclJlc3RhdXJhbnQiLCJtYXJrZXIiLCJtYXBNYXJrZXJGb3JSZXN0YXVyYW50IiwiZXZlbnQiLCJhZGRMaXN0ZW5lciIsImxvY2F0aW9uIiwidXJsIiwicHVzaCJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQSxJQUFJQSxXQUFKO0FBQ0EsSUFBSUMsYUFBSjtBQUNBLElBQUlDLFFBQUo7O0FBRUE7QUFDQSxJQUFJQyxVQUFVLEVBQWQ7O0FBRUEsTUFBTUMsY0FBY0MsU0FBU0MsYUFBVCxDQUF1QixNQUF2QixDQUFwQjtBQUFBLE1BQ0VDLFNBQVNGLFNBQVNDLGFBQVQsQ0FBdUIsUUFBdkIsQ0FEWDtBQUFBLE1BRUVFLGdCQUFnQkgsU0FBU0MsYUFBVCxDQUF1QixpQkFBdkIsQ0FGbEI7QUFBQSxNQUdFRyxzQkFBc0JKLFNBQVNDLGFBQVQsQ0FBdUIsb0JBQXZCLENBSHhCO0FBQUEsTUFJRUksZUFBZUwsU0FBU0MsYUFBVCxDQUF1QixhQUF2QixDQUpqQjtBQUFBLE1BS0VLLG9CQUFvQk4sU0FBU0MsYUFBVCxDQUF1QixtQkFBdkIsQ0FMdEI7O0FBTUU7QUFDQU0sYUFBYVAsU0FBU0MsYUFBVCxDQUF1QixnQkFBdkIsQ0FQZjtBQUFBLE1BUUVPLHNCQUFzQlIsU0FBU0MsYUFBVCxDQUF1Qix1QkFBdkIsQ0FSeEI7QUFBQSxNQVNFUSxpQkFBaUJULFNBQVNDLGFBQVQsQ0FBdUIsa0JBQXZCLENBVG5COztBQWFBOzs7QUFHQUQsU0FBU1UsZ0JBQVQsQ0FBMEIsa0JBQTFCLEVBQThDLE1BQU07O0FBRWxEQztBQUNBQztBQUNELENBSkQ7O0FBUUE7OztBQUdBUCxhQUFhSyxnQkFBYixDQUE4QixPQUE5QixFQUF1QyxNQUFNO0FBQzNDLE1BQUlQLGNBQWNVLFNBQWQsQ0FBd0JDLFFBQXhCLENBQWlDLGNBQWpDLENBQUosRUFBc0Q7QUFDcERDO0FBQ0QsR0FGRCxNQUVPO0FBQ0xDO0FBQ0Q7QUFDRixDQU5EO0FBT0EsU0FBU0QsUUFBVCxHQUFvQjtBQUNsQlosZ0JB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VUFBUTFELFNBQVIsR0FBb0I2QixXQUFXNkIsT0FBL0I7QUFDQWxCLEtBQUd0QyxNQUFILENBQVV3RCxPQUFWOztBQUVBLFFBQU1DLE9BQU8xSSxTQUFTOEUsYUFBVCxDQUF1QixHQUF2QixDQUFiO0FBQ0E0RCxPQUFLM0QsU0FBTCxHQUFpQixjQUFqQjtBQUNBMkQsT0FBS0MsSUFBTCxHQUFZckUsU0FBU3NFLGdCQUFULENBQTBCaEMsVUFBMUIsQ0FBWjtBQUNBOEIsT0FBS3ZILFlBQUwsQ0FBa0IsWUFBbEIsRUFBaUMsbUJBQWtCeUYsV0FBVzRCLElBQUssRUFBbkU7QUFDQWpCLEtBQUd0QyxNQUFILENBQVV5RCxJQUFWOztBQUVBLFNBQU9uQixFQUFQO0FBQ0QsQ0FyRkQ7O0FBdUZBOzs7QUFHQSxNQUFNVCxrQkFBa0IsQ0FBQ25ILGNBQWM0RSxLQUFLNUUsV0FBcEIsS0FBb0M7QUFDMURBLGNBQVltRCxPQUFaLENBQW9COEQsY0FBYztBQUNoQztBQUNBLFVBQU1pQyxTQUFTdkUsU0FBU3dFLHNCQUFULENBQWdDbEMsVUFBaEMsRUFBNENyQyxLQUFLaUIsR0FBakQsQ0FBZjtBQUNBQyxXQUFPQyxJQUFQLENBQVlxRCxLQUFaLENBQWtCQyxXQUFsQixDQUE4QkgsTUFBOUIsRUFBc0MsT0FBdEMsRUFBK0MsTUFBTTtBQUNuRHJILGFBQU95SCxRQUFQLENBQWdCTixJQUFoQixHQUF1QkUsT0FBT0ssR0FBOUI7QUFDRCxLQUZEO0FBR0EzRSxTQUFLekUsT0FBTCxDQUFhcUosSUFBYixDQUFrQk4sTUFBbEI7QUFDRCxHQVBEO0FBUUQsQ0FURCIsImZpbGUiOiJtYWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyogZ2xvYmFsIERCSGVscGVyICovXHJcbmxldCByZXN0YXVyYW50cztcclxubGV0IG5laWdoYm9yaG9vZHM7XHJcbmxldCBjdWlzaW5lcztcclxuXHJcbi8vIHZhciBtYXA7XHJcbnZhciBtYXJrZXJzID0gW107XHJcblxyXG5jb25zdCBtYWluQ29udGVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ21haW4nKSxcclxuICBmb290ZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdmb290ZXInKSxcclxuICBmaWx0ZXJPcHRpb25zID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmZpbHRlci1vcHRpb25zJyksXHJcbiAgZmlsdGVyUmVzdWx0SGVhZGluZyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5maWx0ZXItb3B0aW9ucyBoMycpLFxyXG4gIGZpbHRlckJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNtZW51RmlsdGVyJyksXHJcbiAgbGlzdE9mUmVzdGF1cmFudHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjcmVzdGF1cmFudHMtbGlzdCcpLFxyXG4gIC8vIHNlY3Rpb25SZXN0YXVyYW50c0xpc3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjbGlzdC1jb250YWluZXInKSxcclxuICBzZWN0aW9uTWFwID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI21hcC1jb250YWluZXInKSxcclxuICBuZWlnaGJvcmhvb2RzU2VsZWN0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI25laWdoYm9yaG9vZHMtc2VsZWN0JyksXHJcbiAgY3Vpc2luZXNTZWxlY3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjY3Vpc2luZXMtc2VsZWN0Jyk7XHJcblxyXG5cclxuXHJcbi8qKlxyXG4gKiBGZXRjaCBuZWlnaGJvcmhvb2RzIGFuZCBjdWlzaW5lcyBhcyBzb29uIGFzIHRoZSBwYWdlIGlzIGxvYWRlZC5cclxuICovXHJcbmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ0RPTUNvbnRlbnRMb2FkZWQnLCAoKSA9PiB7XHJcbiAgXHJcbiAgZmV0Y2hOZWlnaGJvcmhvb2RzKCk7XHJcbiAgZmV0Y2hDdWlzaW5lcygpO1xyXG59KTtcclxuXHJcblxyXG5cclxuLyoqXHJcbiAqIE9wZW4gb3IgY2xvc2UgdGhlIG9wdGlvbnMvZmlsdGVyIG1lbnUuXHJcbiAqL1xyXG5maWx0ZXJCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XHJcbiAgaWYgKGZpbHRlck9wdGlvbnMuY2xhc3NMaXN0LmNvbnRhaW5zKCdvcHRpb25zQ2xvc2UnKSkge1xyXG4gICAgb3Blbk1lbnUoKTtcclxuICB9IGVsc2Uge1xyXG4gICAgY2xvc2VNZW51KCk7XHJcbiAgfVxyXG59KTtcclxuZnVuY3Rpb24gb3Blbk1lbnUoKSB7XHJcbiAgZmlsdGVyT3B0aW9ucy5jbGFzc0xpc3QucmVtb3ZlKCdvcHRpb25zQ2xvc2UnKTtcclxuICBtYWluQ29udGVudC5jbGFzc0xpc3QucmVtb3ZlKCdtb3ZlVXAnKTtcclxuICBmb290ZXIuY2xhc3NMaXN0LnJlbW92ZSgnbW92ZVVwJyk7XHJcbiAgZmlsdGVyT3B0aW9ucy5jbGFzc0xpc3QuYWRkKCdvcHRpb25zT3BlbicpO1xyXG4gIGZpbHRlck9wdGlvbnMuc2V0QXR0cmlidXRlKCdhcmlhLWhpZGRlbicsICdmYWxzZScpO1xyXG4gIG1haW5Db250ZW50LmNsYXNzTGlzdC5hZGQoJ21vdmVEb3duJyk7XHJcbiAgZm9vdGVyLmNsYXNzTGlzdC5hZGQoJ21vdmVEb3duJyk7XHJcbiAgZmlsdGVyQnV0dG9uLmNsYXNzTGlzdC5hZGQoJ3ByZXNzZWQnKTtcclxuICBmaWx0ZXJCdXR0b24uYmx1cigpO1xyXG4gIGZpbHRlclJlc3VsdEhlYWRpbmcuc2V0QXR0cmlidXRlKCd0YWJpbmRleCcsICctMScpO1xyXG4gIGZpbHRlclJlc3VsdEhlYWRpbmcuZm9jdXMoKTtcclxufVxyXG5cclxuZnVuY3Rpb24gY2xvc2VNZW51KCkge1xyXG4gIGZpbHRlck9wdGlvbnMuY2xhc3NMaXN0LnJlbW92ZSgnb3B0aW9uc09wZW4nKTtcclxuICBmaWx0ZXJPcHRpb25zLmNsYXNzTGlzdC5hZGQoJ29wdGlvbnNDbG9zZScpO1xyXG4gIGZpbHRlck9wdGlvbnMuc2V0QXR0cmlidXRlKCdhcmlhLWhpZGRlbicsICd0cnVlJyk7XHJcbiAgZmlsdGVyQnV0dG9uLmNsYXNzTGlzdC5yZW1vdmUoJ3ByZXNzZWQnKTtcclxuICBtYWluQ29udGVudC5jbGFzc0xpc3QucmVtb3ZlKCdtb3ZlRG93bicpO1xyXG4gIG1haW5Db250ZW50LmNsYXNzTGlzdC5hZGQoJ21vdmVVcCcpO1xyXG4gIGZvb3Rlci5jbGFzc0xpc3QucmVtb3ZlKCdtb3ZlRG93bicpO1xyXG4gIGZvb3Rlci5jbGFzc0xpc3QuYWRkKCdtb3ZlVXAnKTtcclxuICBmaWx0ZXJSZXN1bHRIZWFkaW5nLnJlbW92ZUF0dHJpYnV0ZSgndGFiaW5kZXgnKTtcclxufVxyXG5cclxuXHJcblxyXG4vKipcclxuICogUmVnaXN0ZXIgdG8gc2VydmljZSB3b3JrZXIgaWYgdGhlIGJyb3dzZXIgaXMgY29tcGF0aWJsZS5cclxuICovXHJcbmlmICgnc2VydmljZVdvcmtlcicgaW4gbmF2aWdhdG9yKSB7XHJcbiAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2xvYWQnLCAoKSA9PiB7XHJcbiAgICBuYXZpZ2F0b3Iuc2VydmljZVdvcmtlci5yZWdpc3Rlcignc3cuanMnKS50aGVuKHJlZ2lzdHJhdGlvbiA9PiB7XHJcbiAgICAgIGNvbnNvbGUubG9nKCdyZWdpc3RyYXRpb24gdG8gc2VydmljZVdvcmtlciBjb21wbGV0ZSB3aXRoIHNjb3BlIDonLCByZWdpc3RyYXRpb24uc2NvcGUpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcbn1cclxuXHJcblxyXG4vKipcclxuICogSWYgb3B0aW9ucy9maWx0ZXIgbWVudSBpcyBvcGVuIGFuZCBlbnRlciBpcyBwcmVzc2VkIGl0IG1ha2VzIGZvY3VzIHNraXAgdG8gcmVzdGF1cmFudHMgbGlzdC5cclxuICovXHJcbmRvY3VtZW50Lm9ua2V5cHJlc3MgPSBmdW5jdGlvbiAoZSkge1xyXG4gIGNvbnNvbGUubG9nKGUuY29kZSk7XHJcbiAgaWYgKGUuY2hhckNvZGUgPT09IDEzICYmIGZpbHRlck9wdGlvbnMuY2xhc3NMaXN0LmNvbnRhaW5zKCdvcHRpb25zT3BlbicpKSB7XHJcbiAgICBjbG9zZU1lbnUoKTtcclxuICAgIGNvbnNvbGUubG9nKHNlY3Rpb25NYXAuY2xpZW50SGVpZ2h0KTtcclxuICAgIGxpc3RPZlJlc3RhdXJhbnRzLnNldEF0dHJpYnV0ZSgndGFiaW5kZXgnLCAnMCcpO1xyXG4gICAgbGlzdE9mUmVzdGF1cmFudHMuZm9jdXMoKTtcclxuICAgIC8vIHdpbmRvdy5zY3JvbGxUbygwLCBzZWN0aW9uTWFwLmNsaWVudEhlaWdodCoyKTtcclxuICB9XHJcbn07XHJcblxyXG5cclxuXHJcbmZ1bmN0aW9uIGFjdGl2YXRlTGF6eUxvYWRpbmcoKSB7XHJcbiAgXHJcbiAgdmFyIGxhenlJbWFnZXMgPSBbXS5zbGljZS5jYWxsKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5sYXp5JykpO1xyXG5cclxuICBcclxuICBpZiAoJ0ludGVyc2VjdGlvbk9ic2VydmVyJyBpbiB3aW5kb3cpIHtcclxuICAgIGNvbnNvbGUubG9nKCdTdGFydGluZyBpbnRlcnNlY3Rpb25PYnNlcnZlcicpO1xyXG4gICAgbGV0IGxhenlJbWFnZU9ic2VydmVyID0gbmV3IEludGVyc2VjdGlvbk9ic2VydmVyKGZ1bmN0aW9uIChlbnRyaWVzLCBvYnNlcnZlcikge1xyXG4gICAgICBlbnRyaWVzLmZvckVhY2goZnVuY3Rpb24gKGVudHJ5KSB7XHJcbiAgICAgICAgaWYgKGVudHJ5LmlzSW50ZXJzZWN0aW5nKSB7XHJcbiAgICAgICAgICBsZXQgbGF6eUltYWdlID0gZW50cnkudGFyZ2V0O1xyXG4gICAgICAgICAgaWYgKGxhenlJbWFnZS5sb2NhbE5hbWUgPT09ICdzb3VyY2UnKSB7XHJcbiAgICAgICAgICAgIGxhenlJbWFnZS5zcmNzZXQgPSBsYXp5SW1hZ2UuZGF0YXNldC5zcmNzZXQ7XHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBsYXp5SW1hZ2Uuc3JjID0gbGF6eUltYWdlLmRhdGFzZXQuc3JjO1xyXG4gICAgICAgICAgfVxyXG5cclxuICAgICAgICAgIGxhenlJbWFnZS5jbGFzc0xpc3QucmVtb3ZlKCdsYXp5Jyk7XHJcbiAgICAgICAgICBsYXp5SW1hZ2VPYnNlcnZlci51bm9ic2VydmUobGF6eUltYWdlKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgbGF6eUltYWdlcy5mb3JFYWNoKGZ1bmN0aW9uIChsYXp5SW1hZ2UpIHtcclxuICAgICAgbGF6eUltYWdlT2JzZXJ2ZXIub2JzZXJ2ZShsYXp5SW1hZ2UpO1xyXG4gICAgfSk7XHJcbiAgfSBlbHNlIHtcclxuICAgIC8vIFBvc3NpYmx5IGZhbGwgYmFjayB0byBhIG1vcmUgY29tcGF0aWJsZSBtZXRob2QgaGVyZVxyXG4gICAgbGV0IGxhenlJbWFnZXMgPSBbXS5zbGljZS5jYWxsKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5sYXp5JykpO1xyXG4gICAgbGV0IGFjdGl2ZSA9IGZhbHNlO1xyXG4gICAgY29uc29sZS5sb2coJ1N0YXJ0aW5nIGFkYXB0YXRpdmUgbGF6eSBsb2FkaW5nJyk7XHJcbiAgICBjb25zdCBsYXp5TG9hZCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgaWYgKGFjdGl2ZSA9PT0gZmFsc2UpIHtcclxuICAgICAgICBhY3RpdmUgPSB0cnVlO1xyXG5cclxuICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgIGxhenlJbWFnZXMuZm9yRWFjaChmdW5jdGlvbiAobGF6eUltYWdlKSB7XHJcbiAgICAgICAgICAgIGlmICgobGF6eUltYWdlLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLnRvcCA8PSB3aW5kb3cuaW5uZXJIZWlnaHQgJiYgbGF6eUltYWdlLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLmJvdHRvbSA+PSAwKSAmJiBnZXRDb21wdXRlZFN0eWxlKGxhenlJbWFnZSkuZGlzcGxheSAhPT0gXCJub25lXCIpIHtcclxuICAgICAgICAgICAgICBsYXp5SW1hZ2Uuc3JjID0gbGF6eUltYWdlLmRhdGFzZXQuc3JjO1xyXG4gICAgICAgICAgICAgIGxhenlJbWFnZS5zcmNzZXQgPSBsYXp5SW1hZ2UuZGF0YXNldC5zcmNzZXQ7XHJcbiAgICAgICAgICAgICAgbGF6eUltYWdlLmNsYXNzTGlzdC5yZW1vdmUoJ2xhenknKTtcclxuXHJcbiAgICAgICAgICAgICAgbGF6eUltYWdlcyA9IGxhenlJbWFnZXMuZmlsdGVyKGZ1bmN0aW9uIChpbWFnZSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGltYWdlICE9PSBsYXp5SW1hZ2U7XHJcbiAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgIGlmIChsYXp5SW1hZ2VzLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICAgICAgICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcignc2Nyb2xsJywgbGF6eUxvYWQpO1xyXG4gICAgICAgICAgICAgICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3Jlc2l6ZScsIGxhenlMb2FkKTtcclxuICAgICAgICAgICAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCdvcmllbnRhdGlvbmNoYW5nZScsIGxhenlMb2FkKTtcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgIGFjdGl2ZSA9IGZhbHNlO1xyXG4gICAgICAgIH0sIDIwMCk7XHJcbiAgICAgIH1cclxuICAgIH07XHJcbiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdzY3JvbGwnLCBsYXp5TG9hZCk7XHJcbiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigncmVzaXplJywgbGF6eUxvYWQpO1xyXG4gICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ29yaWVudGF0aW9uY2hhbmdlJywgbGF6eUxvYWQpO1xyXG4gIH1cclxufVxyXG5cclxuXHJcbi8qKlxyXG4gKiBGZXRjaCBhbGwgbmVpZ2hib3Job29kcyBhbmQgc2V0IHRoZWlyIEhUTUwuXHJcbiAqL1xyXG5jb25zdCBmZXRjaE5laWdoYm9yaG9vZHMgPSAoKSA9PiB7XHJcbiAgREJIZWxwZXIuZmV0Y2hOZWlnaGJvcmhvb2RzKClcclxuICAgIC50aGVuKG5laWdoYm9yaG9vZHMgPT4ge1xyXG4gICAgICBzZWxmLm5laWdoYm9yaG9vZHMgPSBuZWlnaGJvcmhvb2RzO1xyXG4gICAgICBmaWxsTmVpZ2hib3Job29kc0hUTUwoKTtcclxuICAgIH0pXHJcbiAgICAuY2F0Y2goZXJyb3IgPT4gY29uc29sZS5lcnJvcihlcnJvcikpO1xyXG59O1xyXG5cclxuLyoqXHJcbiAqIFNldCBuZWlnaGJvcmhvb2RzIEhUTUwuXHJcbiAqL1xyXG5jb25zdCBmaWxsTmVpZ2hib3Job29kc0hUTUwgPSAobmVpZ2hib3Job29kcyA9IHNlbGYubmVpZ2hib3Job29kcykgPT4ge1xyXG4gIGNvbnN0IHNlbGVjdCA9IG5laWdoYm9yaG9vZHNTZWxlY3Q7XHJcbiAgbmVpZ2hib3Job29kcy5mb3JFYWNoKG5laWdoYm9yaG9vZCA9PiB7XHJcbiAgICBjb25zdCBvcHRpb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdvcHRpb24nKTtcclxuICAgIG9wdGlvbi5pbm5lckhUTUwgPSBuZWlnaGJvcmhvb2Q7XHJcbiAgICBvcHRpb24udmFsdWUgPSBuZWlnaGJvcmhvb2Q7XHJcbiAgICBvcHRpb24uc2V0QXR0cmlidXRlKCdyb2xlJywgJ29wdGlvbicpO1xyXG4gICAgb3B0aW9uLnNldEF0dHJpYnV0ZSgnYXJpYS1zZXRzaXplJywgbmVpZ2hib3Job29kcy5sZW5ndGgpO1xyXG4gICAgc2VsZWN0LmFwcGVuZChvcHRpb24pO1xyXG4gIH0pO1xyXG59O1xyXG4vKipcclxuICogRmV0Y2ggYWxsIGN1aXNpbmVzIGFuZCBzZXQgdGhlaXIgSFRNTC5cclxuICovXHJcbmNvbnN0IGZldGNoQ3Vpc2luZXMgPSAoKSA9PiB7XHJcbiAgREJIZWxwZXIuZmV0Y2hDdWlzaW5lcygpXHJcbiAgICAudGhlbihjdWlzaW5lcyA9PiB7XHJcbiAgICAgIHNlbGYuY3Vpc2luZXMgPSBjdWlzaW5lcztcclxuICAgICAgZmlsbEN1aXNpbmVzSFRNTCgpO1xyXG4gICAgfSlcclxuICAgIC5jYXRjaChlcnJvciA9PiBjb25zb2xlLmVycm9yKGVycm9yKSk7XHJcbn07XHJcblxyXG4vKipcclxuICogU2V0IGN1aXNpbmVzIEhUTUwuXHJcbiAqL1xyXG5jb25zdCBmaWxsQ3Vpc2luZXNIVE1MID0gKGN1aXNpbmVzID0gc2VsZi5jdWlzaW5lcykgPT4ge1xyXG4gIGNvbnN0IHNlbGVjdCA9IGN1aXNpbmVzU2VsZWN0O1xyXG4gIGN1aXNpbmVzLmZvckVhY2goY3Vpc2luZSA9PiB7XHJcbiAgICBjb25zdCBvcHRpb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdvcHRpb24nKTtcclxuICAgIG9wdGlvbi5zZXRBdHRyaWJ1dGUoJ3JvbGUnLCAnb3B0aW9uJyk7XHJcbiAgICBvcHRpb24uaW5uZXJIVE1MID0gY3Vpc2luZTtcclxuICAgIG9wdGlvbi52YWx1ZSA9IGN1aXNpbmU7XHJcbiAgICBvcHRpb24uc2V0QXR0cmlidXRlKCdhcmlhLXNldHNpemUnLCBjdWlzaW5lcy5sZW5ndGgpO1xyXG4gICAgc2VsZWN0LmFwcGVuZChvcHRpb24pO1xyXG4gIH0pO1xyXG59O1xyXG5cclxuLyoqXHJcbiAqIEluaXRpYWxpemUgR29vZ2xlIG1hcCwgY2FsbGVkIGZyb20gSFRNTC5cclxuICovXHJcbndpbmRvdy5pbml0TWFwID0gKCkgPT4ge1xyXG4gIGxldCBsb2MgPSB7XHJcbiAgICBsYXQ6IDQwLjcyMjIxNixcclxuICAgIGxuZzogLTczLjk4NzUwMVxyXG4gIH07XHJcbiAgc2VsZi5tYXAgPSBuZXcgZ29vZ2xlLm1hcHMuTWFwKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYXAnKSwge1xyXG4gICAgem9vbTogMTIsXHJcbiAgICBjZW50ZXI6IGxvYyxcclxuICAgIHNjcm9sbHdoZWVsOiBmYWxzZVxyXG4gIH0pO1xyXG4gIFxyXG4gIHVwZGF0ZVJlc3RhdXJhbnRzKCk7XHJcblxyXG4gIC8vIGFjdGl2YXRlTGF6eUxvYWRpbmcoKTtcclxufTtcclxuXHJcbi8qKlxyXG4gKiBVcGRhdGUgcGFnZSBhbmQgbWFwIGZvciBjdXJyZW50IHJlc3RhdXJhbnRzLlxyXG4gKi9cclxuY29uc3QgdXBkYXRlUmVzdGF1cmFudHMgPSAoKSA9PiB7XHJcbiAgY29uc3QgY1NlbGVjdCA9IGN1aXNpbmVzU2VsZWN0O1xyXG4gIGNvbnN0IG5TZWxlY3QgPSBuZWlnaGJvcmhvb2RzU2VsZWN0O1xyXG5cclxuICBjb25zdCBjSW5kZXggPSBjU2VsZWN0LnNlbGVjdGVkSW5kZXg7XHJcbiAgY29uc3QgbkluZGV4ID0gblNlbGVjdC5zZWxlY3RlZEluZGV4O1xyXG5cclxuICBjb25zdCBjdWlzaW5lID0gY1NlbGVjdFtjSW5kZXhdLnZhbHVlO1xyXG4gIGNvbnN0IG5laWdoYm9yaG9vZCA9IG5TZWxlY3RbbkluZGV4XS52YWx1ZTtcclxuXHJcbiAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50QnlDdWlzaW5lQW5kTmVpZ2hib3Job29kKGN1aXNpbmUsIG5laWdoYm9yaG9vZClcclxuICAgIC50aGVuKHJlc3RhdXJhbnRzID0+IHtcclxuICAgICAgcmVzZXRSZXN0YXVyYW50cyhyZXN0YXVyYW50cyk7XHJcbiAgICAgIGZpbGxSZXN0YXVyYW50c0hUTUwoKTtcclxuICAgIH0pLmNhdGNoKGVycm9yID0+IGNvbnNvbGUuZXJyb3IoZXJyb3IpKTtcclxufTtcclxuXHJcbi8qKlxyXG4gKiBDbGVhciBjdXJyZW50IHJlc3RhdXJhbnRzLCB0aGVpciBIVE1MIGFuZCByZW1vdmUgdGhlaXIgbWFwIG1hcmtlcnMuXHJcbiAqL1xyXG5jb25zdCByZXNldFJlc3RhdXJhbnRzID0gKHJlc3RhdXJhbnRzKSA9PiB7XHJcbiAgLy8gUmVtb3ZlIGFsbCByZXN0YXVyYW50c1xyXG4gIHNlbGYucmVzdGF1cmFudHMgPSBbXTtcclxuICBjb25zdCB1bCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50cy1saXN0Jyk7XHJcbiAgdWwuaW5uZXJIVE1MID0gJyc7XHJcblxyXG4gIC8vIFJlbW92ZSBhbGwgbWFwIG1hcmtlcnNcclxuXHJcbiAgc2VsZi5tYXJrZXJzLmZvckVhY2gobSA9PiBtLnNldE1hcChudWxsKSk7XHJcbiAgc2VsZi5tYXJrZXJzID0gW107XHJcbiAgc2VsZi5yZXN0YXVyYW50cyA9IHJlc3RhdXJhbnRzO1xyXG59O1xyXG5cclxuLyoqXHJcbiAqIENyZWF0ZSBhbGwgcmVzdGF1cmFudHMgSFRNTCBhbmQgYWRkIHRoZW0gdG8gdGhlIHdlYnBhZ2UuXHJcbiAqL1xyXG5jb25zdCBmaWxsUmVzdGF1cmFudHNIVE1MID0gKHJlc3RhdXJhbnRzID0gc2VsZi5yZXN0YXVyYW50cykgPT4ge1xyXG4gIGNvbnN0IHVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnRzLWxpc3QnKTtcclxuICByZXN0YXVyYW50cy5mb3JFYWNoKHJlc3RhdXJhbnQgPT4ge1xyXG4gICAgdWwuYXBwZW5kKGNyZWF0ZVJlc3RhdXJhbnRIVE1MKHJlc3RhdXJhbnQpKTtcclxuICAgIHVsLnNldEF0dHJpYnV0ZSgnYXJpYS1zZXRzaXplJywgcmVzdGF1cmFudHMubGVuZ3RoKTtcclxuICB9KTtcclxuICBhZGRNYXJrZXJzVG9NYXAoKTtcclxuICBjb25zb2xlLmxvZygnUmVzdGF1cmFudHMgSFRNTCBmaWxsZWQnKTtcclxuICBhY3RpdmF0ZUxhenlMb2FkaW5nKCk7XHJcbn07XHJcblxyXG4vKipcclxuICogUmV0dXJuIHRoZSBhdmVyYWdlIG5vdGUgb2YgdGhlIHJlc3RhdXJhbnQuXHJcbiAqL1xyXG5jb25zdCBnZXRBdmVyYWdlTm90ZSA9IChyZXZpZXdzKSA9PiB7XHJcbiAgbGV0IGF2ZXJhZ2VOb3RlID0gMDtcclxuICByZXZpZXdzLmZvckVhY2gocmV2aWV3ID0+IHtcclxuICAgIGF2ZXJhZ2VOb3RlID0gYXZlcmFnZU5vdGUgKyBOdW1iZXIocmV2aWV3LnJhdGluZyk7XHJcbiAgfSk7XHJcbiAgYXZlcmFnZU5vdGUgPSBhdmVyYWdlTm90ZSAvIHJldmlld3MubGVuZ3RoO1xyXG4gIHJldHVybiAoTWF0aC5yb3VuZChhdmVyYWdlTm90ZSAqIDEwKSkgLyAxMDtcclxufTtcclxuXHJcbi8qKlxyXG4gKiBDcmVhdGUgcmVzdGF1cmFudCBIVE1MLlxyXG4gKi9cclxuY29uc3QgY3JlYXRlUmVzdGF1cmFudEhUTUwgPSAocmVzdGF1cmFudCkgPT4ge1xyXG4gIFxyXG4gIGNvbnN0IGxpID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGknKTtcclxuICBjb25zdCBmaWd1cmUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdmaWd1cmUnKTtcclxuICBjb25zdCBmaWdjYXB0aW9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZmlnY2FwdGlvbicpO1xyXG4gIGNvbnN0IHBpY3R1cmUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwaWN0dXJlJyk7XHJcbiAgY29uc3Qgc291cmNlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc291cmNlJyk7XHJcbiAgY29uc3Qgc2Vjb25kU291cmNlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc291cmNlJyk7XHJcbiAgY29uc3QgdGhTb3VyY2UgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzb3VyY2UnKTtcclxuICBjb25zdCBzb3VyY2VXZWJwID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc291cmNlJyk7XHJcbiAgY29uc3Qgc2Vjb25kU291cmNlV2VicCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NvdXJjZScpO1xyXG4gIGNvbnN0IHRoU291cmNlV2VicCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NvdXJjZScpO1xyXG4gIGNvbnN0IGltYWdlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW1nJyk7XHJcbiAgY29uc3QgY29udGFpbmVyTm90ZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2FzaWRlJyk7XHJcbiAgY29uc3Qgbm90ZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcclxuXHJcbiAgc291cmNlV2VicC5kYXRhc2V0LnNyY3NldCA9IGAke0RCSGVscGVyLmltYWdlV2VicFVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCl9LWxhcmdlX3gxLndlYnAgMXgsICR7REJIZWxwZXIuaW1hZ2VXZWJwVXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KX0tbGFyZ2VfeDIud2VicCAyeGA7XHJcbiAgc291cmNlV2VicC5zcmNzZXQgPSBgJHtEQkhlbHBlci5pbWFnZVdlYnBVcmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpfS1sYXp5LndlYnBgO1xyXG4gIHNvdXJjZVdlYnAubWVkaWEgPSAnKG1pbi13aWR0aDogMTAwMHB4KSc7XHJcbiAgc291cmNlV2VicC5jbGFzc05hbWUgPSAnbGF6eSc7XHJcbiAgc291cmNlLmRhdGFzZXQuc3Jjc2V0ID0gYCR7REJIZWxwZXIuaW1hZ2VVcmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpfS1sYXJnZV94MS5qcGcgMXgsICR7REJIZWxwZXIuaW1hZ2VVcmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpfS1sYXJnZV94Mi5qcGcgMnhgO1xyXG4gIHNvdXJjZS5zcmNzZXQgPSBgJHtEQkhlbHBlci5pbWFnZVdlYnBVcmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpfS1sYXp5LmpwZ2A7XHJcbiAgc291cmNlLm1lZGlhID0gJyhtaW4td2lkdGg6IDEwMDBweCknO1xyXG4gIHNvdXJjZS5jbGFzc05hbWUgPSAnbGF6eSc7XHJcbiAgXHJcbiAgc2Vjb25kU291cmNlV2VicC5kYXRhc2V0LnNyY3NldCA9IGAke0RCSGVscGVyLmltYWdlV2VicFVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCl9LW1lZGl1bV94MS53ZWJwIDF4LCAke0RCSGVscGVyLmltYWdlV2VicFVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCl9LW1lZGl1bV94Mi53ZWJwIDJ4YDtcclxuICBzZWNvbmRTb3VyY2VXZWJwLnNyY3NldCA9IGAke0RCSGVscGVyLmltYWdlV2VicFVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCl9LWxhenkud2VicGA7XHJcbiAgc2Vjb25kU291cmNlV2VicC5tZWRpYSA9ICcobWluLXdpZHRoOiA0MjBweCknO1xyXG4gIHNlY29uZFNvdXJjZVdlYnAuY2xhc3NOYW1lID0gJ2xhenknO1xyXG4gIHNlY29uZFNvdXJjZS5kYXRhc2V0LnNyY3NldCA9IGAke0RCSGVscGVyLmltYWdlVXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KX0tbWVkaXVtX3gxLmpwZyAxeCwgJHtEQkhlbHBlci5pbWFnZVVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCl9LW1lZGl1bV94Mi5qcGcgMnhgO1xyXG4gIHNlY29uZFNvdXJjZS5zcmNzZXQgPSBgJHtEQkhlbHBlci5pbWFnZVdlYnBVcmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpfS1sYXp5LmpwZ2A7XHJcbiAgc2Vjb25kU291cmNlLm1lZGlhID0gJyhtaW4td2lkdGg6IDQyMHB4KSc7XHJcbiAgc2Vjb25kU291cmNlLmNsYXNzTmFtZSA9ICdsYXp5JztcclxuICBcclxuICB0aFNvdXJjZVdlYnAuZGF0YXNldC5zcmNzZXQgPSBgJHtEQkhlbHBlci5pbWFnZVdlYnBVcmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpfS1zbWFsbF94Mi53ZWJwIDJ4LCAke0RCSGVscGVyLmltYWdlV2VicFVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCl9LXNtYWxsX3gxLndlYnAgMXhgO1xyXG4gIHRoU291cmNlV2VicC5zcmNzZXQgPSBgJHtEQkhlbHBlci5pbWFnZVdlYnBVcmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpfS1sYXp5LndlYnBgO1xyXG4gIHRoU291cmNlV2VicC5tZWRpYSA9ICcobWluLXdpZHRoOiAzMjBweCknO1xyXG4gIHRoU291cmNlV2VicC5jbGFzc05hbWUgPSAnbGF6eSc7XHJcbiAgdGhTb3VyY2UuZGF0YXNldC5zcmNzZXQgPSBgJHtEQkhlbHBlci5pbWFnZVVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCl9LXNtYWxsX3gyLmpwZyAyeCwgJHtEQkhlbHBlci5pbWFnZVVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCl9LXNtYWxsX3gxLmpwZyAxeGA7XHJcbiAgdGhTb3VyY2Uuc3Jjc2V0ID0gYCR7REJIZWxwZXIuaW1hZ2VXZWJwVXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KX0tbGF6eS5qcGdgO1xyXG4gIHRoU291cmNlLm1lZGlhID0gJyhtaW4td2lkdGg6IDMyMHB4KSc7XHJcbiAgdGhTb3VyY2UuY2xhc3NOYW1lID0gJ2xhenknO1xyXG4gIFxyXG4gIGltYWdlLmRhdGFzZXQuc3JjID0gYCR7REJIZWxwZXIuaW1hZ2VVcmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpfS1zbWFsbF94MS5qcGdgO1xyXG4gIGltYWdlLnNyYyA9IGAke0RCSGVscGVyLmltYWdlVXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KX0tbGF6eS5qcGdgO1xyXG4gIGltYWdlLmNsYXNzTmFtZSA9ICdyZXN0YXVyYW50LWltZyBsYXp5JztcclxuICBpbWFnZS5zZXRBdHRyaWJ1dGUoJ3NpemVzJywgJyhtYXgtd2lkdGg6IDExMDBweCkgODV2dywgKG1pbi13aWR0aDogMTEwMXB4KSA5OTBweCcpO1xyXG4gIGltYWdlLmFsdCA9IGAke3Jlc3RhdXJhbnQubmFtZX0ncyByZXN0YXVyYW50YDtcclxuICBcclxuICBub3RlLmlubmVySFRNTCA9IGAke2dldEF2ZXJhZ2VOb3RlKHJlc3RhdXJhbnQucmV2aWV3cyl9LzVgO1xyXG5cclxuICBjb250YWluZXJOb3RlLmFwcGVuZChub3RlKTtcclxuXHJcbiAgcGljdHVyZS5hcHBlbmQoc291cmNlV2VicCk7XHJcbiAgcGljdHVyZS5hcHBlbmQoc291cmNlKTtcclxuICBwaWN0dXJlLmFwcGVuZChzZWNvbmRTb3VyY2VXZWJwKTtcclxuICBwaWN0dXJlLmFwcGVuZChzZWNvbmRTb3VyY2UpO1xyXG4gIHBpY3R1cmUuYXBwZW5kKHRoU291cmNlV2VicCk7XHJcbiAgcGljdHVyZS5hcHBlbmQodGhTb3VyY2UpO1xyXG4gIHBpY3R1cmUuYXBwZW5kKGltYWdlKTtcclxuICBmaWd1cmUuYXBwZW5kKHBpY3R1cmUpO1xyXG4gIGZpZ3VyZS5hcHBlbmQoZmlnY2FwdGlvbik7XHJcbiAgXHJcbiAgbGkuYXBwZW5kKGNvbnRhaW5lck5vdGUpO1xyXG4gIGxpLmFwcGVuZChmaWd1cmUpO1xyXG4gIFxyXG4gIGNvbnN0IG5hbWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdoMicpO1xyXG4gIG5hbWUuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5uYW1lO1xyXG4gIGZpZ2NhcHRpb24uYXBwZW5kKG5hbWUpO1xyXG5cclxuICBjb25zdCBuZWlnaGJvcmhvb2QgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XHJcbiAgbmVpZ2hib3Job29kLmlubmVySFRNTCA9IHJlc3RhdXJhbnQubmVpZ2hib3Job29kO1xyXG4gIGxpLmFwcGVuZChuZWlnaGJvcmhvb2QpO1xyXG5cclxuICBjb25zdCBhZGRyZXNzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xyXG4gIGFkZHJlc3MuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5hZGRyZXNzO1xyXG4gIGxpLmFwcGVuZChhZGRyZXNzKTtcclxuXHJcbiAgY29uc3QgbW9yZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTtcclxuICBtb3JlLmlubmVySFRNTCA9ICdWaWV3IERldGFpbHMnO1xyXG4gIG1vcmUuaHJlZiA9IERCSGVscGVyLnVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCk7XHJcbiAgbW9yZS5zZXRBdHRyaWJ1dGUoJ2FyaWEtbGFiZWwnLCBgVmlldyBkZXRhaWxzIG9mICR7cmVzdGF1cmFudC5uYW1lfWApO1xyXG4gIGxpLmFwcGVuZChtb3JlKTtcclxuXHJcbiAgcmV0dXJuIGxpO1xyXG59O1xyXG5cclxuLyoqXHJcbiAqIEFkZCBtYXJrZXJzIGZvciBjdXJyZW50IHJlc3RhdXJhbnRzIHRvIHRoZSBtYXAuXHJcbiAqL1xyXG5jb25zdCBhZGRNYXJrZXJzVG9NYXAgPSAocmVzdGF1cmFudHMgPSBzZWxmLnJlc3RhdXJhbnRzKSA9PiB7XHJcbiAgcmVzdGF1cmFudHMuZm9yRWFjaChyZXN0YXVyYW50ID0+IHtcclxuICAgIC8vIEFkZCBtYXJrZXIgdG8gdGhlIG1hcFxyXG4gICAgY29uc3QgbWFya2VyID0gREJIZWxwZXIubWFwTWFya2VyRm9yUmVzdGF1cmFudChyZXN0YXVyYW50LCBzZWxmLm1hcCk7XHJcbiAgICBnb29nbGUubWFwcy5ldmVudC5hZGRMaXN0ZW5lcihtYXJrZXIsICdjbGljaycsICgpID0+IHtcclxuICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSBtYXJrZXIudXJsO1xyXG4gICAgfSk7XHJcbiAgICBzZWxmLm1hcmtlcnMucHVzaChtYXJrZXIpO1xyXG4gIH0pO1xyXG59O1xyXG5cclxuXHJcbiJdfQ==
