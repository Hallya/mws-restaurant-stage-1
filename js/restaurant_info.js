/* global DBHelper */

var restaurant;
var map;

if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('sw.js').then(registration => {
      console.log('registration to serviceWorker complete with scope :', registration.scope);
    });
  });
}
/**
 * Initialize Google map, called from HTML.
 */
window.initMap = () => {
  fetchRestaurantFromURL().then(restaurant => {
    self.map = new google.maps.Map(document.getElementById('map'), {
      zoom: 16,
      center: restaurant.latlng,
      scrollwheel: false
    });
    DBHelper.mapMarkerForRestaurant(self.restaurant, self.map);
    fillBreadcrumb();
  });
};

/**
 * Get current restaurant from page URL.
 */
const fetchRestaurantFromURL = () => {
  if (self.restaurant) {
    // restaurant already fetched!
    return;
  }
  const id = getParameterByName('id');
  if (!id) {
    // no id found in URL
    return console.error('No restaurant id in URL');
  }
  return DBHelper.fetchRestaurantById(id).then(restaurant => self.restaurant = restaurant).then(fillRestaurantHTML).catch(error => console.error(error));
};

/**
 * Create restaurant HTML and add it to the webpage
 */
const fillRestaurantHTML = (restaurant = self.restaurant) => {
  const name = document.getElementById('restaurant-name');
  name.innerHTML = restaurant.name;

  const address = document.getElementById('restaurant-address');
  address.innerHTML = restaurant.address;
  address.setAttribute('aria-label', `located at ${restaurant.address}`);

  const source = document.getElementById('restaurant-source');
  const sourceWebp = document.getElementById('restaurant-sourceWebp');
  sourceWebp.srcset = `${DBHelper.imageWebpUrlForRestaurant(restaurant)}-large_x1.webp 1x, ${DBHelper.imageUrlForRestaurant(restaurant)}-large_x2.webp 2x`;
  sourceWebp.media = '(min-width: 1000px)';
  source.srcset = `${DBHelper.imageUrlForRestaurant(restaurant)}-large_x1.jpg 1x, ${DBHelper.imageUrlForRestaurant(restaurant)}-large_x2.jpg 2x`;
  source.media = '(min-width: 1000px)';

  const ndSource = document.getElementById('restaurant-ndSource');
  const ndSourceWebp = document.getElementById('restaurant-ndSourceWebp');
  ndSourceWebp.srcset = `${DBHelper.imageUrlForRestaurant(restaurant)}-medium_x1.webp 1x, ${DBHelper.imageUrlForRestaurant(restaurant)}-medium_x2.jpg 2x`;
  ndSourceWebp.media = '(min-width: 420px)';
  ndSource.srcset = `${DBHelper.imageUrlForRestaurant(restaurant)}-medium_x1.jpg 1x, ${DBHelper.imageUrlForRestaurant(restaurant)}-medium_x2.jpg 2x`;
  ndSource.media = '(min-width: 420px)';

  const thSource = document.getElementById('restaurant-thSource');
  const thSourceWebp = document.getElementById('restaurant-thSourceWebp');
  thSourceWebp.srcset = `${DBHelper.imageUrlForRestaurant(restaurant)}-small_x2.webp 2x, ${DBHelper.imageUrlForRestaurant(restaurant)}-small_x1.jpg 1x`;
  thSourceWebp.media = '(min-width: 320px)';
  thSource.srcset = `${DBHelper.imageUrlForRestaurant(restaurant)}-small_x2.jpg 2x, ${DBHelper.imageUrlForRestaurant(restaurant)}-small_x1.jpg 1x`;
  thSource.media = '(min-width: 320px)';

  const image = document.getElementById('restaurant-img');
  image.className = 'restaurant-img';
  image.src = `${DBHelper.imageUrlForRestaurant(restaurant)}-large_x1.jpg`;
  image.setAttribute('sizes', '(max-width: 1100px) 85vw, (min-width: 1101px) 990px');
  image.alt = `${restaurant.name}'s  restaurant`;

  const cuisine = document.getElementById('restaurant-cuisine');
  cuisine.innerHTML = restaurant.cuisine_type;
  const labelFoodType = document.createElement('label');
  labelFoodType.innerHTML = `${restaurant.cuisine_type} food`;
  labelFoodType.setAttribute('hidden', 'hidden');
  labelFoodType.id = 'foodType';
  cuisine.parentNode.insertBefore(labelFoodType, cuisine.nextSibling);

  // fill operating hours
  if (restaurant.operating_hours) {
    fillRestaurantHoursHTML();
  }
  // fill reviews
  fillReviewsHTML();
  return restaurant;
};

/**
 * Create restaurant operating hours HTML table and add it to the webpage.
 */
const fillRestaurantHoursHTML = (operatingHours = self.restaurant.operating_hours) => {
  const hours = document.getElementById('restaurant-hours');
  for (let key in operatingHours) {
    const row = document.createElement('tr');

    const day = document.createElement('td');
    day.innerHTML = key;
    day.setAttribute('aria-label', `open on ${key}`);
    row.appendChild(day);

    const time = document.createElement('td');
    time.innerHTML = operatingHours[key];
    time.setAttribute('aria-label', `${operatingHours[key]},`);
    row.appendChild(time);
    row.setAttribute('role', 'row');
    hours.appendChild(row);
  }
};

/**
 * Create all reviews HTML and add them to the webpage.
 */
const fillReviewsHTML = (reviews = self.restaurant.reviews) => {
  const container = document.getElementById('reviews-container');
  const title = document.createElement('h3');
  title.innerHTML = 'Reviews';
  container.appendChild(title);

  if (!reviews) {
    const noReviews = document.createElement('p');
    noReviews.innerHTML = 'No reviews yet!';
    container.appendChild(noReviews);
    return;
  }
  const ul = document.getElementById('reviews-list');
  reviews.forEach(review => {
    ul.appendChild(createReviewHTML(review));
  });
  container.appendChild(ul);
};

/**
 * Create review HTML and add it to the webpage.
 */
const createReviewHTML = review => {
  const li = document.createElement('li');
  const name = document.createElement('p');
  name.className = 'userName';
  name.innerHTML = review.name;
  name.setAttribute('aria-label', `${review.name},`);
  li.appendChild(name);

  const date = document.createElement('p');
  date.className = 'dateReview';
  date.innerHTML = review.date;
  date.setAttribute('aria-label', `${review.date},`);
  li.appendChild(date);

  const rating = document.createElement('p');
  let stars = document.createElement('span');
  rating.className = 'userRating';
  stars.className = 'ratingStars';
  for (let i = 0; i < review.rating; i++) {
    stars.innerHTML += 'â˜…';
  }
  stars.setAttribute('aria-label', `${review.rating} stars on 5,`);
  rating.innerHTML = 'Rating: ';
  rating.appendChild(stars);
  li.appendChild(rating);

  const comments = document.createElement('p');
  comments.className = 'userComments';
  comments.innerHTML = review.comments;
  li.appendChild(comments);

  li.setAttribute('role', 'listitem');
  return li;
};

/**
 * Add restaurant name to the breadcrumb navigation menu
 */
const fillBreadcrumb = (restaurant = self.restaurant) => {
  const breadcrumb = document.getElementById('breadcrumb');
  const li = document.createElement('li');
  li.innerHTML = ` ${restaurant.name}`;
  li.className = 'fontawesome-arrow-right';
  li.setAttribute('aria-current', 'page');
  breadcrumb.appendChild(li);
};

/**
 * Get a parameter by name from page URL.
 */
const getParameterByName = (name, url) => {
  if (!url) url = window.location.href;
  name = name.replace(/[\[\]]/g, '\\$&');
  const regex = new RegExp(`[?&]${name}(=([^&#]*)|&|#|$)`),
        results = regex.exec(url);
  if (!results) return null;
  if (!results[2]) return '';
  return decodeURIComponent(results[2].replace(/\+/g, ' '));
};
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInJlc3RhdXJhbnRfaW5mby5qcyJdLCJuYW1lcyI6WyJyZXN0YXVyYW50IiwibWFwIiwibmF2aWdhdG9yIiwid2luZG93IiwiYWRkRXZlbnRMaXN0ZW5lciIsInNlcnZpY2VXb3JrZXIiLCJyZWdpc3RlciIsInRoZW4iLCJyZWdpc3RyYXRpb24iLCJjb25zb2xlIiwibG9nIiwic2NvcGUiLCJpbml0TWFwIiwiZmV0Y2hSZXN0YXVyYW50RnJvbVVSTCIsInNlbGYiLCJnb29nbGUiLCJtYXBzIiwiTWFwIiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsInpvb20iLCJjZW50ZXIiLCJsYXRsbmciLCJzY3JvbGx3aGVlbCIsIkRCSGVscGVyIiwibWFwTWFya2VyRm9yUmVzdGF1cmFudCIsImZpbGxCcmVhZGNydW1iIiwiaWQiLCJnZXRQYXJhbWV0ZXJCeU5hbWUiLCJlcnJvciIsImZldGNoUmVzdGF1cmFudEJ5SWQiLCJmaWxsUmVzdGF1cmFudEhUTUwiLCJjYXRjaCIsIm5hbWUiLCJpbm5lckhUTUwiLCJhZGRyZXNzIiwic2V0QXR0cmlidXRlIiwic291cmNlIiwic291cmNlV2VicCIsInNyY3NldCIsImltYWdlV2VicFVybEZvclJlc3RhdXJhbnQiLCJpbWFnZVVybEZvclJlc3RhdXJhbnQiLCJtZWRpYSIsIm5kU291cmNlIiwibmRTb3VyY2VXZWJwIiwidGhTb3VyY2UiLCJ0aFNvdXJjZVdlYnAiLCJpbWFnZSIsImNsYXNzTmFtZSIsInNyYyIsImFsdCIsImN1aXNpbmUiLCJjdWlzaW5lX3R5cGUiLCJsYWJlbEZvb2RUeXBlIiwiY3JlYXRlRWxlbWVudCIsInBhcmVudE5vZGUiLCJpbnNlcnRCZWZvcmUiLCJuZXh0U2libGluZyIsIm9wZXJhdGluZ19ob3VycyIsImZpbGxSZXN0YXVyYW50SG91cnNIVE1MIiwiZmlsbFJldmlld3NIVE1MIiwib3BlcmF0aW5nSG91cnMiLCJob3VycyIsImtleSIsInJvdyIsImRheSIsImFwcGVuZENoaWxkIiwidGltZSIsInJldmlld3MiLCJjb250YWluZXIiLCJ0aXRsZSIsIm5vUmV2aWV3cyIsInVsIiwiZm9yRWFjaCIsInJldmlldyIsImNyZWF0ZVJldmlld0hUTUwiLCJsaSIsImRhdGUiLCJyYXRpbmciLCJzdGFycyIsImkiLCJjb21tZW50cyIsImJyZWFkY3J1bWIiLCJ1cmwiLCJsb2NhdGlvbiIsImhyZWYiLCJyZXBsYWNlIiwicmVnZXgiLCJSZWdFeHAiLCJyZXN1bHRzIiwiZXhlYyIsImRlY29kZVVSSUNvbXBvbmVudCJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUEsSUFBSUEsVUFBSjtBQUNBLElBQUlDLEdBQUo7O0FBRUEsSUFBSSxtQkFBbUJDLFNBQXZCLEVBQWtDO0FBQ2hDQyxTQUFPQyxnQkFBUCxDQUF3QixNQUF4QixFQUFnQyxNQUFNO0FBQ3BDRixjQUFVRyxhQUFWLENBQXdCQyxRQUF4QixDQUFpQyxPQUFqQyxFQUEwQ0MsSUFBMUMsQ0FBK0NDLGdCQUFnQjtBQUM3REMsY0FBUUMsR0FBUixDQUFZLHFEQUFaLEVBQW1FRixhQUFhRyxLQUFoRjtBQUNELEtBRkQ7QUFHRCxHQUpEO0FBS0Q7QUFDRDs7O0FBR0FSLE9BQU9TLE9BQVAsR0FBaUIsTUFBTTtBQUNyQkMsMkJBQ0dOLElBREgsQ0FDUVAsY0FBYztBQUNsQmMsU0FBS2IsR0FBTCxHQUFXLElBQUljLE9BQU9DLElBQVAsQ0FBWUMsR0FBaEIsQ0FBb0JDLFNBQVNDLGNBQVQsQ0FBd0IsS0FBeEIsQ0FBcEIsRUFBb0Q7QUFDN0RDLFlBQU0sRUFEdUQ7QUFFN0RDLGNBQVFyQixXQUFXc0IsTUFGMEM7QUFHN0RDLG1CQUFhO0FBSGdELEtBQXBELENBQVg7QUFLQUMsYUFBU0Msc0JBQVQsQ0FBZ0NYLEtBQUtkLFVBQXJDLEVBQWlEYyxLQUFLYixHQUF0RDtBQUNBeUI7QUFDRCxHQVRIO0FBVUQsQ0FYRDs7QUFhQTs7O0FBR0EsTUFBTWIseUJBQXlCLE1BQU07QUFDbkMsTUFBSUMsS0FBS2QsVUFBVCxFQUFxQjtBQUFFO0FBQ3JCO0FBQ0Q7QUFDRCxRQUFN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QVdILE9BQVgsQ0FBbUIsS0FBbkIsRUFBMEIsR0FBMUIsQ0FBbkIsQ0FBUDtBQUNELENBWEQiLCJmaWxlIjoicmVzdGF1cmFudF9pbmZvLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyogZ2xvYmFsIERCSGVscGVyICovXG5cbnZhciByZXN0YXVyYW50O1xudmFyIG1hcDtcblxuaWYgKCdzZXJ2aWNlV29ya2VyJyBpbiBuYXZpZ2F0b3IpIHtcbiAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2xvYWQnLCAoKSA9PiB7XG4gICAgbmF2aWdhdG9yLnNlcnZpY2VXb3JrZXIucmVnaXN0ZXIoJ3N3LmpzJykudGhlbihyZWdpc3RyYXRpb24gPT4ge1xuICAgICAgY29uc29sZS5sb2coJ3JlZ2lzdHJhdGlvbiB0byBzZXJ2aWNlV29ya2VyIGNvbXBsZXRlIHdpdGggc2NvcGUgOicsIHJlZ2lzdHJhdGlvbi5zY29wZSk7XG4gICAgfSk7XG4gIH0pO1xufVxuLyoqXG4gKiBJbml0aWFsaXplIEdvb2dsZSBtYXAsIGNhbGxlZCBmcm9tIEhUTUwuXG4gKi9cbndpbmRvdy5pbml0TWFwID0gKCkgPT4ge1xuICBmZXRjaFJlc3RhdXJhbnRGcm9tVVJMKClcbiAgICAudGhlbihyZXN0YXVyYW50ID0+IHtcbiAgICAgIHNlbGYubWFwID0gbmV3IGdvb2dsZS5tYXBzLk1hcChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFwJyksIHtcbiAgICAgICAgem9vbTogMTYsXG4gICAgICAgIGNlbnRlcjogcmVzdGF1cmFudC5sYXRsbmcsXG4gICAgICAgIHNjcm9sbHdoZWVsOiBmYWxzZVxuICAgICAgfSk7XG4gICAgICBEQkhlbHBlci5tYXBNYXJrZXJGb3JSZXN0YXVyYW50KHNlbGYucmVzdGF1cmFudCwgc2VsZi5tYXApO1xuICAgICAgZmlsbEJyZWFkY3J1bWIoKTtcbiAgICB9KTtcbn07XG5cbi8qKlxuICogR2V0IGN1cnJlbnQgcmVzdGF1cmFudCBmcm9tIHBhZ2UgVVJMLlxuICovXG5jb25zdCBmZXRjaFJlc3RhdXJhbnRGcm9tVVJMID0gKCkgPT4ge1xuICBpZiAoc2VsZi5yZXN0YXVyYW50KSB7IC8vIHJlc3RhdXJhbnQgYWxyZWFkeSBmZXRjaGVkIVxuICAgIHJldHVybjtcbiAgfVxuICBjb25zdCBpZCA9IGdldFBhcmFtZXRlckJ5TmFtZSgnaWQnKTtcbiAgaWYgKCFpZCkgeyAvLyBubyBpZCBmb3VuZCBpbiBVUkxcbiAgICByZXR1cm4gY29uc29sZS5lcnJvcignTm8gcmVzdGF1cmFudCBpZCBpbiBVUkwnKTtcbiAgfVxuICByZXR1cm4gREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50QnlJZChpZClcbiAgICAudGhlbihyZXN0YXVyYW50ID0+IHNlbGYucmVzdGF1cmFudCA9IHJlc3RhdXJhbnQpXG4gICAgLnRoZW4oZmlsbFJlc3RhdXJhbnRIVE1MKVxuICAgIC5jYXRjaChlcnJvciA9PiBjb25zb2xlLmVycm9yKGVycm9yKSk7XG59O1xuXG4vKipcbiAqIENyZWF0ZSByZXN0YXVyYW50IEhUTUwgYW5kIGFkZCBpdCB0byB0aGUgd2VicGFnZVxuICovXG5jb25zdCBmaWxsUmVzdGF1cmFudEhUTUwgPSAocmVzdGF1cmFudCA9IHNlbGYucmVzdGF1cmFudCkgPT4ge1xuICBjb25zdCBuYW1lID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnQtbmFtZScpO1xuICBuYW1lLmlubmVySFRNTCA9IHJlc3RhdXJhbnQubmFtZTtcblxuICBjb25zdCBhZGRyZXNzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnQtYWRkcmVzcycpO1xuICBhZGRyZXNzLmlubmVySFRNTCA9IHJlc3RhdXJhbnQuYWRkcmVzcztcbiAgYWRkcmVzcy5zZXRBdHRyaWJ1dGUoJ2FyaWEtbGFiZWwnLCBgbG9jYXRlZCBhdCAke3Jlc3RhdXJhbnQuYWRkcmVzc31gKTtcblxuICBjb25zdCBzb3VyY2UgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudC1zb3VyY2UnKTtcbiAgY29uc3Qgc291cmNlV2VicCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50LXNvdXJjZVdlYnAnKTtcbiAgc291cmNlV2VicC5zcmNzZXQgPSBgJHtEQkhlbHBlci5pbWFnZVdlYnBVcmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpfS1sYXJnZV94MS53ZWJwIDF4LCAke0RCSGVscGVyLmltYWdlVXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KX0tbGFyZ2VfeDIud2VicCAyeGA7XG4gIHNvdXJjZVdlYnAubWVkaWEgPSAnKG1pbi13aWR0aDogMTAwMHB4KSc7XG4gIHNvdXJjZS5zcmNzZXQgPSBgJHtEQkhlbHBlci5pbWFnZVVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCl9LWxhcmdlX3gxLmpwZyAxeCwgJHtEQkhlbHBlci5pbWFnZVVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCl9LWxhcmdlX3gyLmpwZyAyeGA7XG4gIHNvdXJjZS5tZWRpYSA9ICcobWluLXdpZHRoOiAxMDAwcHgpJztcblxuICBjb25zdCBuZFNvdXJjZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50LW5kU291cmNlJyk7XG4gIGNvbnN0IG5kU291cmNlV2VicCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50LW5kU291cmNlV2VicCcpO1xuICBuZFNvdXJjZVdlYnAuc3Jjc2V0ID0gYCR7REJIZWxwZXIuaW1hZ2VVcmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpfS1tZWRpdW1feDEud2VicCAxeCwgJHtEQkhlbHBlci5pbWFnZVVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCl9LW1lZGl1bV94Mi5qcGcgMnhgO1xuICBuZFNvdXJjZVdlYnAubWVkaWEgPSAnKG1pbi13aWR0aDogNDIwcHgpJztcbiAgbmRTb3VyY2Uuc3Jjc2V0ID0gYCR7REJIZWxwZXIuaW1hZ2VVcmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpfS1tZWRpdW1feDEuanBnIDF4LCAke0RCSGVscGVyLmltYWdlVXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KX0tbWVkaXVtX3gyLmpwZyAyeGA7XG4gIG5kU291cmNlLm1lZGlhID0gJyhtaW4td2lkdGg6IDQyMHB4KSc7XG5cbiAgY29uc3QgdGhTb3VyY2UgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudC10aFNvdXJjZScpO1xuICBjb25zdCB0aFNvdXJjZVdlYnAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudC10aFNvdXJjZVdlYnAnKTtcbiAgdGhTb3VyY2VXZWJwLnNyY3NldCA9IGAke0RCSGVscGVyLmltYWdlVXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KX0tc21hbGxfeDIud2VicCAyeCwgJHtEQkhlbHBlci5pbWFnZVVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCl9LXNtYWxsX3gxLmpwZyAxeGA7XG4gIHRoU291cmNlV2VicC5tZWRpYSA9ICcobWluLXdpZHRoOiAzMjBweCknO1xuICB0aFNvdXJjZS5zcmNzZXQgPSBgJHtEQkhlbHBlci5pbWFnZVVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCl9LXNtYWxsX3gyLmpwZyAyeCwgJHtEQkhlbHBlci5pbWFnZVVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCl9LXNtYWxsX3gxLmpwZyAxeGA7XG4gIHRoU291cmNlLm1lZGlhID0gJyhtaW4td2lkdGg6IDMyMHB4KSc7XG5cbiAgY29uc3QgaW1hZ2UgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudC1pbWcnKTtcbiAgaW1hZ2UuY2xhc3NOYW1lID0gJ3Jlc3RhdXJhbnQtaW1nJztcbiAgaW1hZ2Uuc3JjID0gYCR7REJIZWxwZXIuaW1hZ2VVcmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpfS1sYXJnZV94MS5qcGdgO1xuICBpbWFnZS5zZXRBdHRyaWJ1dGUoJ3NpemVzJywgJyhtYXgtd2lkdGg6IDExMDBweCkgODV2dywgKG1pbi13aWR0aDogMTEwMXB4KSA5OTBweCcpO1xuICBpbWFnZS5hbHQgPSBgJHtyZXN0YXVyYW50Lm5hbWV9J3MgIHJlc3RhdXJhbnRgO1xuXG4gIGNvbnN0IGN1aXNpbmUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudC1jdWlzaW5lJyk7XG4gIGN1aXNpbmUuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5jdWlzaW5lX3R5cGU7XG4gIGNvbnN0IGxhYmVsRm9vZFR5cGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsYWJlbCcpO1xuICBsYWJlbEZvb2RUeXBlLmlubmVySFRNTCA9IGAke3Jlc3RhdXJhbnQuY3Vpc2luZV90eXBlfSBmb29kYDtcbiAgbGFiZWxGb29kVHlwZS5zZXRBdHRyaWJ1dGUoJ2hpZGRlbicsICdoaWRkZW4nKTtcbiAgbGFiZWxGb29kVHlwZS5pZCA9ICdmb29kVHlwZSc7XG4gIGN1aXNpbmUucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUobGFiZWxGb29kVHlwZSwgY3Vpc2luZS5uZXh0U2libGluZyk7XG5cbiAgLy8gZmlsbCBvcGVyYXRpbmcgaG91cnNcbiAgaWYgKHJlc3RhdXJhbnQub3BlcmF0aW5nX2hvdXJzKSB7XG4gICAgZmlsbFJlc3RhdXJhbnRIb3Vyc0hUTUwoKTtcbiAgfVxuICAvLyBmaWxsIHJldmlld3NcbiAgZmlsbFJldmlld3NIVE1MKCk7XG4gIHJldHVybiByZXN0YXVyYW50O1xufTtcblxuLyoqXG4gKiBDcmVhdGUgcmVzdGF1cmFudCBvcGVyYXRpbmcgaG91cnMgSFRNTCB0YWJsZSBhbmQgYWRkIGl0IHRvIHRoZSB3ZWJwYWdlLlxuICovXG5jb25zdCBmaWxsUmVzdGF1cmFudEhvdXJzSFRNTCA9IChvcGVyYXRpbmdIb3VycyA9IHNlbGYucmVzdGF1cmFudC5vcGVyYXRpbmdfaG91cnMpID0+IHtcbiAgY29uc3QgaG91cnMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudC1ob3VycycpO1xuICBmb3IgKGxldCBrZXkgaW4gb3BlcmF0aW5nSG91cnMpIHtcbiAgICBjb25zdCByb3cgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0cicpO1xuXG4gICAgY29uc3QgZGF5ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGQnKTtcbiAgICBkYXkuaW5uZXJIVE1MID0ga2V5O1xuICAgIGRheS5zZXRBdHRyaWJ1dGUoJ2FyaWEtbGFiZWwnLCBgb3BlbiBvbiAke2tleX1gKTtcbiAgICByb3cuYXBwZW5kQ2hpbGQoZGF5KTtcblxuICAgIGNvbnN0IHRpbWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZCcpO1xuICAgIHRpbWUuaW5uZXJIVE1MID0gb3BlcmF0aW5nSG91cnNba2V5XTtcbiAgICB0aW1lLnNldEF0dHJpYnV0ZSgnYXJpYS1sYWJlbCcsIGAke29wZXJhdGluZ0hvdXJzW2tleV19LGApO1xuICAgIHJvdy5hcHBlbmRDaGlsZCh0aW1lKTtcbiAgICByb3cuc2V0QXR0cmlidXRlKCdyb2xlJywgJ3JvdycpO1xuICAgIGhvdXJzLmFwcGVuZENoaWxkKHJvdyk7XG4gIH1cbn07XG5cblxuLyoqXG4gKiBDcmVhdGUgYWxsIHJldmlld3MgSFRNTCBhbmQgYWRkIHRoZW0gdG8gdGhlIHdlYnBhZ2UuXG4gKi9cbmNvbnN0IGZpbGxSZXZpZXdzSFRNTCA9IChyZXZpZXdzID0gc2VsZi5yZXN0YXVyYW50LnJldmlld3MpID0+IHtcbiAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jldmlld3MtY29udGFpbmVyJyk7XG4gIGNvbnN0IHRpdGxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaDMnKTtcbiAgdGl0bGUuaW5uZXJIVE1MID0gJ1Jldmlld3MnO1xuICBjb250YWluZXIuYXBwZW5kQ2hpbGQodGl0bGUpO1xuXG4gIGlmICghcmV2aWV3cykge1xuICAgIGNvbnN0IG5vUmV2aWV3cyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcbiAgICBub1Jldmlld3MuaW5uZXJIVE1MID0gJ05vIHJldmlld3MgeWV0ISc7XG4gICAgY29udGFpbmVyLmFwcGVuZENoaWxkKG5vUmV2aWV3cyk7XG4gICAgcmV0dXJuO1xuICB9XG4gIGNvbnN0IHVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jldmlld3MtbGlzdCcpO1xuICByZXZpZXdzLmZvckVhY2gocmV2aWV3ID0+IHtcbiAgICB1bC5hcHBlbmRDaGlsZChjcmVhdGVSZXZpZXdIVE1MKHJldmlldykpO1xuICB9KTtcbiAgY29udGFpbmVyLmFwcGVuZENoaWxkKHVsKTtcbn07XG5cbi8qKlxuICogQ3JlYXRlIHJldmlldyBIVE1MIGFuZCBhZGQgaXQgdG8gdGhlIHdlYnBhZ2UuXG4gKi9cbmNvbnN0IGNyZWF0ZVJldmlld0hUTUwgPSAocmV2aWV3KSA9PiB7XG4gIGNvbnN0IGxpID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGknKTtcbiAgY29uc3QgbmFtZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcbiAgbmFtZS5jbGFzc05hbWUgPSAndXNlck5hbWUnO1xuICBuYW1lLmlubmVySFRNTCA9IHJldmlldy5uYW1lO1xuICBuYW1lLnNldEF0dHJpYnV0ZSgnYXJpYS1sYWJlbCcsIGAke3Jldmlldy5uYW1lfSxgKTtcbiAgbGkuYXBwZW5kQ2hpbGQobmFtZSk7XG5cbiAgY29uc3QgZGF0ZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcbiAgZGF0ZS5jbGFzc05hbWUgPSAnZGF0ZVJldmlldyc7XG4gIGRhdGUuaW5uZXJIVE1MID0gcmV2aWV3LmRhdGU7XG4gIGRhdGUuc2V0QXR0cmlidXRlKCdhcmlhLWxhYmVsJywgYCR7cmV2aWV3LmRhdGV9LGApO1xuICBsaS5hcHBlbmRDaGlsZChkYXRlKTtcblxuICBjb25zdCByYXRpbmcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XG4gIGxldCBzdGFycyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKTtcbiAgcmF0aW5nLmNsYXNzTmFtZSA9ICd1c2VyUmF0aW5nJztcbiAgc3RhcnMuY2xhc3NOYW1lID0gJ3JhdGluZ1N0YXJzJztcbiAgZm9yIChsZXQgaSA9IDA7IGkgPCByZXZpZXcucmF0aW5nOyBpKyspIHtcbiAgICBzdGFycy5pbm5lckhUTUwgKz0gJ+KYhSc7XG4gIH1cbiAgc3RhcnMuc2V0QXR0cmlidXRlKCdhcmlhLWxhYmVsJywgYCR7cmV2aWV3LnJhdGluZ30gc3RhcnMgb24gNSxgKTtcbiAgcmF0aW5nLmlubmVySFRNTCA9ICdSYXRpbmc6ICc7XG4gIHJhdGluZy5hcHBlbmRDaGlsZChzdGFycyk7XG4gIGxpLmFwcGVuZENoaWxkKHJhdGluZyk7XG5cbiAgY29uc3QgY29tbWVudHMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XG4gIGNvbW1lbnRzLmNsYXNzTmFtZSA9ICd1c2VyQ29tbWVudHMnO1xuICBjb21tZW50cy5pbm5lckhUTUwgPSByZXZpZXcuY29tbWVudHM7XG4gIGxpLmFwcGVuZENoaWxkKGNvbW1lbnRzKTtcblxuICBsaS5zZXRBdHRyaWJ1dGUoJ3JvbGUnLCAnbGlzdGl0ZW0nKTtcbiAgcmV0dXJuIGxpO1xufTtcblxuLyoqXG4gKiBBZGQgcmVzdGF1cmFudCBuYW1lIHRvIHRoZSBicmVhZGNydW1iIG5hdmlnYXRpb24gbWVudVxuICovXG5jb25zdCBmaWxsQnJlYWRjcnVtYiA9IChyZXN0YXVyYW50ID0gc2VsZi5yZXN0YXVyYW50KSA9PiB7XG4gIGNvbnN0IGJyZWFkY3J1bWIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYnJlYWRjcnVtYicpO1xuICBjb25zdCBsaSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpJyk7XG4gIGxpLmlubmVySFRNTCA9IGAgJHtyZXN0YXVyYW50Lm5hbWV9YDtcbiAgbGkuY2xhc3NOYW1lID0gJ2ZvbnRhd2Vzb21lLWFycm93LXJpZ2h0JztcbiAgbGkuc2V0QXR0cmlidXRlKCdhcmlhLWN1cnJlbnQnLCAncGFnZScpO1xuICBicmVhZGNydW1iLmFwcGVuZENoaWxkKGxpKTtcbn07XG5cbi8qKlxuICogR2V0IGEgcGFyYW1ldGVyIGJ5IG5hbWUgZnJvbSBwYWdlIFVSTC5cbiAqL1xuY29uc3QgZ2V0UGFyYW1ldGVyQnlOYW1lID0gKG5hbWUsIHVybCkgPT4ge1xuICBpZiAoIXVybClcbiAgICB1cmwgPSB3aW5kb3cubG9jYXRpb24uaHJlZjtcbiAgbmFtZSA9IG5hbWUucmVwbGFjZSgvW1xcW1xcXV0vZywgJ1xcXFwkJicpO1xuICBjb25zdCByZWdleCA9IG5ldyBSZWdFeHAoYFs/Jl0ke25hbWV9KD0oW14mI10qKXwmfCN8JClgKSxcbiAgICByZXN1bHRzID0gcmVnZXguZXhlYyh1cmwpO1xuICBpZiAoIXJlc3VsdHMpXG4gICAgcmV0dXJuIG51bGw7XG4gIGlmICghcmVzdWx0c1syXSlcbiAgICByZXR1cm4gJyc7XG4gIHJldHVybiBkZWNvZGVVUklDb21wb25lbnQocmVzdWx0c1syXS5yZXBsYWNlKC9cXCsvZywgJyAnKSk7XG59OyJdfQ==
