import DBHelper from"./dbhelper";import Launch from"./helpers";var restaurant,map;"serviceWorker"in navigator&&window.addEventListener("load",()=>{const e="hallya.github.io"===window.location.hostname?"/mws-restaurant-stage-1/sw.js":"../sw.js";navigator.serviceWorker.register(e).then(e=>console.log("registration to serviceWorker complete with scope :",e.scope))}),window.initMap=(()=>{fetchRestaurantFromURL().then(e=>{const t=document.createElement("div");t.setAttribute("tabindex","-1"),t.setAttribute("aria-hidden","true"),t.id="map",self.map=new google.maps.Map(t,{zoom:16,center:e.latlng,scrollwheel:!1}),document.getElementById("map-container").appendChild(t),self.map.addListener("tilesloaded",function(){document.getElementById("map-loader").remove()}),DBHelper.mapMarkerForRestaurant(self.restaurant,self.map),fillBreadcrumb()}).then(Launch.lazyLoading).catch(e=>console.error(e))});const fetchRestaurantFromURL=()=>{if(self.restaurant)return void console.log("- Restaurant already fetch");const e=getParameterByName("id");return e?DBHelper.fetchRestaurantById(e).then(e=>self.restaurant=e).then(fillRestaurantHTML).catch(e=>console.error(e)):console.error("No restaurant id in URL")},fillRestaurantHTML=(e=self.restaurant)=>{document.getElementById("restaurant-name").innerHTML=e.name;const t=document.getElementById("restaurant-address");t.innerHTML=e.address,t.setAttribute("aria-label",`located at ${e.address}`);const a=document.getElementsByTagName("figure")[0],r=document.getElementsByTagName("figcaption")[0],n=document.createElement("picture"),s=document.createElement("source");s.dataset.srcset=`${DBHelper.imageWebpUrlForRestaurant(e)}-large_x1.webp 1x, ${DBHelper.imageWebpUrlForRestaurant(e)}-large_x2.webp 2x`,s.srcset=`${DBHelper.imageWebpUrlForRestaurant(e)}-lazy.webp`,s.className="lazy",s.media="(min-width: 1000px)",s.type="image/webp";const l=document.createElement("source");l.dataset.srcset=`${DBHelper.imageUrlForRestaurant(e)}-large_x1.jpg 1x, ${DBHelper.imageUrlForRestaurant(e)}-large_x2.jpg 2x`,l.srcset=`${DBHelper.imageUrlForRestaurant(e)}-lazy.jpg`,l.className="lazy",l.media=s.media,l.type="image/jpeg";const i=document.createElement("source");i.dataset.srcset=`${DBHelper.imageWebpUrlForRestaurant(e)}-medium_x1.webp 1x, ${DBHelper.imageWebpUrlForRestaurant(e)}-medium_x2.webp 2x`,i.srcset=`${DBHelper.imageUrlForRestaurant(e)}-lazy.jpg`,i.className="lazy",i.media="(min-width: 420px)",i.type="image/webp";const o=document.createElement("source");o.dataset.srcset=`${DBHelper.imageUrlForRestaurant(e)}-medium_x1.jpg 1x, ${DBHelper.imageUrlForRestaurant(e)}-medium_x2.jpg 2x`,o.srcset=`${DBHelper.imageUrlForRestaurant(e)}-lazy.jpg`,o.className="lazy",o.media=i.media,o.type="image/jpeg";const m=document.createElement("source");m.dataset.srcset=`${DBHelper.imageWebpUrlForRestaurant(e)}-small_x2.webp 2x, ${DBHelper.imageWebpUrlForRestaurant(e)}-small_x1.webp 1x`,m.srcset=`${DBHelper.imageUrlForRestaurant(e)}-lazy.jpg`,m.className="lazy",m.media="(min-width: 320px)",m.type="image/webp";const c=document.createElement("source");c.dataset.srcset=`${DBHelper.imageUrlForRestaurant(e)}-small_x2.jpg 2x, ${DBHelper.imageUrlForRestaurant(e)}-small_x1.jpg 1x`,c.srcset=`${DBHelper.imageUrlForRestaurant(e)}-lazy.jpg`,c.className="lazy",c.media=m.media,c.type="image/jpeg";const d=document.createElement("img");d.className="restaurant-img lazy",d.dataset.src=`${DBHelper.imageUrlForRestaurant(e)}-large_x1.jpg`,d.src=`${DBHelper.imageUrlForRestaurant(e)}-lazy.jpg`,d.setAttribute("sizes","(max-width: 1100px) 85vw, (min-width: 1101px) 990px"),d.alt=`${e.name}'s  restaurant`,d.type="image/jpeg",n.appendChild(s),n.appendChild(l),n.appendChild(i),n.appendChild(o),n.appendChild(m),n.appendChild(c),n.appendChild(d),a.insertBefore(n,r);const p=document.getElementById("restaurant-cuisine");p.innerHTML=e.cuisine_type;const u=document.createElement("label");return u.innerHTML=`${e.cuisine_type} food`,u.setAttribute("hidden","hidden"),u.id="foodType",p.parentNode.insertBefore(u,p.nextSibling),e.operating_hours&&fillRestaurantHoursHTML(),fillReviewsHTML(),e},fillRestaurantHoursHTML=(e=self.restaurant.operating_hours)=>{const t=document.getElementById("restaurant-hours");for(let a in e){const r=document.createElement("tr"),n=document.createElement("td");n.innerHTML=a,n.setAttribute("aria-label",`open on ${a}`),r.appendChild(n);const s=document.createElement("td");s.innerHTML=e[a],s.setAttribute("aria-label",`${e[a]},`),r.appendChild(s),r.setAttribute("role","row"),t.appendChild(r)}},fillReviewsHTML=(e=self.restaurant.reviews)=>{const t=document.getElementById("reviews-container"),a=document.createElement("h3");if(a.innerHTML="Reviews",t.appendChild(a),!e){const e=document.createElement("p");return e.innerHTML="No reviews yet!",void t.appendChild(e)}const r=document.getElementById("reviews-list");e.forEach(e=>{r.appendChild(createReviewHTML(e))}),t.appendChild(r)},createReviewHTML=e=>{const t=document.createElement("li"),a=document.createElement("p");a.className="userName",a.innerHTML=e.name,a.setAttribute("aria-label",`${e.name},`),t.appendChild(a);const r=document.createElement("p");r.className="dateReview",r.innerHTML=e.date,r.setAttribute("aria-label",`${e.date},`),t.appendChild(r);const n=document.createElement("p");let s=document.createElement("span");n.className="userRating",s.className="ratingStars";for(let t=0;t<e.rating;t++)s.innerHTML+="â˜…";s.setAttribute("aria-label",`${e.rating} stars on 5,`),n.innerHTML="Rating: ",n.appendChild(s),t.appendChild(n);const l=document.createElement("p");return l.className="userComments",l.innerHTML=e.comments,t.appendChild(l),t.setAttribute("role","listitem"),t.setAttribute("aria-setsize",self.restaurant.reviews.length),t.setAttribute("aria-posinset",self.restaurant.reviews.indexOf(e)+1),t},fillBreadcrumb=(e=self.restaurant)=>{const t=document.getElementById("breadcrumb"),a=document.createElement("li");a.innerHTML=` ${e.name}`,a.className="fontawesome-arrow-right",a.setAttribute("aria-current","page"),t.appendChild(a)},getParameterByName=(e,t)=>{t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");const a=new RegExp(`[?&]${e}(=([^&#]*)|&|#|$)`).exec(t);return a?a[2]?decodeURIComponent(a[2].replace(/\+/g," ")):"":null};