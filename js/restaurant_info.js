(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),_indexedb=require("./indexedb"),_indexedb2=_interopRequireDefault(_indexedb);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var DBHelper=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"fetchRestaurants",value:function(){return fetch(e.DATABASE_URL).then(function(e){return e.json()}).then(function(e){return window.navigator.standalone?e.restaurants:e}).catch(function(e){return console.error("Request failed. Returned status of "+e)})}},{key:"fetchRestaurantById",value:function(t){return _indexedb2.default.get("restaurants",Number(t)).then(function(n){return n||(console.log("No cache found"),fetch(e.DATABASE_URL).then(function(e){return e.json()}).then(function(e){var n=e.restaurants[t-1];return _indexedb2.default.set("restaurants",n),n}).catch(function(e){return console.error("Restaurant does not exist: "+e)}))})}},{key:"fetchRestaurantByCuisine",value:function(t){return e.fetchRestaurants().then(function(e){return e.restaurants.filter(function(e){return e.cuisine_type==t})}).catch(function(e){return console.error(e)})}},{key:"fetchRestaurantByNeighborhood",value:function(t){return e.fetchRestaurants().then(function(e){return e.restaurants.filter(function(e){return e.neighborhood==t})}).catch(function(e){return console.error(e)})}},{key:"fetchRestaurantByCuisineAndNeighborhood",value:function(t,n){return _indexedb2.default.getAll("restaurants").then(function(r){return r.length<10?e.fetchRestaurants().then(function(r){var u=r;return u.forEach(function(e){return _indexedb2.default.set("restaurants",e)}),e.filterResults(u,t,n)}).catch(function(e){return console.error(e)}):e.filterResults(r,t,n)}).catch(function(e){return console.error(e)})}},{key:"filterResults",value:function(e,t,n){return"all"!==t&&(e=e.filter(function(e){return e.cuisine_type==t})),"all"!==n&&(e=e.filter(function(e){return e.neighborhood==n})),e}},{key:"fetchNeighborhoods",value:function(){return e.fetchRestaurants().then(function(e){var t=e.map(function(e){return e.neighborhood});return t.filter(function(e,n){return t.indexOf(e)==n})}).catch(function(e){return console.error(e)})}},{key:"fetchCuisines",value:function(){return e.fetchRestaurants().then(function(e){var t=e.map(function(e){return e.cuisine_type});return t.filter(function(e,n){return t.indexOf(e)==n})}).catch(function(e){return console.error(e)})}},{key:"urlForRestaurant",value:function(e){return"restaurant.html?id="+e.id}},{key:"imageUrlForRestaurant",value:function(e){return"assets/img/jpg/"+e.photograph}},{key:"imageWebpUrlForRestaurant",value:function(e){return"assets/img/webp/"+e.photograph}},{key:"mapMarkerForRestaurant",value:function(t,n){return new google.maps.Marker({position:t.latlng,title:t.name,url:e.urlForRestaurant(t),map:n,animation:google.maps.Animation.DROP})}},{key:"DATABASE_URL",get:function(){return window.navigator.standalone?"data/restaurants.json":"http://localhost:1337/restaurants"}}]),e}();exports.default=DBHelper;
},{"./indexedb":3}],2:[function(require,module,exports){
"use strict";function activateLazyLoading(){var e=[].slice.call(document.querySelectorAll(".lazy"));if("IntersectionObserver"in window){var t=new IntersectionObserver(function(e,n){e.forEach(function(e){if(e.isIntersecting){var n=e.target;"source"===n.localName?n.srcset=n.dataset.srcset:n.src=n.dataset.src,n.classList.remove("lazy"),t.unobserve(n)}})});e.forEach(function(e){t.observe(e)})}else{var n=[].slice.call(document.querySelectorAll(".lazy")),o=!1,r=function e(){!1===o&&(o=!0,setTimeout(function(){n.forEach(function(t){t.getBoundingClientRect().top<=window.innerHeight+50&&t.getBoundingClientRect().bottom>=0&&"none"!==getComputedStyle(t).display&&(t.src=t.dataset.src,t.srcset=t.dataset.srcset,t.classList.remove("lazy"),0===(n=n.filter(function(e){return e!==t})).length&&(document.removeEventListener("scroll",e),window.removeEventListener("resize",e),window.removeEventListener("orientationchange",e)))}),o=!1},200))};document.addEventListener("scroll",r),window.addEventListener("resize",r),window.addEventListener("orientationchange",r),"complete"===window.document.readyState&&r()}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=activateLazyLoading;
},{}],3:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _idb=require("../node_modules/idb/lib/idb"),_idb2=_interopRequireDefault(_idb);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var openDatabase=function(){if(navigator.serviceWorker)return _idb2.default.open("restaurant-reviews",1,function(e){switch(e.oldVersion){case 0:e.createObjectStore("restaurants",{keyPath:"id"})}})},idbKey={get:function(e,t){return openDatabase().then(function(r){if(r)return r.transaction(e).objectStore(e).get(t)}).catch(function(e){return console.error(e)})},set:function(e,t){return openDatabase().then(function(r){if(r){var n=r.transaction(e,"readwrite");return n.objectStore(e).put(t),n.complete}}).catch(function(e){return console.error(e)})},getAll:function(e){return openDatabase().then(function(t){if(t)return t.transaction(e).objectStore(e).getAll()}).catch(function(e){return console.error(e)})}};self.idbKey=idbKey,exports.default=idbKey;
},{"../node_modules/idb/lib/idb":5}],4:[function(require,module,exports){
"use strict";var restaurant,map,_dbhelper=require("./dbhelper"),_dbhelper2=_interopRequireDefault(_dbhelper),_helpers=require("./helpers"),_helpers2=_interopRequireDefault(_helpers);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}document.addEventListener("load",function(e){}),"serviceWorker"in navigator&&window.addEventListener("load",function(){navigator.serviceWorker.register("../sw.js").then(function(e){console.log("registration to serviceWorker complete with scope :",e.scope)}),navigator.serviceWorker.addEventListener("message",function(e){"confirmed"===e.data.message&&(_dbhelper2.default.switchLoaderToMap(),console.log("Switch done"))})}),window.initMap=function(){fetchRestaurantFromURL().then(function(e){self.map=new google.maps.Map(document.getElementById("map"),{zoom:16,center:e.latlng,scrollwheel:!1}),(0,_helpers2.default)(),_dbhelper2.default.mapMarkerForRestaurant(self.restaurant,self.map),fillBreadcrumb()})};var fetchRestaurantFromURL=function(){if(!self.restaurant){var e=getParameterByName("id");return e?_dbhelper2.default.fetchRestaurantById(e).then(function(e){return self.restaurant=e}).then(fillRestaurantHTML).catch(function(e){return console.error(e)}):console.error("No restaurant id in URL")}console.log("restaurant already fetch")},fillRestaurantHTML=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:self.restaurant;document.getElementById("restaurant-name").innerHTML=e.name;var t=document.getElementById("restaurant-address");t.innerHTML=e.address,t.setAttribute("aria-label","located at "+e.address);var a=document.getElementsByTagName("figure")[0],r=document.getElementsByTagName("figcaption")[0],n=document.createElement("picture"),l=document.createElement("source");l.dataset.srcset=_dbhelper2.default.imageWebpUrlForRestaurant(e)+"-large_x1.webp 1x, "+_dbhelper2.default.imageWebpUrlForRestaurant(e)+"-large_x2.webp 2x",l.srcset=_dbhelper2.default.imageWebpUrlForRestaurant(e)+"-lazy.webp",l.className="lazy",l.media="(min-width: 1000px)",l.type="image/webp";var i=document.createElement("source");i.dataset.srcset=_dbhelper2.default.imageUrlForRestaurant(e)+"-large_x1.jpg 1x, "+_dbhelper2.default.imageUrlForRestaurant(e)+"-large_x2.jpg 2x",i.srcset=_dbhelper2.default.imageUrlForRestaurant(e)+"-lazy.jpg",i.className="lazy",i.media=l.media,i.type="image/jpeg";var s=document.createElement("source");s.dataset.srcset=_dbhelper2.default.imageWebpUrlForRestaurant(e)+"-medium_x1.webp 1x, "+_dbhelper2.default.imageWebpUrlForRestaurant(e)+"-medium_x2.webp 2x",s.srcset=_dbhelper2.default.imageUrlForRestaurant(e)+"-lazy.jpg",s.className="lazy",s.media="(min-width: 420px)",s.type="image/webp";var d=document.createElement("source");d.dataset.srcset=_dbhelper2.default.imageUrlForRestaurant(e)+"-medium_x1.jpg 1x, "+_dbhelper2.default.imageUrlForRestaurant(e)+"-medium_x2.jpg 2x",d.srcset=_dbhelper2.default.imageUrlForRestaurant(e)+"-lazy.jpg",d.className="lazy",d.media=s.media,d.type="image/jpeg";var u=document.createElement("source");u.dataset.srcset=_dbhelper2.default.imageWebpUrlForRestaurant(e)+"-small_x2.webp 2x, "+_dbhelper2.default.imageWebpUrlForRestaurant(e)+"-small_x1.webp 1x",u.srcset=_dbhelper2.default.imageUrlForRestaurant(e)+"-lazy.jpg",u.className="lazy",u.media="(min-width: 320px)",u.type="image/webp";var m=document.createElement("source");m.dataset.srcset=_dbhelper2.default.imageUrlForRestaurant(e)+"-small_x2.jpg 2x, "+_dbhelper2.default.imageUrlForRestaurant(e)+"-small_x1.jpg 1x",m.srcset=_dbhelper2.default.imageUrlForRestaurant(e)+"-lazy.jpg",m.className="lazy",m.media=u.media,m.type="image/jpeg";var o=document.createElement("img");o.className="restaurant-img lazy",o.dataset.src=_dbhelper2.default.imageUrlForRestaurant(e)+"-large_x1.jpg",o.src=_dbhelper2.default.imageUrlForRestaurant(e)+"-lazy.jpg",o.setAttribute("sizes","(max-width: 1100px) 85vw, (min-width: 1101px) 990px"),o.alt=e.name+"'s  restaurant",o.type="image/jpeg",n.appendChild(l),n.appendChild(i),n.appendChild(s),n.appendChild(d),n.appendChild(u),n.appendChild(m),n.appendChild(o),a.insertBefore(n,r);var p=document.getElementById("restaurant-cuisine");p.innerHTML=e.cuisine_type;var c=document.createElement("label");return c.innerHTML=e.cuisine_type+" food",c.setAttribute("hidden","hidden"),c.id="foodType",p.parentNode.insertBefore(c,p.nextSibling),e.operating_hours&&fillRestaurantHoursHTML(),fillReviewsHTML(),e},fillRestaurantHoursHTML=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:self.restaurant.operating_hours,t=document.getElementById("restaurant-hours");for(var a in e){var r=document.createElement("tr"),n=document.createElement("td");n.innerHTML=a,n.setAttribute("aria-label","open on "+a),r.appendChild(n);var l=document.createElement("td");l.innerHTML=e[a],l.setAttribute("aria-label",e[a]+","),r.appendChild(l),r.setAttribute("role","row"),t.appendChild(r)}},fillReviewsHTML=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:self.restaurant.reviews,t=document.getElementById("reviews-container"),a=document.createElement("h3");if(a.innerHTML="Reviews",t.appendChild(a),!e){var r=document.createElement("p");return r.innerHTML="No reviews yet!",void t.appendChild(r)}var n=document.getElementById("reviews-list");e.forEach(function(e){n.appendChild(createReviewHTML(e))}),t.appendChild(n)},createReviewHTML=function(e){var t=document.createElement("li"),a=document.createElement("p");a.className="userName",a.innerHTML=e.name,a.setAttribute("aria-label",e.name+","),t.appendChild(a);var r=document.createElement("p");r.className="dateReview",r.innerHTML=e.date,r.setAttribute("aria-label",e.date+","),t.appendChild(r);var n=document.createElement("p"),l=document.createElement("span");n.className="userRating",l.className="ratingStars";for(var i=0;i<e.rating;i++)l.innerHTML+="★";l.setAttribute("aria-label",e.rating+" stars on 5,"),n.innerHTML="Rating: ",n.appendChild(l),t.appendChild(n);var s=document.createElement("p");return s.className="userComments",s.innerHTML=e.comments,t.appendChild(s),t.setAttribute("role","listitem"),t.setAttribute("aria-setsize",self.restaurant.reviews.length),t.setAttribute("aria-posinset",self.restaurant.reviews.indexOf(e)+1),t},fillBreadcrumb=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:self.restaurant,t=document.getElementById("breadcrumb"),a=document.createElement("li");a.innerHTML=" "+e.name,a.className="fontawesome-arrow-right",a.setAttribute("aria-current","page"),t.appendChild(a)},getParameterByName=function(e,t){t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");var a=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(t);return a?a[2]?decodeURIComponent(a[2].replace(/\+/g," ")):"":null};
},{"./dbhelper":1,"./helpers":2}],5:[function(require,module,exports){
"use strict";!function(){function e(e){return new Promise(function(t,n){e.onsuccess=function(){t(e.result)},e.onerror=function(){n(e.error)}})}function t(t,n,o){var r,i=new Promise(function(i,u){e(r=t[n].apply(t,o)).then(i,u)});return i.request=r,i}function n(e,t,n){n.forEach(function(n){Object.defineProperty(e.prototype,n,{get:function(){return this[t][n]},set:function(e){this[t][n]=e}})})}function o(e,n,o,r){r.forEach(function(r){r in o.prototype&&(e.prototype[r]=function(){return t(this[n],r,arguments)})})}function r(e,t,n,o){o.forEach(function(o){o in n.prototype&&(e.prototype[o]=function(){return this[t][o].apply(this[t],arguments)})})}function i(e,n,o,r){r.forEach(function(r){r in o.prototype&&(e.prototype[r]=function(){return e=this[n],(o=t(e,r,arguments)).then(function(e){if(e)return new c(e,o.request)});var e,o})})}function u(e){this._index=e}function c(e,t){this._cursor=e,this._request=t}function s(e){this._store=e}function a(e){this._tx=e,this.complete=new Promise(function(t,n){e.oncomplete=function(){t()},e.onerror=function(){n(e.error)},e.onabort=function(){n(e.error)}})}function p(e,t,n){this._db=e,this.oldVersion=t,this.transaction=new a(n)}function f(e){this._db=e}n(u,"_index",["name","keyPath","multiEntry","unique"]),o(u,"_index",IDBIndex,["get","getKey","getAll","getAllKeys","count"]),i(u,"_index",IDBIndex,["openCursor","openKeyCursor"]),n(c,"_cursor",["direction","key","primaryKey","value"]),o(c,"_cursor",IDBCursor,["update","delete"]),["advance","continue","continuePrimaryKey"].forEach(function(t){t in IDBCursor.prototype&&(c.prototype[t]=function(){var n=this,o=arguments;return Promise.resolve().then(function(){return n._cursor[t].apply(n._cursor,o),e(n._request).then(function(e){if(e)return new c(e,n._request)})})})}),s.prototype.createIndex=function(){return new u(this._store.createIndex.apply(this._store,arguments))},s.prototype.index=function(){return new u(this._store.index.apply(this._store,arguments))},n(s,"_store",["name","keyPath","indexNames","autoIncrement"]),o(s,"_store",IDBObjectStore,["put","add","delete","clear","get","getAll","getKey","getAllKeys","count"]),i(s,"_store",IDBObjectStore,["openCursor","openKeyCursor"]),r(s,"_store",IDBObjectStore,["deleteIndex"]),a.prototype.objectStore=function(){return new s(this._tx.objectStore.apply(this._tx,arguments))},n(a,"_tx",["objectStoreNames","mode"]),r(a,"_tx",IDBTransaction,["abort"]),p.prototype.createObjectStore=function(){return new s(this._db.createObjectStore.apply(this._db,arguments))},n(p,"_db",["name","version","objectStoreNames"]),r(p,"_db",IDBDatabase,["deleteObjectStore","close"]),f.prototype.transaction=function(){return new a(this._db.transaction.apply(this._db,arguments))},n(f,"_db",["name","version","objectStoreNames"]),r(f,"_db",IDBDatabase,["close"]),["openCursor","openKeyCursor"].forEach(function(e){[s,u].forEach(function(t){t.prototype[e.replace("open","iterate")]=function(){var t,n=(t=arguments,Array.prototype.slice.call(t)),o=n[n.length-1],r=this._store||this._index,i=r[e].apply(r,n.slice(0,-1));i.onsuccess=function(){o(i.result)}}})}),[u,s].forEach(function(e){e.prototype.getAll||(e.prototype.getAll=function(e,t){var n=this,o=[];return new Promise(function(r){n.iterateCursor(e,function(e){e?(o.push(e.value),void 0===t||o.length!=t?e.continue():r(o)):r(o)})})})});var d={open:function(e,n,o){var r=t(indexedDB,"open",[e,n]),i=r.request;return i.onupgradeneeded=function(e){o&&o(new p(i.result,e.oldVersion,i.transaction))},r.then(function(e){return new f(e)})},delete:function(e){return t(indexedDB,"deleteDatabase",[e])}};"undefined"!=typeof module?(module.exports=d,module.exports.default=module.exports):self.idb=d}();
},{}]},{},[4]);
